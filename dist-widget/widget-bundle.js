function Av(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Sf={exports:{}},$o={},Cf={exports:{}},Y={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fs=Symbol.for("react.element"),Lv=Symbol.for("react.portal"),Uv=Symbol.for("react.fragment"),Fv=Symbol.for("react.strict_mode"),jv=Symbol.for("react.profiler"),Bv=Symbol.for("react.provider"),Vv=Symbol.for("react.context"),zv=Symbol.for("react.forward_ref"),qv=Symbol.for("react.suspense"),Wv=Symbol.for("react.memo"),Hv=Symbol.for("react.lazy"),Zu=Symbol.iterator;function Kv(t){return t===null||typeof t!="object"?null:(t=Zu&&t[Zu]||t["@@iterator"],typeof t=="function"?t:null)}var Tf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bf=Object.assign,wf={};function or(t,e,n){this.props=t,this.context=e,this.refs=wf,this.updater=n||Tf}or.prototype.isReactComponent={};or.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};or.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Ef(){}Ef.prototype=or.prototype;function Ol(t,e,n){this.props=t,this.context=e,this.refs=wf,this.updater=n||Tf}var Dl=Ol.prototype=new Ef;Dl.constructor=Ol;bf(Dl,or.prototype);Dl.isPureReactComponent=!0;var ed=Array.isArray,_f=Object.prototype.hasOwnProperty,Nl={current:null},Pf={key:!0,ref:!0,__self:!0,__source:!0};function Rf(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)_f.call(e,i)&&!Pf.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:fs,type:t,key:s,ref:o,props:r,_owner:Nl.current}}function Gv(t,e){return{$$typeof:fs,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Al(t){return typeof t=="object"&&t!==null&&t.$$typeof===fs}function Jv(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var td=/\/+/g;function Sa(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Jv(""+t.key):e.toString(36)}function Fs(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case fs:case Lv:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Sa(o,0):i,ed(r)?(n="",t!=null&&(n=t.replace(td,"$&/")+"/"),Fs(r,e,n,"",function(l){return l})):r!=null&&(Al(r)&&(r=Gv(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(td,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",ed(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+Sa(s,a);o+=Fs(s,e,n,c,r)}else if(c=Kv(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+Sa(s,a++),o+=Fs(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ys(t,e,n){if(t==null)return t;var i=[],r=0;return Fs(t,i,"","",function(s){return e.call(n,s,r++)}),i}function $v(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ye={current:null},js={transition:null},Qv={ReactCurrentDispatcher:Ye,ReactCurrentBatchConfig:js,ReactCurrentOwner:Nl};function If(){throw Error("act(...) is not supported in production builds of React.")}Y.Children={map:ys,forEach:function(t,e,n){ys(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ys(t,function(){e++}),e},toArray:function(t){return ys(t,function(e){return e})||[]},only:function(t){if(!Al(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Y.Component=or;Y.Fragment=Uv;Y.Profiler=jv;Y.PureComponent=Ol;Y.StrictMode=Fv;Y.Suspense=qv;Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qv;Y.act=If;Y.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=bf({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Nl.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)_f.call(e,c)&&!Pf.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:fs,type:t.type,key:r,ref:s,props:i,_owner:o}};Y.createContext=function(t){return t={$$typeof:Vv,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Bv,_context:t},t.Consumer=t};Y.createElement=Rf;Y.createFactory=function(t){var e=Rf.bind(null,t);return e.type=t,e};Y.createRef=function(){return{current:null}};Y.forwardRef=function(t){return{$$typeof:zv,render:t}};Y.isValidElement=Al;Y.lazy=function(t){return{$$typeof:Hv,_payload:{_status:-1,_result:t},_init:$v}};Y.memo=function(t,e){return{$$typeof:Wv,type:t,compare:e===void 0?null:e}};Y.startTransition=function(t){var e=js.transition;js.transition={};try{t()}finally{js.transition=e}};Y.unstable_act=If;Y.useCallback=function(t,e){return Ye.current.useCallback(t,e)};Y.useContext=function(t){return Ye.current.useContext(t)};Y.useDebugValue=function(){};Y.useDeferredValue=function(t){return Ye.current.useDeferredValue(t)};Y.useEffect=function(t,e){return Ye.current.useEffect(t,e)};Y.useId=function(){return Ye.current.useId()};Y.useImperativeHandle=function(t,e,n){return Ye.current.useImperativeHandle(t,e,n)};Y.useInsertionEffect=function(t,e){return Ye.current.useInsertionEffect(t,e)};Y.useLayoutEffect=function(t,e){return Ye.current.useLayoutEffect(t,e)};Y.useMemo=function(t,e){return Ye.current.useMemo(t,e)};Y.useReducer=function(t,e,n){return Ye.current.useReducer(t,e,n)};Y.useRef=function(t){return Ye.current.useRef(t)};Y.useState=function(t){return Ye.current.useState(t)};Y.useSyncExternalStore=function(t,e,n){return Ye.current.useSyncExternalStore(t,e,n)};Y.useTransition=function(){return Ye.current.useTransition()};Y.version="18.3.1";Cf.exports=Y;var Z=Cf.exports;const xf=Av(Z);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yv=Z,Xv=Symbol.for("react.element"),Zv=Symbol.for("react.fragment"),ey=Object.prototype.hasOwnProperty,ty=Yv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ny={key:!0,ref:!0,__self:!0,__source:!0};function Mf(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)ey.call(e,i)&&!ny.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:Xv,type:t,key:s,ref:o,props:r,_owner:ty.current}}$o.Fragment=Zv;$o.jsx=Mf;$o.jsxs=Mf;Sf.exports=$o;var V=Sf.exports,dc={},Of={exports:{}},mt={},Df={exports:{}},Nf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,z){var F=U.length;U.push(z);e:for(;0<F;){var B=F-1>>>1,K=U[B];if(0<r(K,z))U[B]=z,U[F]=K,F=B;else break e}}function n(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var z=U[0],F=U.pop();if(F!==z){U[0]=F;e:for(var B=0,K=U.length,Ae=K>>>1;B<Ae;){var Ve=2*(B+1)-1,Yt=U[Ve],et=Ve+1,Yn=U[et];if(0>r(Yt,F))et<K&&0>r(Yn,Yt)?(U[B]=Yn,U[et]=F,B=et):(U[B]=Yt,U[Ve]=F,B=Ve);else if(et<K&&0>r(Yn,F))U[B]=Yn,U[et]=F,B=et;else break e}}return z}function r(U,z){var F=U.sortIndex-z.sortIndex;return F!==0?F:U.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,v=!1,C=!1,p=!1,w=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function f(U){for(var z=n(l);z!==null;){if(z.callback===null)i(l);else if(z.startTime<=U)i(l),z.sortIndex=z.expirationTime,e(c,z);else break;z=n(l)}}function m(U){if(p=!1,f(U),!C)if(n(c)!==null)C=!0,_e(k);else{var z=n(l);z!==null&&he(m,z.startTime-U)}}function k(U,z){C=!1,p&&(p=!1,g(_),_=-1),v=!0;var F=h;try{for(f(z),d=n(c);d!==null&&(!(d.expirationTime>z)||U&&!N());){var B=d.callback;if(typeof B=="function"){d.callback=null,h=d.priorityLevel;var K=B(d.expirationTime<=z);z=t.unstable_now(),typeof K=="function"?d.callback=K:d===n(c)&&i(c),f(z)}else i(c);d=n(c)}if(d!==null)var Ae=!0;else{var Ve=n(l);Ve!==null&&he(m,Ve.startTime-z),Ae=!1}return Ae}finally{d=null,h=F,v=!1}}var T=!1,E=null,_=-1,x=5,P=-1;function N(){return!(t.unstable_now()-P<x)}function W(){if(E!==null){var U=t.unstable_now();P=U;var z=!0;try{z=E(!0,U)}finally{z?ie():(T=!1,E=null)}}else T=!1}var ie;if(typeof y=="function")ie=function(){y(W)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,te=q.port2;q.port1.onmessage=W,ie=function(){te.postMessage(null)}}else ie=function(){w(W,0)};function _e(U){E=U,T||(T=!0,ie())}function he(U,z){_=w(function(){U(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){C||v||(C=!0,_e(k))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(U){switch(h){case 1:case 2:case 3:var z=3;break;default:z=h}var F=h;h=z;try{return U()}finally{h=F}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,z){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var F=h;h=U;try{return z()}finally{h=F}},t.unstable_scheduleCallback=function(U,z,F){var B=t.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?B+F:B):F=B,U){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=F+K,U={id:u++,callback:z,priorityLevel:U,startTime:F,expirationTime:K,sortIndex:-1},F>B?(U.sortIndex=F,e(l,U),n(c)===null&&U===n(l)&&(p?(g(_),_=-1):p=!0,he(m,F-B))):(U.sortIndex=K,e(c,U),C||v||(C=!0,_e(k))),U},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(U){var z=h;return function(){var F=h;h=z;try{return U.apply(this,arguments)}finally{h=F}}}})(Nf);Df.exports=Nf;var iy=Df.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ry=Z,pt=iy;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Af=new Set,qr={};function gi(t,e){Yi(t,e),Yi(t+"Capture",e)}function Yi(t,e){for(qr[t]=e,t=0;t<e.length;t++)Af.add(e[t])}var hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hc=Object.prototype.hasOwnProperty,sy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,nd={},id={};function oy(t){return hc.call(id,t)?!0:hc.call(nd,t)?!1:sy.test(t)?id[t]=!0:(nd[t]=!0,!1)}function ay(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function cy(t,e,n,i){if(e===null||typeof e>"u"||ay(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Be={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Be[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Be[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Be[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Be[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Be[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Be[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Be[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Be[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Be[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ll=/[\-:]([a-z])/g;function Ul(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ll,Ul);Be[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ll,Ul);Be[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ll,Ul);Be[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Be[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});Be.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Be[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function Fl(t,e,n,i){var r=Be.hasOwnProperty(e)?Be[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(cy(e,n,r,i)&&(n=null),i||r===null?oy(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var vn=ry.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ks=Symbol.for("react.element"),bi=Symbol.for("react.portal"),wi=Symbol.for("react.fragment"),jl=Symbol.for("react.strict_mode"),fc=Symbol.for("react.profiler"),Lf=Symbol.for("react.provider"),Uf=Symbol.for("react.context"),Bl=Symbol.for("react.forward_ref"),pc=Symbol.for("react.suspense"),mc=Symbol.for("react.suspense_list"),Vl=Symbol.for("react.memo"),bn=Symbol.for("react.lazy"),Ff=Symbol.for("react.offscreen"),rd=Symbol.iterator;function lr(t){return t===null||typeof t!="object"?null:(t=rd&&t[rd]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,Ca;function br(t){if(Ca===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ca=e&&e[1]||""}return`
`+Ca+t}var Ta=!1;function ba(t,e){if(!t||Ta)return"";Ta=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Ta=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?br(t):""}function ly(t){switch(t.tag){case 5:return br(t.type);case 16:return br("Lazy");case 13:return br("Suspense");case 19:return br("SuspenseList");case 0:case 2:case 15:return t=ba(t.type,!1),t;case 11:return t=ba(t.type.render,!1),t;case 1:return t=ba(t.type,!0),t;default:return""}}function gc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case wi:return"Fragment";case bi:return"Portal";case fc:return"Profiler";case jl:return"StrictMode";case pc:return"Suspense";case mc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Uf:return(t.displayName||"Context")+".Consumer";case Lf:return(t._context.displayName||"Context")+".Provider";case Bl:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Vl:return e=t.displayName||null,e!==null?e:gc(t.type)||"Memo";case bn:e=t._payload,t=t._init;try{return gc(t(e))}catch{}}return null}function uy(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gc(e);case 8:return e===jl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function zn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function jf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dy(t){var e=jf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ss(t){t._valueTracker||(t._valueTracker=dy(t))}function Bf(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=jf(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function lo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vc(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function sd(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=zn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Vf(t,e){e=e.checked,e!=null&&Fl(t,"checked",e,!1)}function yc(t,e){Vf(t,e);var n=zn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?kc(t,e.type,n):e.hasOwnProperty("defaultValue")&&kc(t,e.type,zn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function od(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function kc(t,e,n){(e!=="number"||lo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var wr=Array.isArray;function Fi(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+zn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Sc(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ad(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(wr(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:zn(n)}}function zf(t,e){var n=zn(e.value),i=zn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function cd(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function qf(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Cc(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?qf(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Cs,Wf=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Cs=Cs||document.createElement("div"),Cs.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Cs.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Wr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ir={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hy=["Webkit","ms","Moz","O"];Object.keys(Ir).forEach(function(t){hy.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ir[e]=Ir[t]})});function Hf(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ir.hasOwnProperty(t)&&Ir[t]?(""+e).trim():e+"px"}function Kf(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Hf(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var fy=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tc(t,e){if(e){if(fy[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function bc(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wc=null;function zl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ec=null,ji=null,Bi=null;function ld(t){if(t=gs(t)){if(typeof Ec!="function")throw Error(O(280));var e=t.stateNode;e&&(e=ea(e),Ec(t.stateNode,t.type,e))}}function Gf(t){ji?Bi?Bi.push(t):Bi=[t]:ji=t}function Jf(){if(ji){var t=ji,e=Bi;if(Bi=ji=null,ld(t),e)for(t=0;t<e.length;t++)ld(e[t])}}function $f(t,e){return t(e)}function Qf(){}var wa=!1;function Yf(t,e,n){if(wa)return t(e,n);wa=!0;try{return $f(t,e,n)}finally{wa=!1,(ji!==null||Bi!==null)&&(Qf(),Jf())}}function Hr(t,e){var n=t.stateNode;if(n===null)return null;var i=ea(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var _c=!1;if(hn)try{var ur={};Object.defineProperty(ur,"passive",{get:function(){_c=!0}}),window.addEventListener("test",ur,ur),window.removeEventListener("test",ur,ur)}catch{_c=!1}function py(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var xr=!1,uo=null,ho=!1,Pc=null,my={onError:function(t){xr=!0,uo=t}};function gy(t,e,n,i,r,s,o,a,c){xr=!1,uo=null,py.apply(my,arguments)}function vy(t,e,n,i,r,s,o,a,c){if(gy.apply(this,arguments),xr){if(xr){var l=uo;xr=!1,uo=null}else throw Error(O(198));ho||(ho=!0,Pc=l)}}function vi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Xf(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ud(t){if(vi(t)!==t)throw Error(O(188))}function yy(t){var e=t.alternate;if(!e){if(e=vi(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return ud(r),t;if(s===i)return ud(r),e;s=s.sibling}throw Error(O(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==i)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function Zf(t){return t=yy(t),t!==null?ep(t):null}function ep(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=ep(t);if(e!==null)return e;t=t.sibling}return null}var tp=pt.unstable_scheduleCallback,dd=pt.unstable_cancelCallback,ky=pt.unstable_shouldYield,Sy=pt.unstable_requestPaint,Te=pt.unstable_now,Cy=pt.unstable_getCurrentPriorityLevel,ql=pt.unstable_ImmediatePriority,np=pt.unstable_UserBlockingPriority,fo=pt.unstable_NormalPriority,Ty=pt.unstable_LowPriority,ip=pt.unstable_IdlePriority,Qo=null,Ht=null;function by(t){if(Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(Qo,t,void 0,(t.current.flags&128)===128)}catch{}}var Lt=Math.clz32?Math.clz32:_y,wy=Math.log,Ey=Math.LN2;function _y(t){return t>>>=0,t===0?32:31-(wy(t)/Ey|0)|0}var Ts=64,bs=4194304;function Er(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function po(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Er(a):(s&=o,s!==0&&(i=Er(s)))}else o=n&~r,o!==0?i=Er(o):s!==0&&(i=Er(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Lt(e),r=1<<n,i|=t[n],e&=~r;return i}function Py(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ry(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Lt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=Py(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function Rc(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function rp(){var t=Ts;return Ts<<=1,!(Ts&4194240)&&(Ts=64),t}function Ea(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ps(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lt(e),t[e]=n}function Iy(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Lt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Wl(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Lt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var oe=0;function sp(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var op,Hl,ap,cp,lp,Ic=!1,ws=[],Mn=null,On=null,Dn=null,Kr=new Map,Gr=new Map,En=[],xy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hd(t,e){switch(t){case"focusin":case"focusout":Mn=null;break;case"dragenter":case"dragleave":On=null;break;case"mouseover":case"mouseout":Dn=null;break;case"pointerover":case"pointerout":Kr.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gr.delete(e.pointerId)}}function dr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=gs(e),e!==null&&Hl(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function My(t,e,n,i,r){switch(e){case"focusin":return Mn=dr(Mn,t,e,n,i,r),!0;case"dragenter":return On=dr(On,t,e,n,i,r),!0;case"mouseover":return Dn=dr(Dn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Kr.set(s,dr(Kr.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Gr.set(s,dr(Gr.get(s)||null,t,e,n,i,r)),!0}return!1}function up(t){var e=ii(t.target);if(e!==null){var n=vi(e);if(n!==null){if(e=n.tag,e===13){if(e=Xf(n),e!==null){t.blockedOn=e,lp(t.priority,function(){ap(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Bs(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xc(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);wc=i,n.target.dispatchEvent(i),wc=null}else return e=gs(n),e!==null&&Hl(e),t.blockedOn=n,!1;e.shift()}return!0}function fd(t,e,n){Bs(t)&&n.delete(e)}function Oy(){Ic=!1,Mn!==null&&Bs(Mn)&&(Mn=null),On!==null&&Bs(On)&&(On=null),Dn!==null&&Bs(Dn)&&(Dn=null),Kr.forEach(fd),Gr.forEach(fd)}function hr(t,e){t.blockedOn===e&&(t.blockedOn=null,Ic||(Ic=!0,pt.unstable_scheduleCallback(pt.unstable_NormalPriority,Oy)))}function Jr(t){function e(r){return hr(r,t)}if(0<ws.length){hr(ws[0],t);for(var n=1;n<ws.length;n++){var i=ws[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Mn!==null&&hr(Mn,t),On!==null&&hr(On,t),Dn!==null&&hr(Dn,t),Kr.forEach(e),Gr.forEach(e),n=0;n<En.length;n++)i=En[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<En.length&&(n=En[0],n.blockedOn===null);)up(n),n.blockedOn===null&&En.shift()}var Vi=vn.ReactCurrentBatchConfig,mo=!0;function Dy(t,e,n,i){var r=oe,s=Vi.transition;Vi.transition=null;try{oe=1,Kl(t,e,n,i)}finally{oe=r,Vi.transition=s}}function Ny(t,e,n,i){var r=oe,s=Vi.transition;Vi.transition=null;try{oe=4,Kl(t,e,n,i)}finally{oe=r,Vi.transition=s}}function Kl(t,e,n,i){if(mo){var r=xc(t,e,n,i);if(r===null)Aa(t,e,i,go,n),hd(t,i);else if(My(r,t,e,n,i))i.stopPropagation();else if(hd(t,i),e&4&&-1<xy.indexOf(t)){for(;r!==null;){var s=gs(r);if(s!==null&&op(s),s=xc(t,e,n,i),s===null&&Aa(t,e,i,go,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Aa(t,e,i,null,n)}}var go=null;function xc(t,e,n,i){if(go=null,t=zl(i),t=ii(t),t!==null)if(e=vi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Xf(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return go=t,null}function dp(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Cy()){case ql:return 1;case np:return 4;case fo:case Ty:return 16;case ip:return 536870912;default:return 16}default:return 16}}var Rn=null,Gl=null,Vs=null;function hp(){if(Vs)return Vs;var t,e=Gl,n=e.length,i,r="value"in Rn?Rn.value:Rn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Vs=r.slice(t,1<i?1-i:void 0)}function zs(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Es(){return!0}function pd(){return!1}function gt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Es:pd,this.isPropagationStopped=pd,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Es)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Es)},persist:function(){},isPersistent:Es}),e}var ar={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jl=gt(ar),ms=ve({},ar,{view:0,detail:0}),Ay=gt(ms),_a,Pa,fr,Yo=ve({},ms,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$l,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==fr&&(fr&&t.type==="mousemove"?(_a=t.screenX-fr.screenX,Pa=t.screenY-fr.screenY):Pa=_a=0,fr=t),_a)},movementY:function(t){return"movementY"in t?t.movementY:Pa}}),md=gt(Yo),Ly=ve({},Yo,{dataTransfer:0}),Uy=gt(Ly),Fy=ve({},ms,{relatedTarget:0}),Ra=gt(Fy),jy=ve({},ar,{animationName:0,elapsedTime:0,pseudoElement:0}),By=gt(jy),Vy=ve({},ar,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zy=gt(Vy),qy=ve({},ar,{data:0}),gd=gt(qy),Wy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ky={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gy(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Ky[t])?!!e[t]:!1}function $l(){return Gy}var Jy=ve({},ms,{key:function(t){if(t.key){var e=Wy[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=zs(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Hy[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$l,charCode:function(t){return t.type==="keypress"?zs(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?zs(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),$y=gt(Jy),Qy=ve({},Yo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vd=gt(Qy),Yy=ve({},ms,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$l}),Xy=gt(Yy),Zy=ve({},ar,{propertyName:0,elapsedTime:0,pseudoElement:0}),e0=gt(Zy),t0=ve({},Yo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),n0=gt(t0),i0=[9,13,27,32],Ql=hn&&"CompositionEvent"in window,Mr=null;hn&&"documentMode"in document&&(Mr=document.documentMode);var r0=hn&&"TextEvent"in window&&!Mr,fp=hn&&(!Ql||Mr&&8<Mr&&11>=Mr),yd=" ",kd=!1;function pp(t,e){switch(t){case"keyup":return i0.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mp(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ei=!1;function s0(t,e){switch(t){case"compositionend":return mp(e);case"keypress":return e.which!==32?null:(kd=!0,yd);case"textInput":return t=e.data,t===yd&&kd?null:t;default:return null}}function o0(t,e){if(Ei)return t==="compositionend"||!Ql&&pp(t,e)?(t=hp(),Vs=Gl=Rn=null,Ei=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return fp&&e.locale!=="ko"?null:e.data;default:return null}}var a0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Sd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!a0[t.type]:e==="textarea"}function gp(t,e,n,i){Gf(i),e=vo(e,"onChange"),0<e.length&&(n=new Jl("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Or=null,$r=null;function c0(t){Pp(t,0)}function Xo(t){var e=Ri(t);if(Bf(e))return t}function l0(t,e){if(t==="change")return e}var vp=!1;if(hn){var Ia;if(hn){var xa="oninput"in document;if(!xa){var Cd=document.createElement("div");Cd.setAttribute("oninput","return;"),xa=typeof Cd.oninput=="function"}Ia=xa}else Ia=!1;vp=Ia&&(!document.documentMode||9<document.documentMode)}function Td(){Or&&(Or.detachEvent("onpropertychange",yp),$r=Or=null)}function yp(t){if(t.propertyName==="value"&&Xo($r)){var e=[];gp(e,$r,t,zl(t)),Yf(c0,e)}}function u0(t,e,n){t==="focusin"?(Td(),Or=e,$r=n,Or.attachEvent("onpropertychange",yp)):t==="focusout"&&Td()}function d0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Xo($r)}function h0(t,e){if(t==="click")return Xo(e)}function f0(t,e){if(t==="input"||t==="change")return Xo(e)}function p0(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ft=typeof Object.is=="function"?Object.is:p0;function Qr(t,e){if(Ft(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!hc.call(e,r)||!Ft(t[r],e[r]))return!1}return!0}function bd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wd(t,e){var n=bd(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=bd(n)}}function kp(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?kp(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Sp(){for(var t=window,e=lo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=lo(t.document)}return e}function Yl(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function m0(t){var e=Sp(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&kp(n.ownerDocument.documentElement,n)){if(i!==null&&Yl(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=wd(n,s);var o=wd(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var g0=hn&&"documentMode"in document&&11>=document.documentMode,_i=null,Mc=null,Dr=null,Oc=!1;function Ed(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Oc||_i==null||_i!==lo(i)||(i=_i,"selectionStart"in i&&Yl(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Dr&&Qr(Dr,i)||(Dr=i,i=vo(Mc,"onSelect"),0<i.length&&(e=new Jl("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=_i)))}function _s(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Pi={animationend:_s("Animation","AnimationEnd"),animationiteration:_s("Animation","AnimationIteration"),animationstart:_s("Animation","AnimationStart"),transitionend:_s("Transition","TransitionEnd")},Ma={},Cp={};hn&&(Cp=document.createElement("div").style,"AnimationEvent"in window||(delete Pi.animationend.animation,delete Pi.animationiteration.animation,delete Pi.animationstart.animation),"TransitionEvent"in window||delete Pi.transitionend.transition);function Zo(t){if(Ma[t])return Ma[t];if(!Pi[t])return t;var e=Pi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Cp)return Ma[t]=e[n];return t}var Tp=Zo("animationend"),bp=Zo("animationiteration"),wp=Zo("animationstart"),Ep=Zo("transitionend"),_p=new Map,_d="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kn(t,e){_p.set(t,e),gi(e,[t])}for(var Oa=0;Oa<_d.length;Oa++){var Da=_d[Oa],v0=Da.toLowerCase(),y0=Da[0].toUpperCase()+Da.slice(1);Kn(v0,"on"+y0)}Kn(Tp,"onAnimationEnd");Kn(bp,"onAnimationIteration");Kn(wp,"onAnimationStart");Kn("dblclick","onDoubleClick");Kn("focusin","onFocus");Kn("focusout","onBlur");Kn(Ep,"onTransitionEnd");Yi("onMouseEnter",["mouseout","mouseover"]);Yi("onMouseLeave",["mouseout","mouseover"]);Yi("onPointerEnter",["pointerout","pointerover"]);Yi("onPointerLeave",["pointerout","pointerover"]);gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));gi("onBeforeInput",["compositionend","keypress","textInput","paste"]);gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _r="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),k0=new Set("cancel close invalid load scroll toggle".split(" ").concat(_r));function Pd(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,vy(i,e,void 0,t),t.currentTarget=null}function Pp(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Pd(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Pd(r,a,l),s=c}}}if(ho)throw t=Pc,ho=!1,Pc=null,t}function ue(t,e){var n=e[Uc];n===void 0&&(n=e[Uc]=new Set);var i=t+"__bubble";n.has(i)||(Rp(e,t,2,!1),n.add(i))}function Na(t,e,n){var i=0;e&&(i|=4),Rp(n,t,i,e)}var Ps="_reactListening"+Math.random().toString(36).slice(2);function Yr(t){if(!t[Ps]){t[Ps]=!0,Af.forEach(function(n){n!=="selectionchange"&&(k0.has(n)||Na(n,!1,t),Na(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ps]||(e[Ps]=!0,Na("selectionchange",!1,e))}}function Rp(t,e,n,i){switch(dp(e)){case 1:var r=Dy;break;case 4:r=Ny;break;default:r=Kl}n=r.bind(null,e,n,t),r=void 0,!_c||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Aa(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=ii(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Yf(function(){var l=s,u=zl(n),d=[];e:{var h=_p.get(t);if(h!==void 0){var v=Jl,C=t;switch(t){case"keypress":if(zs(n)===0)break e;case"keydown":case"keyup":v=$y;break;case"focusin":C="focus",v=Ra;break;case"focusout":C="blur",v=Ra;break;case"beforeblur":case"afterblur":v=Ra;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=md;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=Uy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=Xy;break;case Tp:case bp:case wp:v=By;break;case Ep:v=e0;break;case"scroll":v=Ay;break;case"wheel":v=n0;break;case"copy":case"cut":case"paste":v=zy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=vd}var p=(e&4)!==0,w=!p&&t==="scroll",g=p?h!==null?h+"Capture":null:h;p=[];for(var y=l,f;y!==null;){f=y;var m=f.stateNode;if(f.tag===5&&m!==null&&(f=m,g!==null&&(m=Hr(y,g),m!=null&&p.push(Xr(y,m,f)))),w)break;y=y.return}0<p.length&&(h=new v(h,C,null,n,u),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",v=t==="mouseout"||t==="pointerout",h&&n!==wc&&(C=n.relatedTarget||n.fromElement)&&(ii(C)||C[fn]))break e;if((v||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,v?(C=n.relatedTarget||n.toElement,v=l,C=C?ii(C):null,C!==null&&(w=vi(C),C!==w||C.tag!==5&&C.tag!==6)&&(C=null)):(v=null,C=l),v!==C)){if(p=md,m="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(p=vd,m="onPointerLeave",g="onPointerEnter",y="pointer"),w=v==null?h:Ri(v),f=C==null?h:Ri(C),h=new p(m,y+"leave",v,n,u),h.target=w,h.relatedTarget=f,m=null,ii(u)===l&&(p=new p(g,y+"enter",C,n,u),p.target=f,p.relatedTarget=w,m=p),w=m,v&&C)t:{for(p=v,g=C,y=0,f=p;f;f=Si(f))y++;for(f=0,m=g;m;m=Si(m))f++;for(;0<y-f;)p=Si(p),y--;for(;0<f-y;)g=Si(g),f--;for(;y--;){if(p===g||g!==null&&p===g.alternate)break t;p=Si(p),g=Si(g)}p=null}else p=null;v!==null&&Rd(d,h,v,p,!1),C!==null&&w!==null&&Rd(d,w,C,p,!0)}}e:{if(h=l?Ri(l):window,v=h.nodeName&&h.nodeName.toLowerCase(),v==="select"||v==="input"&&h.type==="file")var k=l0;else if(Sd(h))if(vp)k=f0;else{k=d0;var T=u0}else(v=h.nodeName)&&v.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=h0);if(k&&(k=k(t,l))){gp(d,k,n,u);break e}T&&T(t,h,l),t==="focusout"&&(T=h._wrapperState)&&T.controlled&&h.type==="number"&&kc(h,"number",h.value)}switch(T=l?Ri(l):window,t){case"focusin":(Sd(T)||T.contentEditable==="true")&&(_i=T,Mc=l,Dr=null);break;case"focusout":Dr=Mc=_i=null;break;case"mousedown":Oc=!0;break;case"contextmenu":case"mouseup":case"dragend":Oc=!1,Ed(d,n,u);break;case"selectionchange":if(g0)break;case"keydown":case"keyup":Ed(d,n,u)}var E;if(Ql)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Ei?pp(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(fp&&n.locale!=="ko"&&(Ei||_!=="onCompositionStart"?_==="onCompositionEnd"&&Ei&&(E=hp()):(Rn=u,Gl="value"in Rn?Rn.value:Rn.textContent,Ei=!0)),T=vo(l,_),0<T.length&&(_=new gd(_,t,null,n,u),d.push({event:_,listeners:T}),E?_.data=E:(E=mp(n),E!==null&&(_.data=E)))),(E=r0?s0(t,n):o0(t,n))&&(l=vo(l,"onBeforeInput"),0<l.length&&(u=new gd("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=E))}Pp(d,e)})}function Xr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function vo(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Hr(t,n),s!=null&&i.unshift(Xr(t,s,r)),s=Hr(t,e),s!=null&&i.push(Xr(t,s,r))),t=t.return}return i}function Si(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Rd(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=Hr(n,s),c!=null&&o.unshift(Xr(n,c,a))):r||(c=Hr(n,s),c!=null&&o.push(Xr(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var S0=/\r\n?/g,C0=/\u0000|\uFFFD/g;function Id(t){return(typeof t=="string"?t:""+t).replace(S0,`
`).replace(C0,"")}function Rs(t,e,n){if(e=Id(e),Id(t)!==e&&n)throw Error(O(425))}function yo(){}var Dc=null,Nc=null;function Ac(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Lc=typeof setTimeout=="function"?setTimeout:void 0,T0=typeof clearTimeout=="function"?clearTimeout:void 0,xd=typeof Promise=="function"?Promise:void 0,b0=typeof queueMicrotask=="function"?queueMicrotask:typeof xd<"u"?function(t){return xd.resolve(null).then(t).catch(w0)}:Lc;function w0(t){setTimeout(function(){throw t})}function La(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Jr(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Jr(e)}function Nn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Md(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var cr=Math.random().toString(36).slice(2),Wt="__reactFiber$"+cr,Zr="__reactProps$"+cr,fn="__reactContainer$"+cr,Uc="__reactEvents$"+cr,E0="__reactListeners$"+cr,_0="__reactHandles$"+cr;function ii(t){var e=t[Wt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fn]||n[Wt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Md(t);t!==null;){if(n=t[Wt])return n;t=Md(t)}return e}t=n,n=t.parentNode}return null}function gs(t){return t=t[Wt]||t[fn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ri(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function ea(t){return t[Zr]||null}var Fc=[],Ii=-1;function Gn(t){return{current:t}}function de(t){0>Ii||(t.current=Fc[Ii],Fc[Ii]=null,Ii--)}function le(t,e){Ii++,Fc[Ii]=t.current,t.current=e}var qn={},He=Gn(qn),st=Gn(!1),ci=qn;function Xi(t,e){var n=t.type.contextTypes;if(!n)return qn;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function ot(t){return t=t.childContextTypes,t!=null}function ko(){de(st),de(He)}function Od(t,e,n){if(He.current!==qn)throw Error(O(168));le(He,e),le(st,n)}function Ip(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(O(108,uy(t)||"Unknown",r));return ve({},n,i)}function So(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||qn,ci=He.current,le(He,t),le(st,st.current),!0}function Dd(t,e,n){var i=t.stateNode;if(!i)throw Error(O(169));n?(t=Ip(t,e,ci),i.__reactInternalMemoizedMergedChildContext=t,de(st),de(He),le(He,t)):de(st),le(st,n)}var en=null,ta=!1,Ua=!1;function xp(t){en===null?en=[t]:en.push(t)}function P0(t){ta=!0,xp(t)}function Jn(){if(!Ua&&en!==null){Ua=!0;var t=0,e=oe;try{var n=en;for(oe=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}en=null,ta=!1}catch(r){throw en!==null&&(en=en.slice(t+1)),tp(ql,Jn),r}finally{oe=e,Ua=!1}}return null}var xi=[],Mi=0,Co=null,To=0,kt=[],St=0,li=null,cn=1,ln="";function Zn(t,e){xi[Mi++]=To,xi[Mi++]=Co,Co=t,To=e}function Mp(t,e,n){kt[St++]=cn,kt[St++]=ln,kt[St++]=li,li=t;var i=cn;t=ln;var r=32-Lt(i)-1;i&=~(1<<r),n+=1;var s=32-Lt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,cn=1<<32-Lt(e)+r|n<<r|i,ln=s+t}else cn=1<<s|n<<r|i,ln=t}function Xl(t){t.return!==null&&(Zn(t,1),Mp(t,1,0))}function Zl(t){for(;t===Co;)Co=xi[--Mi],xi[Mi]=null,To=xi[--Mi],xi[Mi]=null;for(;t===li;)li=kt[--St],kt[St]=null,ln=kt[--St],kt[St]=null,cn=kt[--St],kt[St]=null}var ft=null,dt=null,fe=!1,Mt=null;function Op(t,e){var n=Ct(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Nd(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ft=t,dt=Nn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ft=t,dt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=li!==null?{id:cn,overflow:ln}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ct(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ft=t,dt=null,!0):!1;default:return!1}}function jc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Bc(t){if(fe){var e=dt;if(e){var n=e;if(!Nd(t,e)){if(jc(t))throw Error(O(418));e=Nn(n.nextSibling);var i=ft;e&&Nd(t,e)?Op(i,n):(t.flags=t.flags&-4097|2,fe=!1,ft=t)}}else{if(jc(t))throw Error(O(418));t.flags=t.flags&-4097|2,fe=!1,ft=t}}}function Ad(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ft=t}function Is(t){if(t!==ft)return!1;if(!fe)return Ad(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ac(t.type,t.memoizedProps)),e&&(e=dt)){if(jc(t))throw Dp(),Error(O(418));for(;e;)Op(t,e),e=Nn(e.nextSibling)}if(Ad(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){dt=Nn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}dt=null}}else dt=ft?Nn(t.stateNode.nextSibling):null;return!0}function Dp(){for(var t=dt;t;)t=Nn(t.nextSibling)}function Zi(){dt=ft=null,fe=!1}function eu(t){Mt===null?Mt=[t]:Mt.push(t)}var R0=vn.ReactCurrentBatchConfig;function pr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var i=n.stateNode}if(!i)throw Error(O(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function xs(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Ld(t){var e=t._init;return e(t._payload)}function Np(t){function e(g,y){if(t){var f=g.deletions;f===null?(g.deletions=[y],g.flags|=16):f.push(y)}}function n(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function i(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function r(g,y){return g=Fn(g,y),g.index=0,g.sibling=null,g}function s(g,y,f){return g.index=f,t?(f=g.alternate,f!==null?(f=f.index,f<y?(g.flags|=2,y):f):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,y,f,m){return y===null||y.tag!==6?(y=Wa(f,g.mode,m),y.return=g,y):(y=r(y,f),y.return=g,y)}function c(g,y,f,m){var k=f.type;return k===wi?u(g,y,f.props.children,m,f.key):y!==null&&(y.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===bn&&Ld(k)===y.type)?(m=r(y,f.props),m.ref=pr(g,y,f),m.return=g,m):(m=$s(f.type,f.key,f.props,null,g.mode,m),m.ref=pr(g,y,f),m.return=g,m)}function l(g,y,f,m){return y===null||y.tag!==4||y.stateNode.containerInfo!==f.containerInfo||y.stateNode.implementation!==f.implementation?(y=Ha(f,g.mode,m),y.return=g,y):(y=r(y,f.children||[]),y.return=g,y)}function u(g,y,f,m,k){return y===null||y.tag!==7?(y=ai(f,g.mode,m,k),y.return=g,y):(y=r(y,f),y.return=g,y)}function d(g,y,f){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Wa(""+y,g.mode,f),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ks:return f=$s(y.type,y.key,y.props,null,g.mode,f),f.ref=pr(g,null,y),f.return=g,f;case bi:return y=Ha(y,g.mode,f),y.return=g,y;case bn:var m=y._init;return d(g,m(y._payload),f)}if(wr(y)||lr(y))return y=ai(y,g.mode,f,null),y.return=g,y;xs(g,y)}return null}function h(g,y,f,m){var k=y!==null?y.key:null;if(typeof f=="string"&&f!==""||typeof f=="number")return k!==null?null:a(g,y,""+f,m);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case ks:return f.key===k?c(g,y,f,m):null;case bi:return f.key===k?l(g,y,f,m):null;case bn:return k=f._init,h(g,y,k(f._payload),m)}if(wr(f)||lr(f))return k!==null?null:u(g,y,f,m,null);xs(g,f)}return null}function v(g,y,f,m,k){if(typeof m=="string"&&m!==""||typeof m=="number")return g=g.get(f)||null,a(y,g,""+m,k);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ks:return g=g.get(m.key===null?f:m.key)||null,c(y,g,m,k);case bi:return g=g.get(m.key===null?f:m.key)||null,l(y,g,m,k);case bn:var T=m._init;return v(g,y,f,T(m._payload),k)}if(wr(m)||lr(m))return g=g.get(f)||null,u(y,g,m,k,null);xs(y,m)}return null}function C(g,y,f,m){for(var k=null,T=null,E=y,_=y=0,x=null;E!==null&&_<f.length;_++){E.index>_?(x=E,E=null):x=E.sibling;var P=h(g,E,f[_],m);if(P===null){E===null&&(E=x);break}t&&E&&P.alternate===null&&e(g,E),y=s(P,y,_),T===null?k=P:T.sibling=P,T=P,E=x}if(_===f.length)return n(g,E),fe&&Zn(g,_),k;if(E===null){for(;_<f.length;_++)E=d(g,f[_],m),E!==null&&(y=s(E,y,_),T===null?k=E:T.sibling=E,T=E);return fe&&Zn(g,_),k}for(E=i(g,E);_<f.length;_++)x=v(E,g,_,f[_],m),x!==null&&(t&&x.alternate!==null&&E.delete(x.key===null?_:x.key),y=s(x,y,_),T===null?k=x:T.sibling=x,T=x);return t&&E.forEach(function(N){return e(g,N)}),fe&&Zn(g,_),k}function p(g,y,f,m){var k=lr(f);if(typeof k!="function")throw Error(O(150));if(f=k.call(f),f==null)throw Error(O(151));for(var T=k=null,E=y,_=y=0,x=null,P=f.next();E!==null&&!P.done;_++,P=f.next()){E.index>_?(x=E,E=null):x=E.sibling;var N=h(g,E,P.value,m);if(N===null){E===null&&(E=x);break}t&&E&&N.alternate===null&&e(g,E),y=s(N,y,_),T===null?k=N:T.sibling=N,T=N,E=x}if(P.done)return n(g,E),fe&&Zn(g,_),k;if(E===null){for(;!P.done;_++,P=f.next())P=d(g,P.value,m),P!==null&&(y=s(P,y,_),T===null?k=P:T.sibling=P,T=P);return fe&&Zn(g,_),k}for(E=i(g,E);!P.done;_++,P=f.next())P=v(E,g,_,P.value,m),P!==null&&(t&&P.alternate!==null&&E.delete(P.key===null?_:P.key),y=s(P,y,_),T===null?k=P:T.sibling=P,T=P);return t&&E.forEach(function(W){return e(g,W)}),fe&&Zn(g,_),k}function w(g,y,f,m){if(typeof f=="object"&&f!==null&&f.type===wi&&f.key===null&&(f=f.props.children),typeof f=="object"&&f!==null){switch(f.$$typeof){case ks:e:{for(var k=f.key,T=y;T!==null;){if(T.key===k){if(k=f.type,k===wi){if(T.tag===7){n(g,T.sibling),y=r(T,f.props.children),y.return=g,g=y;break e}}else if(T.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===bn&&Ld(k)===T.type){n(g,T.sibling),y=r(T,f.props),y.ref=pr(g,T,f),y.return=g,g=y;break e}n(g,T);break}else e(g,T);T=T.sibling}f.type===wi?(y=ai(f.props.children,g.mode,m,f.key),y.return=g,g=y):(m=$s(f.type,f.key,f.props,null,g.mode,m),m.ref=pr(g,y,f),m.return=g,g=m)}return o(g);case bi:e:{for(T=f.key;y!==null;){if(y.key===T)if(y.tag===4&&y.stateNode.containerInfo===f.containerInfo&&y.stateNode.implementation===f.implementation){n(g,y.sibling),y=r(y,f.children||[]),y.return=g,g=y;break e}else{n(g,y);break}else e(g,y);y=y.sibling}y=Ha(f,g.mode,m),y.return=g,g=y}return o(g);case bn:return T=f._init,w(g,y,T(f._payload),m)}if(wr(f))return C(g,y,f,m);if(lr(f))return p(g,y,f,m);xs(g,f)}return typeof f=="string"&&f!==""||typeof f=="number"?(f=""+f,y!==null&&y.tag===6?(n(g,y.sibling),y=r(y,f),y.return=g,g=y):(n(g,y),y=Wa(f,g.mode,m),y.return=g,g=y),o(g)):n(g,y)}return w}var er=Np(!0),Ap=Np(!1),bo=Gn(null),wo=null,Oi=null,tu=null;function nu(){tu=Oi=wo=null}function iu(t){var e=bo.current;de(bo),t._currentValue=e}function Vc(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function zi(t,e){wo=t,tu=Oi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(it=!0),t.firstContext=null)}function wt(t){var e=t._currentValue;if(tu!==t)if(t={context:t,memoizedValue:e,next:null},Oi===null){if(wo===null)throw Error(O(308));Oi=t,wo.dependencies={lanes:0,firstContext:t}}else Oi=Oi.next=t;return e}var ri=null;function ru(t){ri===null?ri=[t]:ri.push(t)}function Lp(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,ru(e)):(n.next=r.next,r.next=n),e.interleaved=n,pn(t,i)}function pn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var wn=!1;function su(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Up(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function dn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function An(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,ee&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,pn(t,n)}return r=i.interleaved,r===null?(e.next=e,ru(i)):(e.next=r.next,r.next=e),i.interleaved=e,pn(t,n)}function qs(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Wl(t,n)}}function Ud(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Eo(t,e,n,i){var r=t.updateQueue;wn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,v=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:v,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var C=t,p=a;switch(h=e,v=n,p.tag){case 1:if(C=p.payload,typeof C=="function"){d=C.call(v,d,h);break e}d=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=p.payload,h=typeof C=="function"?C.call(v,d,h):C,h==null)break e;d=ve({},d,h);break e;case 2:wn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else v={eventTime:v,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=v,c=d):u=u.next=v,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);di|=o,t.lanes=o,t.memoizedState=d}}function Fd(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(O(191,r));r.call(i)}}}var vs={},Kt=Gn(vs),es=Gn(vs),ts=Gn(vs);function si(t){if(t===vs)throw Error(O(174));return t}function ou(t,e){switch(le(ts,e),le(es,t),le(Kt,vs),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Cc(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Cc(e,t)}de(Kt),le(Kt,e)}function tr(){de(Kt),de(es),de(ts)}function Fp(t){si(ts.current);var e=si(Kt.current),n=Cc(e,t.type);e!==n&&(le(es,t),le(Kt,n))}function au(t){es.current===t&&(de(Kt),de(es))}var me=Gn(0);function _o(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Fa=[];function cu(){for(var t=0;t<Fa.length;t++)Fa[t]._workInProgressVersionPrimary=null;Fa.length=0}var Ws=vn.ReactCurrentDispatcher,ja=vn.ReactCurrentBatchConfig,ui=0,ge=null,Re=null,Me=null,Po=!1,Nr=!1,ns=0,I0=0;function ze(){throw Error(O(321))}function lu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ft(t[n],e[n]))return!1;return!0}function uu(t,e,n,i,r,s){if(ui=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ws.current=t===null||t.memoizedState===null?D0:N0,t=n(i,r),Nr){s=0;do{if(Nr=!1,ns=0,25<=s)throw Error(O(301));s+=1,Me=Re=null,e.updateQueue=null,Ws.current=A0,t=n(i,r)}while(Nr)}if(Ws.current=Ro,e=Re!==null&&Re.next!==null,ui=0,Me=Re=ge=null,Po=!1,e)throw Error(O(300));return t}function du(){var t=ns!==0;return ns=0,t}function zt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?ge.memoizedState=Me=t:Me=Me.next=t,Me}function Et(){if(Re===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=Me===null?ge.memoizedState:Me.next;if(e!==null)Me=e,Re=t;else{if(t===null)throw Error(O(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Me===null?ge.memoizedState=Me=t:Me=Me.next=t}return Me}function is(t,e){return typeof e=="function"?e(t):e}function Ba(t){var e=Et(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=Re,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((ui&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,ge.lanes|=u,di|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Ft(i,e.memoizedState)||(it=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ge.lanes|=s,di|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Va(t){var e=Et(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Ft(s,e.memoizedState)||(it=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function jp(){}function Bp(t,e){var n=ge,i=Et(),r=e(),s=!Ft(i.memoizedState,r);if(s&&(i.memoizedState=r,it=!0),i=i.queue,hu(qp.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Me!==null&&Me.memoizedState.tag&1){if(n.flags|=2048,rs(9,zp.bind(null,n,i,r,e),void 0,null),Ne===null)throw Error(O(349));ui&30||Vp(n,e,r)}return r}function Vp(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zp(t,e,n,i){e.value=n,e.getSnapshot=i,Wp(e)&&Hp(t)}function qp(t,e,n){return n(function(){Wp(e)&&Hp(t)})}function Wp(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ft(t,n)}catch{return!0}}function Hp(t){var e=pn(t,1);e!==null&&Ut(e,t,1,-1)}function jd(t){var e=zt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:is,lastRenderedState:t},e.queue=t,t=t.dispatch=O0.bind(null,ge,t),[e.memoizedState,t]}function rs(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Kp(){return Et().memoizedState}function Hs(t,e,n,i){var r=zt();ge.flags|=t,r.memoizedState=rs(1|e,n,void 0,i===void 0?null:i)}function na(t,e,n,i){var r=Et();i=i===void 0?null:i;var s=void 0;if(Re!==null){var o=Re.memoizedState;if(s=o.destroy,i!==null&&lu(i,o.deps)){r.memoizedState=rs(e,n,s,i);return}}ge.flags|=t,r.memoizedState=rs(1|e,n,s,i)}function Bd(t,e){return Hs(8390656,8,t,e)}function hu(t,e){return na(2048,8,t,e)}function Gp(t,e){return na(4,2,t,e)}function Jp(t,e){return na(4,4,t,e)}function $p(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Qp(t,e,n){return n=n!=null?n.concat([t]):null,na(4,4,$p.bind(null,e,t),n)}function fu(){}function Yp(t,e){var n=Et();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&lu(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Xp(t,e){var n=Et();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&lu(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Zp(t,e,n){return ui&21?(Ft(n,e)||(n=rp(),ge.lanes|=n,di|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,it=!0),t.memoizedState=n)}function x0(t,e){var n=oe;oe=n!==0&&4>n?n:4,t(!0);var i=ja.transition;ja.transition={};try{t(!1),e()}finally{oe=n,ja.transition=i}}function em(){return Et().memoizedState}function M0(t,e,n){var i=Un(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},tm(t))nm(e,n);else if(n=Lp(t,e,n,i),n!==null){var r=$e();Ut(n,t,i,r),im(n,e,i)}}function O0(t,e,n){var i=Un(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(tm(t))nm(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Ft(a,o)){var c=e.interleaved;c===null?(r.next=r,ru(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=Lp(t,e,r,i),n!==null&&(r=$e(),Ut(n,t,i,r),im(n,e,i))}}function tm(t){var e=t.alternate;return t===ge||e!==null&&e===ge}function nm(t,e){Nr=Po=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function im(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Wl(t,n)}}var Ro={readContext:wt,useCallback:ze,useContext:ze,useEffect:ze,useImperativeHandle:ze,useInsertionEffect:ze,useLayoutEffect:ze,useMemo:ze,useReducer:ze,useRef:ze,useState:ze,useDebugValue:ze,useDeferredValue:ze,useTransition:ze,useMutableSource:ze,useSyncExternalStore:ze,useId:ze,unstable_isNewReconciler:!1},D0={readContext:wt,useCallback:function(t,e){return zt().memoizedState=[t,e===void 0?null:e],t},useContext:wt,useEffect:Bd,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Hs(4194308,4,$p.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Hs(4194308,4,t,e)},useInsertionEffect:function(t,e){return Hs(4,2,t,e)},useMemo:function(t,e){var n=zt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=zt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=M0.bind(null,ge,t),[i.memoizedState,t]},useRef:function(t){var e=zt();return t={current:t},e.memoizedState=t},useState:jd,useDebugValue:fu,useDeferredValue:function(t){return zt().memoizedState=t},useTransition:function(){var t=jd(!1),e=t[0];return t=x0.bind(null,t[1]),zt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ge,r=zt();if(fe){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),Ne===null)throw Error(O(349));ui&30||Vp(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Bd(qp.bind(null,i,s,t),[t]),i.flags|=2048,rs(9,zp.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=zt(),e=Ne.identifierPrefix;if(fe){var n=ln,i=cn;n=(i&~(1<<32-Lt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=ns++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=I0++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},N0={readContext:wt,useCallback:Yp,useContext:wt,useEffect:hu,useImperativeHandle:Qp,useInsertionEffect:Gp,useLayoutEffect:Jp,useMemo:Xp,useReducer:Ba,useRef:Kp,useState:function(){return Ba(is)},useDebugValue:fu,useDeferredValue:function(t){var e=Et();return Zp(e,Re.memoizedState,t)},useTransition:function(){var t=Ba(is)[0],e=Et().memoizedState;return[t,e]},useMutableSource:jp,useSyncExternalStore:Bp,useId:em,unstable_isNewReconciler:!1},A0={readContext:wt,useCallback:Yp,useContext:wt,useEffect:hu,useImperativeHandle:Qp,useInsertionEffect:Gp,useLayoutEffect:Jp,useMemo:Xp,useReducer:Va,useRef:Kp,useState:function(){return Va(is)},useDebugValue:fu,useDeferredValue:function(t){var e=Et();return Re===null?e.memoizedState=t:Zp(e,Re.memoizedState,t)},useTransition:function(){var t=Va(is)[0],e=Et().memoizedState;return[t,e]},useMutableSource:jp,useSyncExternalStore:Bp,useId:em,unstable_isNewReconciler:!1};function Rt(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function zc(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ia={isMounted:function(t){return(t=t._reactInternals)?vi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=$e(),r=Un(t),s=dn(i,r);s.payload=e,n!=null&&(s.callback=n),e=An(t,s,r),e!==null&&(Ut(e,t,r,i),qs(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=$e(),r=Un(t),s=dn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=An(t,s,r),e!==null&&(Ut(e,t,r,i),qs(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=$e(),i=Un(t),r=dn(n,i);r.tag=2,e!=null&&(r.callback=e),e=An(t,r,i),e!==null&&(Ut(e,t,i,n),qs(e,t,i))}};function Vd(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Qr(n,i)||!Qr(r,s):!0}function rm(t,e,n){var i=!1,r=qn,s=e.contextType;return typeof s=="object"&&s!==null?s=wt(s):(r=ot(e)?ci:He.current,i=e.contextTypes,s=(i=i!=null)?Xi(t,r):qn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ia,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function zd(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ia.enqueueReplaceState(e,e.state,null)}function qc(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},su(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=wt(s):(s=ot(e)?ci:He.current,r.context=Xi(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(zc(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&ia.enqueueReplaceState(r,r.state,null),Eo(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function nr(t,e){try{var n="",i=e;do n+=ly(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function za(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Wc(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var L0=typeof WeakMap=="function"?WeakMap:Map;function sm(t,e,n){n=dn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){xo||(xo=!0,el=i),Wc(t,e)},n}function om(t,e,n){n=dn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Wc(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Wc(t,e),typeof i!="function"&&(Ln===null?Ln=new Set([this]):Ln.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function qd(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new L0;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Q0.bind(null,t,e,n),e.then(t,t))}function Wd(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Hd(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=dn(-1,1),e.tag=2,An(n,e,1))),n.lanes|=1),t)}var U0=vn.ReactCurrentOwner,it=!1;function Ke(t,e,n,i){e.child=t===null?Ap(e,null,n,i):er(e,t.child,n,i)}function Kd(t,e,n,i,r){n=n.render;var s=e.ref;return zi(e,r),i=uu(t,e,n,i,s,r),n=du(),t!==null&&!it?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,mn(t,e,r)):(fe&&n&&Xl(e),e.flags|=1,Ke(t,e,i,r),e.child)}function Gd(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Cu(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,am(t,e,s,i,r)):(t=$s(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Qr,n(o,i)&&t.ref===e.ref)return mn(t,e,r)}return e.flags|=1,t=Fn(s,i),t.ref=e.ref,t.return=e,e.child=t}function am(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Qr(s,i)&&t.ref===e.ref)if(it=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(it=!0);else return e.lanes=t.lanes,mn(t,e,r)}return Hc(t,e,n,i,r)}function cm(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},le(Ni,ut),ut|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,le(Ni,ut),ut|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,le(Ni,ut),ut|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,le(Ni,ut),ut|=i;return Ke(t,e,r,n),e.child}function lm(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Hc(t,e,n,i,r){var s=ot(n)?ci:He.current;return s=Xi(e,s),zi(e,r),n=uu(t,e,n,i,s,r),i=du(),t!==null&&!it?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,mn(t,e,r)):(fe&&i&&Xl(e),e.flags|=1,Ke(t,e,n,r),e.child)}function Jd(t,e,n,i,r){if(ot(n)){var s=!0;So(e)}else s=!1;if(zi(e,r),e.stateNode===null)Ks(t,e),rm(e,n,i),qc(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=wt(l):(l=ot(n)?ci:He.current,l=Xi(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&zd(e,o,i,l),wn=!1;var h=e.memoizedState;o.state=h,Eo(e,i,o,r),c=e.memoizedState,a!==i||h!==c||st.current||wn?(typeof u=="function"&&(zc(e,n,u,i),c=e.memoizedState),(a=wn||Vd(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Up(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Rt(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=wt(c):(c=ot(n)?ci:He.current,c=Xi(e,c));var v=n.getDerivedStateFromProps;(u=typeof v=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&zd(e,o,i,c),wn=!1,h=e.memoizedState,o.state=h,Eo(e,i,o,r);var C=e.memoizedState;a!==d||h!==C||st.current||wn?(typeof v=="function"&&(zc(e,n,v,i),C=e.memoizedState),(l=wn||Vd(e,n,l,i,h,C,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,C,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,C,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=C),o.props=i,o.state=C,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Kc(t,e,n,i,s,r)}function Kc(t,e,n,i,r,s){lm(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Dd(e,n,!1),mn(t,e,s);i=e.stateNode,U0.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=er(e,t.child,null,s),e.child=er(e,null,a,s)):Ke(t,e,a,s),e.memoizedState=i.state,r&&Dd(e,n,!0),e.child}function um(t){var e=t.stateNode;e.pendingContext?Od(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Od(t,e.context,!1),ou(t,e.containerInfo)}function $d(t,e,n,i,r){return Zi(),eu(r),e.flags|=256,Ke(t,e,n,i),e.child}var Gc={dehydrated:null,treeContext:null,retryLane:0};function Jc(t){return{baseLanes:t,cachePool:null,transitions:null}}function dm(t,e,n){var i=e.pendingProps,r=me.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),le(me,r&1),t===null)return Bc(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=oa(o,i,0,null),t=ai(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Jc(n),e.memoizedState=Gc,t):pu(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return F0(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=Fn(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Fn(a,s):(s=ai(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Jc(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Gc,i}return s=t.child,t=s.sibling,i=Fn(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function pu(t,e){return e=oa({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ms(t,e,n,i){return i!==null&&eu(i),er(e,t.child,null,n),t=pu(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function F0(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=za(Error(O(422))),Ms(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=oa({mode:"visible",children:i.children},r,0,null),s=ai(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&er(e,t.child,null,o),e.child.memoizedState=Jc(o),e.memoizedState=Gc,s);if(!(e.mode&1))return Ms(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(O(419)),i=za(s,i,void 0),Ms(t,e,o,i)}if(a=(o&t.childLanes)!==0,it||a){if(i=Ne,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,pn(t,r),Ut(i,t,r,-1))}return Su(),i=za(Error(O(421))),Ms(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Y0.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,dt=Nn(r.nextSibling),ft=e,fe=!0,Mt=null,t!==null&&(kt[St++]=cn,kt[St++]=ln,kt[St++]=li,cn=t.id,ln=t.overflow,li=e),e=pu(e,i.children),e.flags|=4096,e)}function Qd(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Vc(t.return,e,n)}function qa(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function hm(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ke(t,e,i.children,n),i=me.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Qd(t,n,e);else if(t.tag===19)Qd(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(le(me,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&_o(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),qa(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&_o(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}qa(e,!0,n,null,s);break;case"together":qa(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ks(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function mn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),di|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=Fn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Fn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function j0(t,e,n){switch(e.tag){case 3:um(e),Zi();break;case 5:Fp(e);break;case 1:ot(e.type)&&So(e);break;case 4:ou(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;le(bo,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(le(me,me.current&1),e.flags|=128,null):n&e.child.childLanes?dm(t,e,n):(le(me,me.current&1),t=mn(t,e,n),t!==null?t.sibling:null);le(me,me.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return hm(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),le(me,me.current),i)break;return null;case 22:case 23:return e.lanes=0,cm(t,e,n)}return mn(t,e,n)}var fm,$c,pm,mm;fm=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$c=function(){};pm=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,si(Kt.current);var s=null;switch(n){case"input":r=vc(t,r),i=vc(t,i),s=[];break;case"select":r=ve({},r,{value:void 0}),i=ve({},i,{value:void 0}),s=[];break;case"textarea":r=Sc(t,r),i=Sc(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=yo)}Tc(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(qr.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(qr.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ue("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};mm=function(t,e,n,i){n!==i&&(e.flags|=4)};function mr(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function B0(t,e,n){var i=e.pendingProps;switch(Zl(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(e),null;case 1:return ot(e.type)&&ko(),qe(e),null;case 3:return i=e.stateNode,tr(),de(st),de(He),cu(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Is(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mt!==null&&(il(Mt),Mt=null))),$c(t,e),qe(e),null;case 5:au(e);var r=si(ts.current);if(n=e.type,t!==null&&e.stateNode!=null)pm(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(O(166));return qe(e),null}if(t=si(Kt.current),Is(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Wt]=e,i[Zr]=s,t=(e.mode&1)!==0,n){case"dialog":ue("cancel",i),ue("close",i);break;case"iframe":case"object":case"embed":ue("load",i);break;case"video":case"audio":for(r=0;r<_r.length;r++)ue(_r[r],i);break;case"source":ue("error",i);break;case"img":case"image":case"link":ue("error",i),ue("load",i);break;case"details":ue("toggle",i);break;case"input":sd(i,s),ue("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ue("invalid",i);break;case"textarea":ad(i,s),ue("invalid",i)}Tc(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Rs(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Rs(i.textContent,a,t),r=["children",""+a]):qr.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ue("scroll",i)}switch(n){case"input":Ss(i),od(i,s,!0);break;case"textarea":Ss(i),cd(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=yo)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=qf(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Wt]=e,t[Zr]=i,fm(t,e,!1,!1),e.stateNode=t;e:{switch(o=bc(n,i),n){case"dialog":ue("cancel",t),ue("close",t),r=i;break;case"iframe":case"object":case"embed":ue("load",t),r=i;break;case"video":case"audio":for(r=0;r<_r.length;r++)ue(_r[r],t);r=i;break;case"source":ue("error",t),r=i;break;case"img":case"image":case"link":ue("error",t),ue("load",t),r=i;break;case"details":ue("toggle",t),r=i;break;case"input":sd(t,i),r=vc(t,i),ue("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ve({},i,{value:void 0}),ue("invalid",t);break;case"textarea":ad(t,i),r=Sc(t,i),ue("invalid",t);break;default:r=i}Tc(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?Kf(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Wf(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Wr(t,c):typeof c=="number"&&Wr(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(qr.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ue("scroll",t):c!=null&&Fl(t,s,c,o))}switch(n){case"input":Ss(t),od(t,i,!1);break;case"textarea":Ss(t),cd(t);break;case"option":i.value!=null&&t.setAttribute("value",""+zn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Fi(t,!!i.multiple,s,!1):i.defaultValue!=null&&Fi(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=yo)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qe(e),null;case 6:if(t&&e.stateNode!=null)mm(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(O(166));if(n=si(ts.current),si(Kt.current),Is(e)){if(i=e.stateNode,n=e.memoizedProps,i[Wt]=e,(s=i.nodeValue!==n)&&(t=ft,t!==null))switch(t.tag){case 3:Rs(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Rs(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Wt]=e,e.stateNode=i}return qe(e),null;case 13:if(de(me),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&dt!==null&&e.mode&1&&!(e.flags&128))Dp(),Zi(),e.flags|=98560,s=!1;else if(s=Is(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[Wt]=e}else Zi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),s=!1}else Mt!==null&&(il(Mt),Mt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||me.current&1?xe===0&&(xe=3):Su())),e.updateQueue!==null&&(e.flags|=4),qe(e),null);case 4:return tr(),$c(t,e),t===null&&Yr(e.stateNode.containerInfo),qe(e),null;case 10:return iu(e.type._context),qe(e),null;case 17:return ot(e.type)&&ko(),qe(e),null;case 19:if(de(me),s=e.memoizedState,s===null)return qe(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)mr(s,!1);else{if(xe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=_o(t),o!==null){for(e.flags|=128,mr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return le(me,me.current&1|2),e.child}t=t.sibling}s.tail!==null&&Te()>ir&&(e.flags|=128,i=!0,mr(s,!1),e.lanes=4194304)}else{if(!i)if(t=_o(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),mr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return qe(e),null}else 2*Te()-s.renderingStartTime>ir&&n!==1073741824&&(e.flags|=128,i=!0,mr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Te(),e.sibling=null,n=me.current,le(me,i?n&1|2:n&1),e):(qe(e),null);case 22:case 23:return ku(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ut&1073741824&&(qe(e),e.subtreeFlags&6&&(e.flags|=8192)):qe(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function V0(t,e){switch(Zl(e),e.tag){case 1:return ot(e.type)&&ko(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return tr(),de(st),de(He),cu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return au(e),null;case 13:if(de(me),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));Zi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return de(me),null;case 4:return tr(),null;case 10:return iu(e.type._context),null;case 22:case 23:return ku(),null;case 24:return null;default:return null}}var Os=!1,We=!1,z0=typeof WeakSet=="function"?WeakSet:Set,j=null;function Di(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ke(t,e,i)}else n.current=null}function Qc(t,e,n){try{n()}catch(i){ke(t,e,i)}}var Yd=!1;function q0(t,e){if(Dc=mo,t=Sp(),Yl(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var v;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(v=d.firstChild)!==null;)h=d,d=v;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(v=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=v}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Nc={focusedElem:t,selectionRange:n},mo=!1,j=e;j!==null;)if(e=j,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,j=t;else for(;j!==null;){e=j;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var p=C.memoizedProps,w=C.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?p:Rt(e.type,p),w);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var f=e.stateNode.containerInfo;f.nodeType===1?f.textContent="":f.nodeType===9&&f.documentElement&&f.removeChild(f.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(m){ke(e,e.return,m)}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}return C=Yd,Yd=!1,C}function Ar(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Qc(e,n,s)}r=r.next}while(r!==i)}}function ra(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Yc(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gm(t){var e=t.alternate;e!==null&&(t.alternate=null,gm(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Wt],delete e[Zr],delete e[Uc],delete e[E0],delete e[_0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function vm(t){return t.tag===5||t.tag===3||t.tag===4}function Xd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Xc(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=yo));else if(i!==4&&(t=t.child,t!==null))for(Xc(t,e,n),t=t.sibling;t!==null;)Xc(t,e,n),t=t.sibling}function Zc(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Zc(t,e,n),t=t.sibling;t!==null;)Zc(t,e,n),t=t.sibling}var Le=null,It=!1;function kn(t,e,n){for(n=n.child;n!==null;)ym(t,e,n),n=n.sibling}function ym(t,e,n){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(Qo,n)}catch{}switch(n.tag){case 5:We||Di(n,e);case 6:var i=Le,r=It;Le=null,kn(t,e,n),Le=i,It=r,Le!==null&&(It?(t=Le,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Le.removeChild(n.stateNode));break;case 18:Le!==null&&(It?(t=Le,n=n.stateNode,t.nodeType===8?La(t.parentNode,n):t.nodeType===1&&La(t,n),Jr(t)):La(Le,n.stateNode));break;case 4:i=Le,r=It,Le=n.stateNode.containerInfo,It=!0,kn(t,e,n),Le=i,It=r;break;case 0:case 11:case 14:case 15:if(!We&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Qc(n,e,o),r=r.next}while(r!==i)}kn(t,e,n);break;case 1:if(!We&&(Di(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ke(n,e,a)}kn(t,e,n);break;case 21:kn(t,e,n);break;case 22:n.mode&1?(We=(i=We)||n.memoizedState!==null,kn(t,e,n),We=i):kn(t,e,n);break;default:kn(t,e,n)}}function Zd(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new z0),e.forEach(function(i){var r=X0.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function _t(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Le=a.stateNode,It=!1;break e;case 3:Le=a.stateNode.containerInfo,It=!0;break e;case 4:Le=a.stateNode.containerInfo,It=!0;break e}a=a.return}if(Le===null)throw Error(O(160));ym(s,o,r),Le=null,It=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){ke(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)km(e,t),e=e.sibling}function km(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(_t(e,t),Bt(t),i&4){try{Ar(3,t,t.return),ra(3,t)}catch(p){ke(t,t.return,p)}try{Ar(5,t,t.return)}catch(p){ke(t,t.return,p)}}break;case 1:_t(e,t),Bt(t),i&512&&n!==null&&Di(n,n.return);break;case 5:if(_t(e,t),Bt(t),i&512&&n!==null&&Di(n,n.return),t.flags&32){var r=t.stateNode;try{Wr(r,"")}catch(p){ke(t,t.return,p)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Vf(r,s),bc(a,o);var l=bc(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?Kf(r,d):u==="dangerouslySetInnerHTML"?Wf(r,d):u==="children"?Wr(r,d):Fl(r,u,d,l)}switch(a){case"input":yc(r,s);break;case"textarea":zf(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var v=s.value;v!=null?Fi(r,!!s.multiple,v,!1):h!==!!s.multiple&&(s.defaultValue!=null?Fi(r,!!s.multiple,s.defaultValue,!0):Fi(r,!!s.multiple,s.multiple?[]:"",!1))}r[Zr]=s}catch(p){ke(t,t.return,p)}}break;case 6:if(_t(e,t),Bt(t),i&4){if(t.stateNode===null)throw Error(O(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(p){ke(t,t.return,p)}}break;case 3:if(_t(e,t),Bt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Jr(e.containerInfo)}catch(p){ke(t,t.return,p)}break;case 4:_t(e,t),Bt(t);break;case 13:_t(e,t),Bt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(vu=Te())),i&4&&Zd(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(We=(l=We)||u,_t(e,t),We=l):_t(e,t),Bt(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(j=t,u=t.child;u!==null;){for(d=j=u;j!==null;){switch(h=j,v=h.child,h.tag){case 0:case 11:case 14:case 15:Ar(4,h,h.return);break;case 1:Di(h,h.return);var C=h.stateNode;if(typeof C.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(p){ke(i,n,p)}}break;case 5:Di(h,h.return);break;case 22:if(h.memoizedState!==null){th(d);continue}}v!==null?(v.return=h,j=v):th(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Hf("display",o))}catch(p){ke(t,t.return,p)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(p){ke(t,t.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:_t(e,t),Bt(t),i&4&&Zd(t);break;case 21:break;default:_t(e,t),Bt(t)}}function Bt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(vm(n)){var i=n;break e}n=n.return}throw Error(O(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Wr(r,""),i.flags&=-33);var s=Xd(t);Zc(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Xd(t);Xc(t,a,o);break;default:throw Error(O(161))}}catch(c){ke(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function W0(t,e,n){j=t,Sm(t)}function Sm(t,e,n){for(var i=(t.mode&1)!==0;j!==null;){var r=j,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Os;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||We;a=Os;var l=We;if(Os=o,(We=c)&&!l)for(j=r;j!==null;)o=j,c=o.child,o.tag===22&&o.memoizedState!==null?nh(r):c!==null?(c.return=o,j=c):nh(r);for(;s!==null;)j=s,Sm(s),s=s.sibling;j=r,Os=a,We=l}eh(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,j=s):eh(t)}}function eh(t){for(;j!==null;){var e=j;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:We||ra(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!We)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Rt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Fd(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Fd(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Jr(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}We||e.flags&512&&Yc(e)}catch(h){ke(e,e.return,h)}}if(e===t){j=null;break}if(n=e.sibling,n!==null){n.return=e.return,j=n;break}j=e.return}}function th(t){for(;j!==null;){var e=j;if(e===t){j=null;break}var n=e.sibling;if(n!==null){n.return=e.return,j=n;break}j=e.return}}function nh(t){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ra(4,e)}catch(c){ke(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){ke(e,r,c)}}var s=e.return;try{Yc(e)}catch(c){ke(e,s,c)}break;case 5:var o=e.return;try{Yc(e)}catch(c){ke(e,o,c)}}}catch(c){ke(e,e.return,c)}if(e===t){j=null;break}var a=e.sibling;if(a!==null){a.return=e.return,j=a;break}j=e.return}}var H0=Math.ceil,Io=vn.ReactCurrentDispatcher,mu=vn.ReactCurrentOwner,bt=vn.ReactCurrentBatchConfig,ee=0,Ne=null,Ee=null,je=0,ut=0,Ni=Gn(0),xe=0,ss=null,di=0,sa=0,gu=0,Lr=null,tt=null,vu=0,ir=1/0,Zt=null,xo=!1,el=null,Ln=null,Ds=!1,In=null,Mo=0,Ur=0,tl=null,Gs=-1,Js=0;function $e(){return ee&6?Te():Gs!==-1?Gs:Gs=Te()}function Un(t){return t.mode&1?ee&2&&je!==0?je&-je:R0.transition!==null?(Js===0&&(Js=rp()),Js):(t=oe,t!==0||(t=window.event,t=t===void 0?16:dp(t.type)),t):1}function Ut(t,e,n,i){if(50<Ur)throw Ur=0,tl=null,Error(O(185));ps(t,n,i),(!(ee&2)||t!==Ne)&&(t===Ne&&(!(ee&2)&&(sa|=n),xe===4&&_n(t,je)),at(t,i),n===1&&ee===0&&!(e.mode&1)&&(ir=Te()+500,ta&&Jn()))}function at(t,e){var n=t.callbackNode;Ry(t,e);var i=po(t,t===Ne?je:0);if(i===0)n!==null&&dd(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&dd(n),e===1)t.tag===0?P0(ih.bind(null,t)):xp(ih.bind(null,t)),b0(function(){!(ee&6)&&Jn()}),n=null;else{switch(sp(i)){case 1:n=ql;break;case 4:n=np;break;case 16:n=fo;break;case 536870912:n=ip;break;default:n=fo}n=Rm(n,Cm.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Cm(t,e){if(Gs=-1,Js=0,ee&6)throw Error(O(327));var n=t.callbackNode;if(qi()&&t.callbackNode!==n)return null;var i=po(t,t===Ne?je:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Oo(t,i);else{e=i;var r=ee;ee|=2;var s=bm();(Ne!==t||je!==e)&&(Zt=null,ir=Te()+500,oi(t,e));do try{J0();break}catch(a){Tm(t,a)}while(!0);nu(),Io.current=s,ee=r,Ee!==null?e=0:(Ne=null,je=0,e=xe)}if(e!==0){if(e===2&&(r=Rc(t),r!==0&&(i=r,e=nl(t,r))),e===1)throw n=ss,oi(t,0),_n(t,i),at(t,Te()),n;if(e===6)_n(t,i);else{if(r=t.current.alternate,!(i&30)&&!K0(r)&&(e=Oo(t,i),e===2&&(s=Rc(t),s!==0&&(i=s,e=nl(t,s))),e===1))throw n=ss,oi(t,0),_n(t,i),at(t,Te()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(O(345));case 2:ei(t,tt,Zt);break;case 3:if(_n(t,i),(i&130023424)===i&&(e=vu+500-Te(),10<e)){if(po(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){$e(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Lc(ei.bind(null,t,tt,Zt),e);break}ei(t,tt,Zt);break;case 4:if(_n(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Lt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Te()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*H0(i/1960))-i,10<i){t.timeoutHandle=Lc(ei.bind(null,t,tt,Zt),i);break}ei(t,tt,Zt);break;case 5:ei(t,tt,Zt);break;default:throw Error(O(329))}}}return at(t,Te()),t.callbackNode===n?Cm.bind(null,t):null}function nl(t,e){var n=Lr;return t.current.memoizedState.isDehydrated&&(oi(t,e).flags|=256),t=Oo(t,e),t!==2&&(e=tt,tt=n,e!==null&&il(e)),t}function il(t){tt===null?tt=t:tt.push.apply(tt,t)}function K0(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Ft(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _n(t,e){for(e&=~gu,e&=~sa,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Lt(e),i=1<<n;t[n]=-1,e&=~i}}function ih(t){if(ee&6)throw Error(O(327));qi();var e=po(t,0);if(!(e&1))return at(t,Te()),null;var n=Oo(t,e);if(t.tag!==0&&n===2){var i=Rc(t);i!==0&&(e=i,n=nl(t,i))}if(n===1)throw n=ss,oi(t,0),_n(t,e),at(t,Te()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ei(t,tt,Zt),at(t,Te()),null}function yu(t,e){var n=ee;ee|=1;try{return t(e)}finally{ee=n,ee===0&&(ir=Te()+500,ta&&Jn())}}function hi(t){In!==null&&In.tag===0&&!(ee&6)&&qi();var e=ee;ee|=1;var n=bt.transition,i=oe;try{if(bt.transition=null,oe=1,t)return t()}finally{oe=i,bt.transition=n,ee=e,!(ee&6)&&Jn()}}function ku(){ut=Ni.current,de(Ni)}function oi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,T0(n)),Ee!==null)for(n=Ee.return;n!==null;){var i=n;switch(Zl(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&ko();break;case 3:tr(),de(st),de(He),cu();break;case 5:au(i);break;case 4:tr();break;case 13:de(me);break;case 19:de(me);break;case 10:iu(i.type._context);break;case 22:case 23:ku()}n=n.return}if(Ne=t,Ee=t=Fn(t.current,null),je=ut=e,xe=0,ss=null,gu=sa=di=0,tt=Lr=null,ri!==null){for(e=0;e<ri.length;e++)if(n=ri[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}ri=null}return t}function Tm(t,e){do{var n=Ee;try{if(nu(),Ws.current=Ro,Po){for(var i=ge.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Po=!1}if(ui=0,Me=Re=ge=null,Nr=!1,ns=0,mu.current=null,n===null||n.return===null){xe=1,ss=e,Ee=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=je,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var v=Wd(o);if(v!==null){v.flags&=-257,Hd(v,o,a,s,e),v.mode&1&&qd(s,l,e),e=v,c=l;var C=e.updateQueue;if(C===null){var p=new Set;p.add(c),e.updateQueue=p}else C.add(c);break e}else{if(!(e&1)){qd(s,l,e),Su();break e}c=Error(O(426))}}else if(fe&&a.mode&1){var w=Wd(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Hd(w,o,a,s,e),eu(nr(c,a));break e}}s=c=nr(c,a),xe!==4&&(xe=2),Lr===null?Lr=[s]:Lr.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=sm(s,c,e);Ud(s,g);break e;case 1:a=c;var y=s.type,f=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(Ln===null||!Ln.has(f)))){s.flags|=65536,e&=-e,s.lanes|=e;var m=om(s,a,e);Ud(s,m);break e}}s=s.return}while(s!==null)}Em(n)}catch(k){e=k,Ee===n&&n!==null&&(Ee=n=n.return);continue}break}while(!0)}function bm(){var t=Io.current;return Io.current=Ro,t===null?Ro:t}function Su(){(xe===0||xe===3||xe===2)&&(xe=4),Ne===null||!(di&268435455)&&!(sa&268435455)||_n(Ne,je)}function Oo(t,e){var n=ee;ee|=2;var i=bm();(Ne!==t||je!==e)&&(Zt=null,oi(t,e));do try{G0();break}catch(r){Tm(t,r)}while(!0);if(nu(),ee=n,Io.current=i,Ee!==null)throw Error(O(261));return Ne=null,je=0,xe}function G0(){for(;Ee!==null;)wm(Ee)}function J0(){for(;Ee!==null&&!ky();)wm(Ee)}function wm(t){var e=Pm(t.alternate,t,ut);t.memoizedProps=t.pendingProps,e===null?Em(t):Ee=e,mu.current=null}function Em(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=V0(n,e),n!==null){n.flags&=32767,Ee=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xe=6,Ee=null;return}}else if(n=B0(n,e,ut),n!==null){Ee=n;return}if(e=e.sibling,e!==null){Ee=e;return}Ee=e=t}while(e!==null);xe===0&&(xe=5)}function ei(t,e,n){var i=oe,r=bt.transition;try{bt.transition=null,oe=1,$0(t,e,n,i)}finally{bt.transition=r,oe=i}return null}function $0(t,e,n,i){do qi();while(In!==null);if(ee&6)throw Error(O(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Iy(t,s),t===Ne&&(Ee=Ne=null,je=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ds||(Ds=!0,Rm(fo,function(){return qi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=bt.transition,bt.transition=null;var o=oe;oe=1;var a=ee;ee|=4,mu.current=null,q0(t,n),km(n,t),m0(Nc),mo=!!Dc,Nc=Dc=null,t.current=n,W0(n),Sy(),ee=a,oe=o,bt.transition=s}else t.current=n;if(Ds&&(Ds=!1,In=t,Mo=r),s=t.pendingLanes,s===0&&(Ln=null),by(n.stateNode),at(t,Te()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(xo)throw xo=!1,t=el,el=null,t;return Mo&1&&t.tag!==0&&qi(),s=t.pendingLanes,s&1?t===tl?Ur++:(Ur=0,tl=t):Ur=0,Jn(),null}function qi(){if(In!==null){var t=sp(Mo),e=bt.transition,n=oe;try{if(bt.transition=null,oe=16>t?16:t,In===null)var i=!1;else{if(t=In,In=null,Mo=0,ee&6)throw Error(O(331));var r=ee;for(ee|=4,j=t.current;j!==null;){var s=j,o=s.child;if(j.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(j=l;j!==null;){var u=j;switch(u.tag){case 0:case 11:case 15:Ar(8,u,s)}var d=u.child;if(d!==null)d.return=u,j=d;else for(;j!==null;){u=j;var h=u.sibling,v=u.return;if(gm(u),u===l){j=null;break}if(h!==null){h.return=v,j=h;break}j=v}}}var C=s.alternate;if(C!==null){var p=C.child;if(p!==null){C.child=null;do{var w=p.sibling;p.sibling=null,p=w}while(p!==null)}}j=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,j=o;else e:for(;j!==null;){if(s=j,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ar(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,j=g;break e}j=s.return}}var y=t.current;for(j=y;j!==null;){o=j;var f=o.child;if(o.subtreeFlags&2064&&f!==null)f.return=o,j=f;else e:for(o=y;j!==null;){if(a=j,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ra(9,a)}}catch(k){ke(a,a.return,k)}if(a===o){j=null;break e}var m=a.sibling;if(m!==null){m.return=a.return,j=m;break e}j=a.return}}if(ee=r,Jn(),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(Qo,t)}catch{}i=!0}return i}finally{oe=n,bt.transition=e}}return!1}function rh(t,e,n){e=nr(n,e),e=sm(t,e,1),t=An(t,e,1),e=$e(),t!==null&&(ps(t,1,e),at(t,e))}function ke(t,e,n){if(t.tag===3)rh(t,t,n);else for(;e!==null;){if(e.tag===3){rh(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Ln===null||!Ln.has(i))){t=nr(n,t),t=om(e,t,1),e=An(e,t,1),t=$e(),e!==null&&(ps(e,1,t),at(e,t));break}}e=e.return}}function Q0(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=$e(),t.pingedLanes|=t.suspendedLanes&n,Ne===t&&(je&n)===n&&(xe===4||xe===3&&(je&130023424)===je&&500>Te()-vu?oi(t,0):gu|=n),at(t,e)}function _m(t,e){e===0&&(t.mode&1?(e=bs,bs<<=1,!(bs&130023424)&&(bs=4194304)):e=1);var n=$e();t=pn(t,e),t!==null&&(ps(t,e,n),at(t,n))}function Y0(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),_m(t,n)}function X0(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(O(314))}i!==null&&i.delete(e),_m(t,n)}var Pm;Pm=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||st.current)it=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return it=!1,j0(t,e,n);it=!!(t.flags&131072)}else it=!1,fe&&e.flags&1048576&&Mp(e,To,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ks(t,e),t=e.pendingProps;var r=Xi(e,He.current);zi(e,n),r=uu(null,e,i,t,r,n);var s=du();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ot(i)?(s=!0,So(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,su(e),r.updater=ia,e.stateNode=r,r._reactInternals=e,qc(e,i,t,n),e=Kc(null,e,i,!0,s,n)):(e.tag=0,fe&&s&&Xl(e),Ke(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ks(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=ek(i),t=Rt(i,t),r){case 0:e=Hc(null,e,i,t,n);break e;case 1:e=Jd(null,e,i,t,n);break e;case 11:e=Kd(null,e,i,t,n);break e;case 14:e=Gd(null,e,i,Rt(i.type,t),n);break e}throw Error(O(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Rt(i,r),Hc(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Rt(i,r),Jd(t,e,i,r,n);case 3:e:{if(um(e),t===null)throw Error(O(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Up(t,e),Eo(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=nr(Error(O(423)),e),e=$d(t,e,i,n,r);break e}else if(i!==r){r=nr(Error(O(424)),e),e=$d(t,e,i,n,r);break e}else for(dt=Nn(e.stateNode.containerInfo.firstChild),ft=e,fe=!0,Mt=null,n=Ap(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Zi(),i===r){e=mn(t,e,n);break e}Ke(t,e,i,n)}e=e.child}return e;case 5:return Fp(e),t===null&&Bc(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Ac(i,r)?o=null:s!==null&&Ac(i,s)&&(e.flags|=32),lm(t,e),Ke(t,e,o,n),e.child;case 6:return t===null&&Bc(e),null;case 13:return dm(t,e,n);case 4:return ou(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=er(e,null,i,n):Ke(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Rt(i,r),Kd(t,e,i,r,n);case 7:return Ke(t,e,e.pendingProps,n),e.child;case 8:return Ke(t,e,e.pendingProps.children,n),e.child;case 12:return Ke(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,le(bo,i._currentValue),i._currentValue=o,s!==null)if(Ft(s.value,o)){if(s.children===r.children&&!st.current){e=mn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=dn(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Vc(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Vc(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ke(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,zi(e,n),r=wt(r),i=i(r),e.flags|=1,Ke(t,e,i,n),e.child;case 14:return i=e.type,r=Rt(i,e.pendingProps),r=Rt(i.type,r),Gd(t,e,i,r,n);case 15:return am(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Rt(i,r),Ks(t,e),e.tag=1,ot(i)?(t=!0,So(e)):t=!1,zi(e,n),rm(e,i,r),qc(e,i,r,n),Kc(null,e,i,!0,t,n);case 19:return hm(t,e,n);case 22:return cm(t,e,n)}throw Error(O(156,e.tag))};function Rm(t,e){return tp(t,e)}function Z0(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ct(t,e,n,i){return new Z0(t,e,n,i)}function Cu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ek(t){if(typeof t=="function")return Cu(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Bl)return 11;if(t===Vl)return 14}return 2}function Fn(t,e){var n=t.alternate;return n===null?(n=Ct(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function $s(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Cu(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case wi:return ai(n.children,r,s,e);case jl:o=8,r|=8;break;case fc:return t=Ct(12,n,e,r|2),t.elementType=fc,t.lanes=s,t;case pc:return t=Ct(13,n,e,r),t.elementType=pc,t.lanes=s,t;case mc:return t=Ct(19,n,e,r),t.elementType=mc,t.lanes=s,t;case Ff:return oa(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Lf:o=10;break e;case Uf:o=9;break e;case Bl:o=11;break e;case Vl:o=14;break e;case bn:o=16,i=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=Ct(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function ai(t,e,n,i){return t=Ct(7,t,i,e),t.lanes=n,t}function oa(t,e,n,i){return t=Ct(22,t,i,e),t.elementType=Ff,t.lanes=n,t.stateNode={isHidden:!1},t}function Wa(t,e,n){return t=Ct(6,t,null,e),t.lanes=n,t}function Ha(t,e,n){return e=Ct(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function tk(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ea(0),this.expirationTimes=Ea(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ea(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Tu(t,e,n,i,r,s,o,a,c){return t=new tk(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Ct(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},su(s),t}function nk(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:bi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Im(t){if(!t)return qn;t=t._reactInternals;e:{if(vi(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ot(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(ot(n))return Ip(t,n,e)}return e}function xm(t,e,n,i,r,s,o,a,c){return t=Tu(n,i,!0,t,r,s,o,a,c),t.context=Im(null),n=t.current,i=$e(),r=Un(n),s=dn(i,r),s.callback=e??null,An(n,s,r),t.current.lanes=r,ps(t,r,i),at(t,i),t}function aa(t,e,n,i){var r=e.current,s=$e(),o=Un(r);return n=Im(n),e.context===null?e.context=n:e.pendingContext=n,e=dn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=An(r,e,o),t!==null&&(Ut(t,r,o,s),qs(t,r,o)),o}function Do(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function sh(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function bu(t,e){sh(t,e),(t=t.alternate)&&sh(t,e)}function ik(){return null}var Mm=typeof reportError=="function"?reportError:function(t){console.error(t)};function wu(t){this._internalRoot=t}ca.prototype.render=wu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));aa(t,e,null,null)};ca.prototype.unmount=wu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;hi(function(){aa(null,t,null,null)}),e[fn]=null}};function ca(t){this._internalRoot=t}ca.prototype.unstable_scheduleHydration=function(t){if(t){var e=cp();t={blockedOn:null,target:t,priority:e};for(var n=0;n<En.length&&e!==0&&e<En[n].priority;n++);En.splice(n,0,t),n===0&&up(t)}};function Eu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function la(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function oh(){}function rk(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=Do(o);s.call(l)}}var o=xm(e,i,t,0,null,!1,!1,"",oh);return t._reactRootContainer=o,t[fn]=o.current,Yr(t.nodeType===8?t.parentNode:t),hi(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=Do(c);a.call(l)}}var c=Tu(t,0,!1,null,null,!1,!1,"",oh);return t._reactRootContainer=c,t[fn]=c.current,Yr(t.nodeType===8?t.parentNode:t),hi(function(){aa(e,c,n,i)}),c}function ua(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=Do(o);a.call(c)}}aa(e,o,t,r)}else o=rk(n,e,t,r,i);return Do(o)}op=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Er(e.pendingLanes);n!==0&&(Wl(e,n|1),at(e,Te()),!(ee&6)&&(ir=Te()+500,Jn()))}break;case 13:hi(function(){var i=pn(t,1);if(i!==null){var r=$e();Ut(i,t,1,r)}}),bu(t,1)}};Hl=function(t){if(t.tag===13){var e=pn(t,134217728);if(e!==null){var n=$e();Ut(e,t,134217728,n)}bu(t,134217728)}};ap=function(t){if(t.tag===13){var e=Un(t),n=pn(t,e);if(n!==null){var i=$e();Ut(n,t,e,i)}bu(t,e)}};cp=function(){return oe};lp=function(t,e){var n=oe;try{return oe=t,e()}finally{oe=n}};Ec=function(t,e,n){switch(e){case"input":if(yc(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=ea(i);if(!r)throw Error(O(90));Bf(i),yc(i,r)}}}break;case"textarea":zf(t,n);break;case"select":e=n.value,e!=null&&Fi(t,!!n.multiple,e,!1)}};$f=yu;Qf=hi;var sk={usingClientEntryPoint:!1,Events:[gs,Ri,ea,Gf,Jf,yu]},gr={findFiberByHostInstance:ii,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ok={bundleType:gr.bundleType,version:gr.version,rendererPackageName:gr.rendererPackageName,rendererConfig:gr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Zf(t),t===null?null:t.stateNode},findFiberByHostInstance:gr.findFiberByHostInstance||ik,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ns=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ns.isDisabled&&Ns.supportsFiber)try{Qo=Ns.inject(ok),Ht=Ns}catch{}}mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sk;mt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Eu(e))throw Error(O(200));return nk(t,e,null,n)};mt.createRoot=function(t,e){if(!Eu(t))throw Error(O(299));var n=!1,i="",r=Mm;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Tu(t,1,!1,null,null,n,!1,i,r),t[fn]=e.current,Yr(t.nodeType===8?t.parentNode:t),new wu(e)};mt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=Zf(e),t=t===null?null:t.stateNode,t};mt.flushSync=function(t){return hi(t)};mt.hydrate=function(t,e,n){if(!la(e))throw Error(O(200));return ua(null,t,e,!0,n)};mt.hydrateRoot=function(t,e,n){if(!Eu(t))throw Error(O(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Mm;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=xm(e,null,t,1,n??null,r,!1,s,o),t[fn]=e.current,Yr(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new ca(e)};mt.render=function(t,e,n){if(!la(e))throw Error(O(200));return ua(null,t,e,!1,n)};mt.unmountComponentAtNode=function(t){if(!la(t))throw Error(O(40));return t._reactRootContainer?(hi(function(){ua(null,null,t,!1,function(){t._reactRootContainer=null,t[fn]=null})}),!0):!1};mt.unstable_batchedUpdates=yu;mt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!la(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return ua(t,e,n,!1,i)};mt.version="18.3.1-next-f1338f8080-20240426";function Om(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Om)}catch(t){console.error(t)}}Om(),Of.exports=mt;var ak=Of.exports,ah=ak;dc.createRoot=ah.createRoot,dc.hydrateRoot=ah.hydrateRoot;var ch={};function ck(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var lk=Object.defineProperty,uk=(t,e,n)=>e in t?lk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lh=(t,e,n)=>uk(t,typeof e!="symbol"?e+"":e,n);let Qe=class{constructor(){lh(this,"_locking"),lh(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function Se(t,e){if(!t)throw new Error(e)}const dk=34028234663852886e22,hk=-34028234663852886e22,fk=4294967295,pk=2147483647,mk=-2147483648;function Qs(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>pk||t<mk)throw new Error("invalid int 32: "+t)}function rl(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>fk||t<0)throw new Error("invalid uint 32: "+t)}function Dm(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>dk||t<hk))throw new Error("invalid float 32: "+t)}const Nm=Symbol("@bufbuild/protobuf/enum-type");function gk(t){const e=t[Nm];return Se(e,"missing enum type on enum object"),e}function Am(t,e,n,i){t[Nm]=Lm(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Lm(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=Um(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function vk(t,e,n){const i={};for(const r of e){const s=Um(r);i[s.localName]=s.no,i[s.no]=s.localName}return Am(i,t,e),i}function Um(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class _u{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function yk(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new _u),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function kk(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Ka(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Ys=4294967296;function uh(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Ys&&(r=r+(i/Ys|0),i=i%Ys)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?jm(i,r):Pu(i,r)}function Sk(t,e){let n=Pu(t,e);const i=n.hi&2147483648;i&&(n=jm(n.lo,n.hi));const r=Fm(n.lo,n.hi);return i?"-"+r:r}function Fm(t,e){if({lo:t,hi:e}=Ck(t,e),e<=2097151)return String(Ys*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+dh(o)+dh(s)}function Ck(t,e){return{lo:t>>>0,hi:e>>>0}}function Pu(t,e){return{lo:t|0,hi:e|0}}function jm(t,e){return e=~e,t?t=~t+1:e+=1,Pu(t,e)}const dh=t=>{const e=String(t);return"0000000".slice(e.length)+e};function hh(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Tk(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function bk(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof ch!="object"||ch.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>Se(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Se(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),uh(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),uh(r)},dec(r,s){return Sk(r,s)},uDec(r,s){return Fm(r,s)}}}const pe=bk();var I;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(I||(I={}));var Wn;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Wn||(Wn={}));function Sn(t,e,n){if(e===n)return!0;if(t==I.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==n}return!1}function rr(t,e){switch(t){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==0?pe.zero:"0";case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}function Bm(t,e){switch(t){case I.BOOL:return e===!1;case I.STRING:return e==="";case I.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var be;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(be||(be={}));class wk{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(rl(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Qs(e),hh(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Dm(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){rl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Qs(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Qs(e),e=(e<<1^e>>31)>>>0,hh(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=pe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=pe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=pe.enc(e);return Ka(n.lo,n.hi,this.buf),this}sint64(e){let n=pe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Ka(r,s,this.buf),this}uint64(e){let n=pe.uEnc(e);return Ka(n.lo,n.hi,this.buf),this}}class Ek{constructor(e,n){this.varint64=kk,this.uint32=Tk,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case be.Varint:for(;this.buf[this.pos++]&128;);break;case be.Bit64:this.pos+=4;case be.Bit32:this.pos+=4;break;case be.LengthDelimited:let r=this.uint32();this.pos+=r;break;case be.StartGroup:for(;;){const[s,o]=this.tag();if(o===be.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return pe.dec(...this.varint64())}uint64(){return pe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,pe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return pe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return pe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function _k(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function Vm(t){const e=t.field.localName,n=Object.create(null);return n[e]=Pk(t),[n,()=>n[e]]}function Pk(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return rr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Rk(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),da=[];for(let t=0;t<rn.length;t++)da[rn[t].charCodeAt(0)]=t;da[45]=rn.indexOf("+");da[95]=rn.indexOf("/");const zm={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=da[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=rn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=rn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=rn[r|i>>6],e+=rn[i&63],n=0;break}return n&&(e+=rn[r],e+="=",n==1&&(e+="=")),e}};function Ik(t,e,n){Wm(e,t);const i=e.runtime.bin.makeReadOptions(n),r=Rk(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Vm(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function xk(t,e,n,i){Wm(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(qm(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function qm(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function Wm(t,e){Se(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Hm(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Bm(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function fh(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?rr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function sn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(_u.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Km(t,e){return sn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}I.DOUBLE,I.FLOAT,I.INT64,I.UINT64,I.INT32,I.UINT32,I.BOOL,I.STRING,I.BYTES;const ph={ignoreUnknownFields:!1},mh={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Mk(t){return t?Object.assign(Object.assign({},ph),t):ph}function Ok(t){return t?Object.assign(Object.assign({},mh),t):mh}const No=Symbol(),Xs=Symbol();function Dk(){return{makeReadOptions:Mk,makeWriteOptions:Ok,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(qt(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}gh(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=Vm(u);gh(d,a,u.field,n,u),xk(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Hm(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Ak(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=vh(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&qm(t,a)){const c=Ik(t,a,e),l=vh(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Fr(t,e,n??Wn.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Bm(t,e)))return Zs(t,e)},debug:qt}}function qt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function gh(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Se(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Ga(n.T,a,i.ignoreUnknownFields,!0);c!==Xs&&o.push(c);break;case"scalar":try{o.push(Fr(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=Nk(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=Ga(n.V.T,c,i.ignoreUnknownFields,!0);u!==Xs&&(o[l]=u);break;case"scalar":try{o[l]=Fr(n.V.T,c,Wn.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];sn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Ga(n.T,e,i.ignoreUnknownFields,!1);switch(c){case No:fh(n,t);break;case Xs:break;default:t[s]=c;break}break;case"scalar":try{const l=Fr(n.T,e,n.L,!1);switch(l){case No:fh(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(qt(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function Nk(t,e){if(t===I.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Fr(t,e,Wn.BIGINT,!0).toString()}function Fr(t,e,n,i){if(e===null)return i?rr(t,n):No;switch(t){case I.DOUBLE:case I.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==I.FLOAT&&Dm(r),r;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==I.UINT32||t==I.FIXED32?rl(s):Qs(s),s;case I.INT64:case I.SFIXED64:case I.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=pe.parse(e);return n?o.toString():o;case I.FIXED64:case I.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=pe.uParse(e);return n?a.toString():a;case I.BOOL:if(typeof e!="boolean")break;return e;case I.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case I.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return zm.dec(e)}throw new Error}function Ga(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:No;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Xs;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(qt(e)))}function Ak(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function vh(t,e,n){if(t.kind=="map"){Se(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Zs(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Ja(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Se(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Zs(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Ja(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Zs(t.T,e);case"enum":return Ja(t.T,e,n.enumAsInteger);case"message":return Km(t.T,e).toJson(n)}}function Ja(t,e,n){var i;if(Se(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Zs(t,e){switch(t){case I.INT32:case I.SFIXED32:case I.SINT32:case I.FIXED32:case I.UINT32:return Se(typeof e=="number"),e;case I.FLOAT:case I.DOUBLE:return Se(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case I.STRING:return Se(typeof e=="string"),e;case I.BOOL:return Se(typeof e=="boolean"),e;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return Se(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case I.BYTES:return Se(e instanceof Uint8Array),zm.enc(e)}}const Ci=Symbol("@bufbuild/protobuf/unknown-fields"),yh={readUnknownFields:!0,readerFactory:t=>new Ek(t)},kh={writeUnknownFields:!0,writerFactory:()=>new wk};function Lk(t){return t?Object.assign(Object.assign({},yh),t):yh}function Uk(t){return t?Object.assign(Object.assign({},kh),t):kh}function Fk(){return{makeReadOptions:Lk,makeWriteOptions:Uk,listUnknownFields(t){var e;return(e=t[Ci])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Ci]},writeUnknownFields(t,e){const i=t[Ci];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Ci])||(r[Ci]=[]),r[Ci].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==be.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Sh(t,e,l,c,i)}if(r&&(c!=be.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Sh,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!Hm(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Ch(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Ch(t,e,n,i)}}}function Sh(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?I.INT32:n.T;let c=Ao;if(n.kind=="scalar"&&n.L>0&&(c=Bk),s){let h=t[o];if(i==be.LengthDelimited&&a!=I.STRING&&a!=I.BYTES){let C=e.uint32()+e.pos;for(;e.pos<C;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(eo(e,new l,r,n)):sn(t[o])?eo(e,t[o],r,n):(t[o]=eo(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=jk(n,e,r);t[o][u]=d;break}}function eo(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function jk(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=Ao(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=Ao(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=eo(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=rr(t.K,Wn.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=rr(t.V.T,Wn.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function Bk(t,e){const n=Ao(t,e);return typeof n=="bigint"?n.toString():n}function Ao(t,e){switch(e){case I.STRING:return t.string();case I.BOOL:return t.bool();case I.DOUBLE:return t.double();case I.FLOAT:return t.float();case I.INT32:return t.int32();case I.INT64:return t.int64();case I.UINT64:return t.uint64();case I.FIXED64:return t.fixed64();case I.BYTES:return t.bytes();case I.FIXED32:return t.fixed32();case I.SFIXED32:return t.sfixed32();case I.SFIXED64:return t.sfixed64();case I.SINT64:return t.sint64();case I.UINT32:return t.uint32();case I.SINT32:return t.sint32()}}function Ch(t,e,n,i){Se(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?I.INT32:t.T;if(r)if(Se(Array.isArray(e)),t.packed)zk(n,s,t.no,e);else for(const o of e)jr(n,s,t.no,o);else jr(n,s,t.no,e);break;case"message":if(r){Se(Array.isArray(e));for(const o of e)Th(n,i,t,o)}else Th(n,i,t,e);break;case"map":Se(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))Vk(n,i,t,o,a);break}}function Vk(t,e,n,i,r){t.tag(n.no,be.LengthDelimited),t.fork();let s=i;switch(n.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:s=Number.parseInt(i);break;case I.BOOL:Se(i=="true"||i=="false"),s=i=="true";break}switch(jr(t,n.K,1,s),n.V.kind){case"scalar":jr(t,n.V.T,2,r);break;case"enum":jr(t,I.INT32,2,r);break;case"message":Se(r!==void 0),t.tag(2,be.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Th(t,e,n,i){const r=Km(n.T,i);n.delimited?t.tag(n.no,be.StartGroup).raw(r.toBinary(e)).tag(n.no,be.EndGroup):t.tag(n.no,be.LengthDelimited).bytes(r.toBinary(e))}function jr(t,e,n,i){Se(i!==void 0);let[r,s]=Gm(e);t.tag(n,r)[s](i)}function zk(t,e,n,i){if(!i.length)return;t.tag(n,be.LengthDelimited).fork();let[,r]=Gm(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function Gm(t){let e=be.Varint;switch(t){case I.BYTES:case I.STRING:e=be.LengthDelimited;break;case I.DOUBLE:case I.FIXED64:case I.SFIXED64:e=be.Bit64;break;case I.FIXED32:case I.SFIXED32:case I.FLOAT:e=be.Bit32;break}const n=I[t].toLowerCase();return[e,n]}function qk(){return{setEnumType:Am,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!sn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===I.BYTES&&(l=vr(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===I.BYTES&&(u=i.repeated?u.map(vr):vr(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===I.BYTES)for(const[v,C]of Object.entries(o[r]))s[r][v]=vr(C);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const v of Object.keys(o[r])){let C=o[r][v];h.fieldWrapper||(C=new h(C)),s[r][v]=C}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>sn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=vr(h):s[r]=h:s[r]=sn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>Sn(i.T,o,s[a]));case"enum":return r.every((o,a)=>Sn(I.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!sn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!sn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return Sn(I.INT32,r,s);case"scalar":return Sn(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return Sn(I.INT32,r.value,s.value);case"scalar":return Sn(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(h=>u.equals(r[h],s[h]));case"enum":return l.every(h=>Sn(I.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return l.every(h=>Sn(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(As);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=As(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:As(s.value)}:{case:void 0}:o=As(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function As(t){if(t===void 0)return t;if(sn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function vr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Wk(t,e,n){return{syntax:t,json:Dk(),bin:Fk(),util:Object.assign(Object.assign({},qk()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return yk(this,i,r,s)},makeEnum:vk,makeEnumType:Lm,getEnumType:gk,makeExtension(i,r,s){return _k(this,i,r,s)}}}class Hk{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Jm(t,e){const n=$m(t);return e?n:Yk(Qk(n))}function Kk(t){return Jm(t,!1)}const Gk=$m;function $m(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const Jk=new Set(["constructor","toString","toJSON","valueOf"]),$k=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Qm=t=>"".concat(t,"$"),Qk=t=>$k.has(t)?Qm(t):t,Yk=t=>Jk.has(t)?Qm(t):t;class Xk{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Kk(e)}addField(e){Se(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function Zk(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=Jm(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:Gk(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:Wn.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=I.BYTES&&u.T!=I.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new Xk(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const b=Wk("proto3",t=>new Hk(t,e=>Zk(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=rr(e.T,e.L);break}}});class nt extends _u{constructor(e){super(),this.seconds=pe.zero,this.nanos=0,b.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(b.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=pe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return nt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new nt({seconds:pe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new nt().fromBinary(e,n)}static fromJson(e,n){return new nt().fromJson(e,n)}static fromJsonString(e,n){return new nt().fromJsonString(e,n)}static equals(e,n){return b.util.equals(nt,e,n)}}nt.runtime=b;nt.typeName="google.protobuf.Timestamp";nt.fields=b.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const eS=b.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:nt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:tS,repeated:!0},{no:5,name:"events",kind:"message",T:iS,repeated:!0}]),tS=b.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:nS,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),nS=b.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:nt},{no:3,name:"value",kind:"scalar",T:2}]),iS=b.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:nt},{no:7,name:"normalized_end_timestamp",kind:"message",T:nt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Ym=b.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ot=b.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),we=b.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ru=b.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Pr=b.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),os=b.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),At=b.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ti=b.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),rS=b.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Oe=b.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),ha=b.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Lo,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:ug}]),Lo=b.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),sS=b.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:b.getEnumType(we),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),fi=b.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:b.getEnumType(Wi)},{no:4,name:"tracks",kind:"message",T:Ai,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:sS},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:b.getEnumType(as)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:b.getEnumType(At)},{no:18,name:"kind_details",kind:"enum",T:b.getEnumType(oS),repeated:!0}]),Wi=b.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),as=b.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),oS=b.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Ie=b.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),aS=b.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:jn,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:b.getEnumType(Xm)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Ai=b.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:b.getEnumType(Ot)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:b.getEnumType(we)},{no:10,name:"layers",kind:"message",T:jn,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:aS,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:b.getEnumType(Ie)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:ug},{no:19,name:"audio_features",kind:"enum",T:b.getEnumType(Oe),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:b.getEnumType(Ym)}]),jn=b.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:b.getEnumType(Ru)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Xm=b.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Je=b.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:b.getEnumType($)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Iu,oneof:"value"},{no:3,name:"speaker",kind:"message",T:cS,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:ng,oneof:"value"},{no:7,name:"transcription",kind:"message",T:lS,oneof:"value"},{no:8,name:"metrics",kind:"message",T:eS,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Uo,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:xu,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Mu,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Ou,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Fo,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:jo,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Bo,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Zm,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),$=b.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Zm=b.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:b.getEnumType(Ie)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),eg=b.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Iu,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Uo,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:xu,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Mu,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Ou,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Fo,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:jo,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Bo,oneof:"value"}]),cS=b.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:tg,repeated:!0}]),tg=b.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Iu=b.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),ng=b.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),lS=b.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:uS,repeated:!0}]),uS=b.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Uo=b.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),xu=b.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Mu=b.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Ou=b.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:ig,oneof:"value"}]),ig=b.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),rg=b.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),sg=b.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:b.getEnumType(og)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),og=b.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ag=b.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:b.getEnumType(cg)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),cg=b.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),lg=b.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:bh},{no:2,name:"screen",kind:"message",T:bh},{no:3,name:"resume_connection",kind:"enum",T:b.getEnumType(os)},{no:4,name:"disabled_codecs",kind:"message",T:dS},{no:5,name:"force_relay",kind:"enum",T:b.getEnumType(os)}]),bh=b.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:b.getEnumType(os)}]),dS=b.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Lo,repeated:!0},{no:2,name:"publish",kind:"message",T:Lo,repeated:!0}]),ug=b.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),sl=b.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),dg=b.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:b.getEnumType(sl)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),hg=b.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Fo=b.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:b.getEnumType(Ie)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:dg,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:hg,oneof:"content_header"}],{localName:"DataStream_Header"}),jo=b.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Bo=b.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),hS=b.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Dt=b.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ol=b.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),fS=b.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),pS=b.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Hn,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:fa,oneof:"message"},{no:4,name:"add_track",kind:"message",T:cs,oneof:"message"},{no:5,name:"mute",kind:"message",T:pa,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ma,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:fg,oneof:"message"},{no:8,name:"leave",kind:"message",T:ga,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:mg,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:yg,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Uu,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Vt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Au,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Cg,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Nu,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:pg,oneof:"message"}]),wh=b.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:mS,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hn,oneof:"message"},{no:3,name:"offer",kind:"message",T:Hn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:fa,oneof:"message"},{no:5,name:"update",kind:"message",T:yS,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Du,oneof:"message"},{no:8,name:"leave",kind:"message",T:ga,oneof:"message"},{no:9,name:"mute",kind:"message",T:pa,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:kS,oneof:"message"},{no:11,name:"room_update",kind:"message",T:SS,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:TS,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:wS,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:_S,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:RS,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:vS,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:gS,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:xS,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:DS,oneof:"message"},{no:22,name:"request_response",kind:"message",T:NS,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:AS,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:IS,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:jS,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:PS,oneof:"message"}]),al=b.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:jn,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:b.getEnumType(Xm)}]),cs=b.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:b.getEnumType(Ot)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:b.getEnumType(we)},{no:9,name:"layers",kind:"message",T:jn,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:al,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:b.getEnumType(Ie)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:b.getEnumType(Ym)},{no:17,name:"audio_features",kind:"enum",T:b.getEnumType(Oe),repeated:!0}]),fa=b.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:b.getEnumType(Dt)},{no:3,name:"final",kind:"scalar",T:8}]),pa=b.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),mS=b.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:ha},{no:2,name:"participant",kind:"message",T:fi},{no:3,name:"other_participants",kind:"message",T:fi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:gg,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:lg},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:sg},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Lo,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),gS=b.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:gg,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:lg},{no:3,name:"server_info",kind:"message",T:sg},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Du=b.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ai}]),vS=b.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Hn=b.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),yS=b.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:fi,repeated:!0}]),ma=b.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:rg,repeated:!0}]),fg=b.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:b.getEnumType(Ru)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Nu=b.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:b.getEnumType(Oe),repeated:!0}]),pg=b.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ga=b.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:b.getEnumType(At)},{no:3,name:"action",kind:"enum",T:b.getEnumType(Hi)},{no:4,name:"regions",kind:"message",T:MS}]),Hi=b.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),mg=b.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:jn,repeated:!0}]),Au=b.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),gg=b.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),kS=b.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:tg,repeated:!0}]),SS=b.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:ha}]),CS=b.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:b.getEnumType(Pr)},{no:3,name:"score",kind:"scalar",T:2}]),TS=b.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:CS,repeated:!0}]),bS=b.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:b.getEnumType(ol)}]),wS=b.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:bS,repeated:!0}]),Lu=b.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:b.getEnumType(Ru)},{no:2,name:"enabled",kind:"scalar",T:8}]),ES=b.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Lu,repeated:!0}]),_S=b.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Lu,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:ES,repeated:!0}]),PS=b.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:hS,repeated:!0}]),vg=b.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),yg=b.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:vg,repeated:!0}]),RS=b.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),IS=b.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:ha},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:fi},{no:4,name:"other_participants",kind:"message",T:fi,repeated:!0}]),Uu=b.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Hn},{no:2,name:"subscription",kind:"message",T:ma},{no:3,name:"publish_tracks",kind:"message",T:Du,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Sg,repeated:!0},{no:5,name:"offer",kind:"message",T:Hn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:kg,repeated:!0}]),kg=b.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Sg=b.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:b.getEnumType(Dt)}]),Vt=b.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:b.getEnumType(fS),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Cg=b.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),xS=b.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),MS=b.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:OS,repeated:!0}]),OS=b.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),DS=b.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:b.getEnumType(rS)}]),NS=b.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:b.getEnumType(Fu)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:fa,oneof:"request"},{no:5,name:"add_track",kind:"message",T:cs,oneof:"request"},{no:6,name:"mute",kind:"message",T:pa,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Au,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Nu,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:pg,oneof:"request"}]),Fu=b.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),AS=b.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Tg=b.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),LS=b.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:ag},{no:2,name:"connection_settings",kind:"message",T:Tg},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:cs,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Hn},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:b.getEnumType(ti)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Uu}]),US=b.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:b.getEnumType(FS)},{no:2,name:"join_request",kind:"scalar",T:12}]),FS=b.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),jS=b.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function BS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var to={exports:{}},VS=to.exports,Eh;function zS(){return Eh||(Eh=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(VS,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(p,w){var g=p[w];if(typeof g.bind=="function")return g.bind(p);try{return Function.prototype.bind.call(g,p)}catch{return function(){return Function.prototype.apply.apply(g,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?c:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function u(){for(var p=this.getLevel(),w=0;w<r.length;w++){var g=r[w];this[g]=w<p?e:this.methodFactory(g,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function d(p){return function(){typeof console!==n&&(u.call(this),this[p].apply(this,arguments))}}function h(p,w,g){return l(p)||d.apply(this,arguments)}function v(p,w){var g=this,y,f,m,k="loglevel";typeof p=="string"?k+=":"+p:typeof p=="symbol"&&(k=void 0);function T(N){var W=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=W;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+W+";"}catch{}}}function E(){var N;if(!(typeof window===n||!k)){try{N=window.localStorage[k]}catch{}if(typeof N===n)try{var W=window.document.cookie,ie=encodeURIComponent(k),q=W.indexOf(ie+"=");q!==-1&&(N=/^([^;]+)/.exec(W.slice(q+ie.length+1))[1])}catch{}return g.levels[N]===void 0&&(N=void 0),N}}function _(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function x(N){var W=N;if(typeof W=="string"&&g.levels[W.toUpperCase()]!==void 0&&(W=g.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=g.levels.SILENT)return W;throw new TypeError("log.setLevel() called with invalid level: "+N)}g.name=p,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=w||h,g.getLevel=function(){return m??f??y},g.setLevel=function(N,W){return m=x(N),W!==!1&&T(m),u.call(g)},g.setDefaultLevel=function(N){f=x(N),E()||g.setLevel(N,!1)},g.resetLevel=function(){m=null,_(),u.call(g)},g.enableAll=function(N){g.setLevel(g.levels.TRACE,N)},g.disableAll=function(N){g.setLevel(g.levels.SILENT,N)},g.rebuild=function(){if(o!==g&&(y=x(o.getLevel())),u.call(g),o===g)for(var N in s)s[N].rebuild()},y=x(o?o.getLevel():"WARN");var P=E();P!=null&&(m=x(P)),u.call(g)}o=new v,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var g=s[w];return g||(g=s[w]=new v(w,o.methodFactory)),g};var C=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=C),o},o.getLoggers=function(){return s},o.default=o,o})}(to)),to.exports}var va=zS(),cl;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(cl||(cl={}));var jt;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(jt||(jt={}));let G=va.getLogger("livekit");Object.values(jt).map(t=>va.getLogger(t));G.setDefaultLevel(cl.info);function gn(t){const e=va.getLogger(t);return e.setDefaultLevel(G.getLevel()),e}const qS=va.getLogger("lk-e2ee"),yr=7e3,WS=[0,300,2*2*300,3*3*300,4*4*300,yr,yr,yr,yr,yr];class HS{constructor(e){this._retryDelays=e!==void 0?[...e]:WS}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function KS(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function S(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function _h(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function on(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof _h=="function"?_h(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var Ls={exports:{}},Ph;function GS(){if(Ph)return Ls.exports;Ph=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,T,E){return Function.prototype.apply.call(k,T,E)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function i(m){console&&console.warn&&console.warn(m)}var r=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}Ls.exports=s,Ls.exports.once=g,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(m){if(typeof m!="number"||m<0||r(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");o=m}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(m){return m._maxListeners===void 0?s.defaultMaxListeners:m._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(k){for(var T=[],E=1;E<arguments.length;E++)T.push(arguments[E]);var _=k==="error",x=this._events;if(x!==void 0)_=_&&x.error===void 0;else if(!_)return!1;if(_){var P;if(T.length>0&&(P=T[0]),P instanceof Error)throw P;var N=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw N.context=P,N}var W=x[k];if(W===void 0)return!1;if(typeof W=="function")e(W,this,T);else for(var ie=W.length,q=C(W,ie),E=0;E<ie;++E)e(q[E],this,T);return!0};function l(m,k,T,E){var _,x,P;if(a(T),x=m._events,x===void 0?(x=m._events=Object.create(null),m._eventsCount=0):(x.newListener!==void 0&&(m.emit("newListener",k,T.listener?T.listener:T),x=m._events),P=x[k]),P===void 0)P=x[k]=T,++m._eventsCount;else if(typeof P=="function"?P=x[k]=E?[T,P]:[P,T]:E?P.unshift(T):P.push(T),_=c(m),_>0&&P.length>_&&!P.warned){P.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=m,N.type=k,N.count=P.length,i(N)}return m}s.prototype.addListener=function(k,T){return l(this,k,T,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,T){return l(this,k,T,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(m,k,T){var E={fired:!1,wrapFn:void 0,target:m,type:k,listener:T},_=u.bind(E);return _.listener=T,E.wrapFn=_,_}s.prototype.once=function(k,T){return a(T),this.on(k,d(this,k,T)),this},s.prototype.prependOnceListener=function(k,T){return a(T),this.prependListener(k,d(this,k,T)),this},s.prototype.removeListener=function(k,T){var E,_,x,P,N;if(a(T),_=this._events,_===void 0)return this;if(E=_[k],E===void 0)return this;if(E===T||E.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete _[k],_.removeListener&&this.emit("removeListener",k,E.listener||T));else if(typeof E!="function"){for(x=-1,P=E.length-1;P>=0;P--)if(E[P]===T||E[P].listener===T){N=E[P].listener,x=P;break}if(x<0)return this;x===0?E.shift():p(E,x),E.length===1&&(_[k]=E[0]),_.removeListener!==void 0&&this.emit("removeListener",k,N||T)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var T,E,_;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[k]),this;if(arguments.length===0){var x=Object.keys(E),P;for(_=0;_<x.length;++_)P=x[_],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=E[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(_=T.length-1;_>=0;_--)this.removeListener(k,T[_]);return this};function h(m,k,T){var E=m._events;if(E===void 0)return[];var _=E[k];return _===void 0?[]:typeof _=="function"?T?[_.listener||_]:[_]:T?w(_):C(_,_.length)}s.prototype.listeners=function(k){return h(this,k,!0)},s.prototype.rawListeners=function(k){return h(this,k,!1)},s.listenerCount=function(m,k){return typeof m.listenerCount=="function"?m.listenerCount(k):v.call(m,k)},s.prototype.listenerCount=v;function v(m){var k=this._events;if(k!==void 0){var T=k[m];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function C(m,k){for(var T=new Array(k),E=0;E<k;++E)T[E]=m[E];return T}function p(m,k){for(;k+1<m.length;k++)m[k]=m[k+1];m.pop()}function w(m){for(var k=new Array(m.length),T=0;T<k.length;++T)k[T]=m[T].listener||m[T];return k}function g(m,k){return new Promise(function(T,E){function _(P){m.removeListener(k,x),E(P)}function x(){typeof m.removeListener=="function"&&m.removeListener("error",_),T([].slice.call(arguments))}f(m,k,x,{once:!0}),k!=="error"&&y(m,_,{once:!0})})}function y(m,k,T){typeof m.on=="function"&&f(m,"error",k,T)}function f(m,k,T,E){if(typeof m.on=="function")E.once?m.once(k,T):m.on(k,T);else if(typeof m.addEventListener=="function")m.addEventListener(k,function _(x){E.once&&m.removeEventListener(k,_),T(x)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m)}return Ls.exports}var Qt=GS();let bg=!0,wg=!0;function Rr(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function yi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function JS(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(bg=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function $S(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(wg=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Eg(){if(typeof window=="object"){if(bg)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ju(t,e){wg&&console.warn(t+" is deprecated, please use "+e+" instead.")}function QS(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Rr(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Rr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Rr(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Rr(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Rh(t){return Object.prototype.toString.call(t)==="[object Object]"}function _g(t){return Rh(t)?Object.keys(t).reduce(function(e,n){const i=Rh(t[n]),r=i?_g(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function ll(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?ll(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{ll(t,t.get(r),n)})}))}function Ih(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&ll(t,a,r)})}),r}const xh=Eg;function Pg(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,v){return h?h+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(C=>C.kind==="videoinput");let v=h.find(C=>d.some(p=>C.label.toLowerCase().includes(p)));return!v&&h.length&&d.includes("back")&&(v=h[h.length-1]),v&&(a.video.deviceId=l.exact?{exact:v.deviceId}:{ideal:v.deviceId}),a.video=i(a.video),xh("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return xh("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Rg(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Ig(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else yi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function xg(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Mg(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>Ih(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),yi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Ih(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Og(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Dg(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Og(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(v=>v.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(p=>p===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[d.id];if(C)C.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([u]);this._streams[d.id]=p,this._reverseStreams[p.id]=d,this.addStream(p)}return this.getSenders().find(p=>p.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const v=l._reverseStreams[h],C=l._streams[v.id];d=d.replace(new RegExp(C.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const v=l._reverseStreams[h],C=l._streams[v.id];d=d.replace(new RegExp(v.id,"g"),C.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[C=>{const p=s(this,C);h[0].apply(null,[p])},C=>{h[1]&&h[1].apply(null,C)},arguments[2]]):u.apply(this,arguments).then(C=>s(this,C))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(p=>u.track===p)&&(h=this._streams[v])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ul(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function Ng(t,e){yi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Mh=Object.freeze({__proto__:null,fixNegotiationNeeded:Ng,shimAddTrackRemoveTrack:Dg,shimAddTrackRemoveTrackWithNative:Og,shimGetSendersWithDtmf:xg,shimGetUserMedia:Pg,shimMediaStream:Rg,shimOnTrack:Ig,shimPeerConnection:ul,shimSenderReceiverGetStats:Mg});function Ag(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){ju("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function YS(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function Lg(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dl(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function Ug(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Fg(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),yi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function jg(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){ju("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Bg(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Vg(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function zg(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function qg(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Wg(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Oh=Object.freeze({__proto__:null,shimAddTransceiver:Vg,shimCreateAnswer:Wg,shimCreateOffer:qg,shimGetDisplayMedia:YS,shimGetParameters:zg,shimGetUserMedia:Ag,shimOnTrack:Lg,shimPeerConnection:dl,shimRTCDataChannel:Bg,shimReceiverGetStats:Fg,shimRemoveStream:jg,shimSenderGetStats:Ug});function Hg(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function Kg(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function Gg(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function Jg(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i($g(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function $g(t){return t&&t.video!==void 0?Object.assign({},t,{video:_g(t.video)}):t}function Qg(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(ju("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Yg(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xg(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Zg(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Dh=Object.freeze({__proto__:null,shimAudioContext:Zg,shimCallbacksAPI:Gg,shimConstraints:$g,shimCreateOfferLegacy:Xg,shimGetUserMedia:Jg,shimLocalStreamsAPI:Hg,shimRTCIceServerUrls:Qg,shimRemoteStreamsAPI:Kg,shimTrackEventTransceiver:Yg}),$a={exports:{}},Nh;function XS(){return Nh||(Nh=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(C=>parseInt(C,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let v={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(v.rtx={ssrc:l}),i.push(v),s&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(v))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}($a)),$a.exports}var ev=XS(),Ki=BS(ev),ZS=ck({__proto__:null,default:Ki},[ev]);function no(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Ki.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,yi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function hl(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||yi(t,"icecandidate",e=>{if(e.candidate){const n=Ki.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function io(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Ki.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Ki.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Ki.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function ro(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},yi(t,"datachannel",i=>(e(i.channel,i.target),i))}function fl(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function pl(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function so(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function oo(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var eC=Object.freeze({__proto__:null,removeExtmapAllowMixed:pl,shimAddIceCandidateNullOrEmpty:so,shimConnectionState:fl,shimMaxMessageSize:io,shimParameterlessSetLocalDescription:oo,shimRTCIceCandidate:no,shimRTCIceCandidateRelayProtocol:hl,shimSendThrowTypeError:ro});function tC(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Eg,i=QS(t),r={browserDetails:i,commonShim:eC,extractVersion:Rr,disableLog:JS,disableWarnings:$S,sdp:ZS};switch(i.browser){case"chrome":if(!Mh||!ul||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Mh,so(t,i),oo(t),Pg(t,i),Rg(t),ul(t,i),Ig(t),Dg(t,i),xg(t),Mg(t),Ng(t,i),no(t),hl(t),fl(t),io(t,i),ro(t),pl(t,i);break;case"firefox":if(!Oh||!dl||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Oh,so(t,i),oo(t),Ag(t,i),dl(t,i),Lg(t),jg(t),Ug(t),Fg(t),Bg(t),Vg(t),zg(t),qg(t),Wg(t),no(t),fl(t),io(t,i),ro(t);break;case"safari":if(!Dh||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Dh,so(t,i),oo(t),Qg(t),Xg(t),Gg(t),Hg(t),Kg(t),Yg(t),Jg(t),Zg(t),no(t),hl(t),io(t,i),ro(t),pl(t,i);break;default:n("Unsupported browser!");break}return r}tC({window:typeof window>"u"?void 0:window});const nC=10,kr="lk_e2ee",iC="LKFrameEncryptionKey",rC={sharedKey:!1,ratchetSalt:iC,ratchetWindowSize:8,failureTolerance:nC,keyringSize:16};var Bn;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Bn||(Bn={}));var Ah;(function(t){t.KeyRatcheted="keyRatcheted"})(Ah||(Ah={}));var xn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(xn||(xn={}));var Lh;(function(t){t.Error="cryptorError"})(Lh||(Lh={}));function sC(){return oC()||ml()}function ml(){return typeof window.RTCRtpScriptTransform<"u"}function oC(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function aC(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new eg({value:t.value})}class jb extends Qt.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{G.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},rC),e),this.on(Bn.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Bn.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Bn.RatchetRequest,e,n)}}class yn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var H;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(H||(H={}));class X extends yn{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=H[n]}}class Bu extends yn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class an extends yn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class cC extends yn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Pe extends yn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class gl extends yn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Uh extends yn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Fh extends yn{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Fu[n]}}var Ge;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Ge||(Ge={}));class yt extends yn{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Ge[n]}}var Vo;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Vo||(Vo={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Vo||(Vo={}));var jh;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(jh||(jh={}));var M;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(M||(M={}));var L;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(L||(L={}));var A;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(A||(A={}));var D;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(D||(D={}));function lC(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const uC=/version\/(\d+(\.?_?\d+)+)/i;let Qa;function ct(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Qa===void 0||e){const i=dC.find(r=>{let{test:s}=r;return s.test(n)});Qa=i==null?void 0:i.describe(n)}return Qa}const dC=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:ao(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Ya(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:ao(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Ya(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:ao(uC,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Ya(t)}}}];function ao(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Ya(t){return t.includes("mac os")?ao(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var hC="2.16.0";const fC=hC,pC=16;class Ue{}Ue.setTimeout=function(){return setTimeout(...arguments)};Ue.setInterval=function(){return setInterval(...arguments)};Ue.clearTimeout=function(){return clearTimeout(...arguments)};Ue.clearInterval=function(){return clearInterval(...arguments)};const mC=5e3,Sr=[];var ht;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(ht||(ht={}));class R extends Qt.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=R.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=G,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),mC):this.handleAppVisibilityChanged()},this.log=gn((r=i.loggerName)!==null&&r!==void 0?r:jt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=R.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),J(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===R.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===R.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Sr.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Sr.splice(Sr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Li(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?D.AudioPlaybackStarted:D.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?D.AudioPlaybackFailed:D.VideoPlaybackFailed,s):s.name==="AbortError"?G.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):G.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(D.ElementAttached,e),e}detach(e){try{if(e){Gi(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(D.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Gi(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(D.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=gn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Sr.forEach(i=>{i.parentElement||(n=!1)}),n&&Sr.push(e)}}handleAppVisibilityChanged(){return S(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===R.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){rt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){rt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Li(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!mi()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(mi()||pi())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Gi(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Ot.AUDIO;case e.Video:return Ot.VIDEO;default:return Ot.DATA}}t.kindToProto=r;function s(l){switch(l){case Ot.AUDIO:return e.Audio;case Ot.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return we.CAMERA;case n.Microphone:return we.MICROPHONE;case n.ScreenShare:return we.SCREEN_SHARE;case n.ScreenShareAudio:return we.SCREEN_SHARE_AUDIO;default:return we.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case we.CAMERA:return n.Camera;case we.MICROPHONE:return n.Microphone;case we.SCREEN_SHARE:return n.ScreenShare;case we.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case ol.ACTIVE:return i.Active;case ol.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(R||(R={}));class ae{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const gC=["vp8","h264"],vC=["vp8","h264","vp9","av1","h265"];function yC(t){return!!gC.find(e=>e===t)}const kC=yC;var Bh;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Bh||(Bh={}));var vl;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(vl||(vl={}));const ls={h90:new ae(160,90,9e4,20),h180:new ae(320,180,16e4,20),h216:new ae(384,216,18e4,20),h360:new ae(640,360,45e4,20),h540:new ae(960,540,8e5,25),h720:new ae(1280,720,17e5,30),h1080:new ae(1920,1080,3e6,30),h1440:new ae(2560,1440,5e6,30),h2160:new ae(3840,2160,8e6,30)},yl={h120:new ae(160,120,7e4,20),h180:new ae(240,180,125e3,20),h240:new ae(320,240,14e4,20),h360:new ae(480,360,33e4,20),h480:new ae(640,480,5e5,20),h540:new ae(720,540,6e5,25),h720:new ae(960,720,13e5,30),h1080:new ae(1440,1080,23e5,30),h1440:new ae(1920,1440,38e5,30)},Vu={h360fps3:new ae(640,360,2e5,3,"medium"),h360fps15:new ae(640,360,4e5,15,"medium"),h720fps5:new ae(1280,720,8e5,5,"medium"),h720fps15:new ae(1280,720,15e5,15,"medium"),h720fps30:new ae(1280,720,2e6,30,"medium"),h1080fps15:new ae(1920,1080,25e5,15,"medium"),h1080fps30:new ae(1920,1080,5e6,30,"medium"),original:new ae(0,0,7e6,30,"medium")},SC="|",Vh="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function CC(t){const e=t.split(SC);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Fe(t){return S(this,void 0,void 0,function*(){return new Promise(e=>Ue.setTimeout(e,t))})}function kl(){return"addTransceiver"in RTCPeerConnection.prototype}function Sl(){return"addTrack"in RTCPeerConnection.prototype}function TC(){if(!("getCapabilities"in RTCRtpSender)||mi()||pi())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function bC(){if(!("getCapabilities"in RTCRtpSender)||pi())return!1;if(mi()){const n=ct();if(n!=null&&n.version&&$t(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&$t(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Nt(t){return t==="av1"||t==="vp9"}function Cl(t){return!document||us()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function wC(){return typeof RTCPeerConnection>"u"?!1:kl()||Sl()}function pi(){var t;return((t=ct())===null||t===void 0?void 0:t.name)==="Firefox"}function zh(){const t=ct();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function mi(){var t;return((t=ct())===null||t===void 0?void 0:t.name)==="Safari"}function us(){const t=ct();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function EC(){const t=ct();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&$t(t.osVersion,"17")>=0}function _C(t){return t||(t=ct()),(t==null?void 0:t.name)==="Safari"&&$t(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&$t(t.osVersion,"18.3")>0}function tv(){var t,e;return rt()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function PC(){const t=ct(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&$t(t.osVersion,e)>=0?!0:t.name==="Safari"&&$t(t.version,e)>=0}function rt(){return typeof document<"u"}function Jt(){return navigator.product=="ReactNative"}function zo(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Xa(t){return zo(t)?t.hostname.split(".")[0]:null}function nv(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function iv(){if(!Jt())return;let t=nv();if(t)return t.platform}function qh(){if(rt())return window.devicePixelRatio;if(Jt()){let t=nv();if(t)return t.devicePixelRatio}return 1}function $t(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function RC(t){for(const e of t)e.target.handleResize(e)}function IC(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Za=null;const Wh=()=>(Za||(Za=new ResizeObserver(RC)),Za);let ec=null;const Hh=()=>(ec||(ec=new IntersectionObserver(IC,{root:null,rootMargin:"0px"})),ec);function xC(){var t;const e=new ag({sdk:cg.JS,protocol:pC,version:fC});return Jt()&&(e.os=(t=iv())!==null&&t!==void 0?t:""),e}function Kh(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Cr;function tc(){if(!Cr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Cr]=i.stream.getAudioTracks(),!Cr)throw Error("Could not get empty media stream audio track");Cr.enabled=!1}return Cr.clone()}class Tt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>S(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function MC(t){return vC.includes(t)}function Vn(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function OC(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function ds(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function DC(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function NC(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Gh(t){switch(t.reason){case H.LeaveRequest:return t.context;case H.Cancelled:return At.CLIENT_INITIATED;case H.NotAllowed:return At.USER_REJECTED;case H.ServerUnreachable:return At.JOIN_FAILURE;default:return At.UNKNOWN_REASON}}function co(t){return t!==void 0?Number(t):void 0}function ni(t){return t!==void 0?BigInt(t):void 0}function Ji(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Gt(t){return!!t&&t.kind==R.Kind.Audio}function $n(t){return!!t&&t.kind==R.Kind.Video}function Cn(t){return Ji(t)&&$n(t)}function Xt(t){return Ji(t)&&Gt(t)}function Tl(t){return!!t&&!t.isLocal}function AC(t){return!!t&&!t.isLocal}function nc(t){return Tl(t)&&$n(t)}function LC(t){return t.isLocal}function UC(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function FC(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function rv(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=av(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(bl(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(bl(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function bl(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function zu(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":bl(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function sv(t){return S(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=ov();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Fe(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function ov(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>S(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function jC(t){return t==="audioinput"?R.Source.Microphone:t==="videoinput"?R.Source.Camera:R.Source.Unknown}function wl(t){return t===R.Source.Microphone?"audioinput":t===R.Source.Camera?"videoinput":void 0}function BC(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,mi()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Br(t){return t.split("/")[1].toLowerCase()}function VC(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Du({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function J(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?J(t.track):{})}}function zC(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function qC(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function av(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:lC(e)}}function WC(t){switch(t){case we.CAMERA:return R.Source.Camera;case we.MICROPHONE:return R.Source.Microphone;case we.SCREEN_SHARE:return R.Source.ScreenShare;case we.SCREEN_SHARE_AUDIO:return R.Source.ScreenShareAudio;default:return R.Source.Unknown}}function Jh(t,e){return t.width*t.height<e.width*e.height}function HC(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class KC extends Qt.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(G.error(a.error.message),a.uuid){const u=this.decryptDataRequests.get(a.uuid);if(u!=null&&u.reject){u.reject(a.error);break}const d=this.encryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}}this.emit(xn.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(xn.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(xn.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Bn.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break;case"encryptDataResponse":const l=this.encryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break}},this.onWorkerError=i=>{G.error("e2ee worker encountered an error:",{error:i.error}),this.emit(xn.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!sC())throw new Bu("tried to setup end-to-end encryption on an unsupported browser");if(G.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:qS.getLevel()}};this.worker&&(G.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){G.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?G.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(A.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(M.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Ie.NONE,r.identity)),e.on(M.ConnectionStateChanged,i=>{i===ne.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Ie.NONE,r.identity)})})}).on(M.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(M.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(M.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(L.LocalSenderCreated,(i,r)=>S(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(L.LocalTrackPublished,i=>{if(!$n(i.track)||!us())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Br(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Bn.SetKey,i=>this.postKey(i)).on(Bn.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return S(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Tt;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new Tt;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Br(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Ji(e)||!n){n||G.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return S(this,void 0,void 0,function*(){if(this.worker){if(ml()&&!zh()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(kr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:kr in e}};this.worker.postMessage(a,[o,s])}e[kr]=!0}})}handleSender(e,n,i){var r;if(!(kr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(ml()&&!zh()){G.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{G.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[kr]=!0}}}const GC=500,JC=15e3;class $i{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new $i),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=Xa(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,Fe(Math.min(GC*Math.pow(2,s),JC)))}getBackOffPromise(e){const n=new URL(e),i=n&&Xa(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Xa(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}$i._instance=null;const ic="default";class De{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new De),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=De.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){G.debug("awaiting getUserMedia promise");try{n?yield De.userMediaPromiseMap.get(n):yield Promise.all(De.userMediaPromiseMap.values())}catch{G.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(mi()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return S(this,void 0,void 0,function*(){if(n!==ic)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===ic);if(!s){G.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==ic&&a.groupId===(i??s.groupId));if(!o){G.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?De.userMediaPromiseMap.has(e):De.userMediaPromiseMap.size>0}}De.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];De.userMediaPromiseMap=new Map;var Vr;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Vr||(Vr={}));class $C{constructor(){this.pendingTasks=new Map,this.taskMutex=new Qe,this.nextTaskIndex=0}run(e){return S(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Vr.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Vr.RUNNING,yield e()}finally{n.status=Vr.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return S(this,void 0,void 0,function*(){return this.run(()=>S(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class QC{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new Promise((a,c)=>{s.onopen=()=>{a({readable:new ReadableStream({start(l){s.onmessage=u=>{let{data:d}=u;return l.enqueue(d)},s.onerror=u=>l.error(u)},cancel:o}),writable:new WritableStream({write(l){s.send(l)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Promise((a,c)=>{const l=()=>S(this,void 0,void 0,function*(){const u=new Promise(h=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",v=>{h(v)},{once:!0})}),d=yield Promise.race([Fe(250),u]);d?a(d):c(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:h}=u;a({closeCode:d,reason:h}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}function YC(t,e){const n=new URL(OC(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),cv(n,"rtc")}function XC(t){const e=new URL(ds(t));return cv(e,"validate")}function ZC(t){return t.endsWith("/")?t:"".concat(t,"/")}function cv(t,e){return t.pathname="".concat(ZC(t.pathname)).concat(e),t.toString()}function $h(t){if(typeof t=="string")return wh.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return wh.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function eT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const tT=["syncState","trickle","offer","answer","simulate","leave"];function nT(t){const e=tT.indexOf(t.case)>=0;return G.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var ce;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(ce||(ce={}));const iT=250;class qu{get currentState(){return this.state}get isDisconnected(){return this.state===ce.DISCONNECTING||this.state===ce.DISCONNECTED}get isEstablishingConnection(){return this.state===ce.CONNECTING||this.state===ce.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=ce.DISCONNECTED,this.log=G,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=gn((i=n.loggerName)!==null&&i!==void 0?i:jt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new $C,this.queuedRequests=[],this.closingLock=new Qe,this.connectionLock=new Qe,this.state=ce.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return S(this,void 0,void 0,function*(){return this.state=ce.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return S(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=ce.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return S(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=i;const o=xC(),a=i.singlePeerConnection?sT(n,o,i):rT(n,o,i),c=YC(e,a),l=XC(c);return new Promise((u,d)=>S(this,void 0,void 0,function*(){var h,v;try{let C=!1;const p=m=>S(this,void 0,void 0,function*(){if(C)return;C=!0;const k=m instanceof Event?m.currentTarget:m,T=eT(k,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(T)).catch(E=>{this.log.error(E),this.close()}):this.close(),w(),d(k instanceof AbortSignal?k.reason:k)});r==null||r.addEventListener("abort",p);const w=()=>{clearTimeout(g),r==null||r.removeEventListener("abort",p)},g=setTimeout(()=>{p(new X("room connection has timed out (signal)",H.ServerUnreachable))},i.websocketTimeout),y=(m,k)=>{this.handleSignalConnected(m,g,k)},f=new URL(c);f.searchParams.has("access_token")&&f.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(f),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new QC(c);try{this.ws.closed.then(P=>{var N;this.isEstablishingConnection&&d(new X("Websocket got closed during a (re)connection attempt: ".concat(P.reason),H.InternalError)),P.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:P.reason,code:P.closeCode,wasClean:P.closeCode===1e3,state:this.state})),this.state===ce.CONNECTED&&this.handleOnClose((N=P.reason)!==null&&N!==void 0?N:"Unexpected WS error"))}).catch(P=>{this.isEstablishingConnection&&d(new X("Websocket error during a (re)connection attempt: ".concat(P),H.InternalError))});const m=yield this.ws.opened.catch(P=>S(this,void 0,void 0,function*(){if(this.state!==ce.CONNECTED){this.state=ce.DISCONNECTED,clearTimeout(g);const N=yield this.handleConnectionError(P,l);d(N);return}this.handleWSError(P),d(P)}));if(clearTimeout(g),!m)return;const k=m.readable.getReader();this.streamWriter=m.writable.getWriter();const T=yield k.read();if(k.releaseLock(),!T.value)throw new X("no message received as first message",H.InternalError);const E=$h(T.value),_=this.validateFirstMessage(E,(h=i.reconnect)!==null&&h!==void 0?h:!1);if(!_.isValid){d(_.error);return}((v=E.message)===null||v===void 0?void 0:v.case)==="join"&&(this.pingTimeoutDuration=E.message.value.pingTimeout,this.pingIntervalDuration=E.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const x=_.shouldProcessFirstMessage?E:void 0;y(m,x),u(_.response)}catch(m){d(m)}finally{w()}}finally{s()}}))})}startReadingLoop(e,n){return S(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Fe(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=$h(r);this.handleSignalResponse(s)}})}close(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([ce.DISCONNECTING||ce.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=ce.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,Fe(iT)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=ce.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ui(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ui(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new fa({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new pa({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new Au({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new mg({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new yg({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:pe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Cg({timestamp:pe.parse(Date.now()),rtt:pe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Nu({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new ga({reason:At.CLIENT_INITIATED,action:Hi.DISCONNECT})})}sendRequest(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!nT(n)&&i.state===ce.RECONNECTING){i.queuedRequests.push(()=>S(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Fe(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new pS({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=Qh(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=Qh(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return S(this,void 0,void 0,function*(){if(this.state===ce.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ue.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ue.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ue.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ue.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=ce.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===ce.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:new X("Received leave request while trying to (re)connect",H.LeaveRequest,void 0,e.message.value.reason)}:n?{isValid:!1,error:new X("Unexpected first message",H.InternalError)}:{isValid:!1,error:new X("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"),H.InternalError)}}handleConnectionError(e,n){return S(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return new X(r,H.NotAllowed,i.status)}else return e instanceof X?e:new X("Encountered unknown websocket error during connection: ".concat(e),H.InternalError,i.status)}catch(i){return i instanceof X?i:new X(i instanceof Error?i.message:"server was not reachable",H.ServerUnreachable)}})}}function Qh(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Ui(t,e){return new Hn({sdp:t.sdp,type:t.type,id:e})}function rT(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Jt()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function sT(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new LS({clientInfo:e,connectionSettings:new Tg({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new US({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class Yh{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class oT{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Pt={},rc={},sc={exports:{}},Xh;function Wu(){if(Xh)return sc.exports;Xh=1;var t=sc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),sc.exports}var Zh;function aT(){return Zh||(Zh=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=Wu(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],v=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var C=0;C<(r[h]||[]).length;C+=1){var p=r[h][C];if(p.reg.test(v))return i(p,u,v)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(rc)),rc}var oc,ef;function cT(){if(ef)return oc;ef=1;var t=Wu(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return oc=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(v){u.push(i(d,h,v))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(v){v.name in d&&d[v.name]!=null?u.push(i(h,v,d)):v.push in d&&d[v.push]!=null&&d[v.push].forEach(function(C){u.push(i(h,v,C))})})})}),u.join(`\r
`)+`\r
`},oc}var tf;function lT(){if(tf)return Pt;tf=1;var t=aT(),e=cT(),n=Wu();return Pt.grammar=n,Pt.write=e,Pt.parse=t.parse,Pt.parseParams=t.parseParams,Pt.parseFmtpConfig=t.parseFmtpConfig,Pt.parsePayloads=t.parsePayloads,Pt.parseRemoteCandidates=t.parseRemoteCandidates,Pt.parseImageAttributes=t.parseImageAttributes,Pt.parseSimulcastStreamList=t.parseSimulcastStreamList,Pt}var Tn=lT();function Hu(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var v=Date.now()-l;if(v+e>=c)return c-v}return e}var h=function(){var v=[].slice.call(arguments),C=this;return new Promise(function(p,w){var g=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var f=t.apply(C,v);a&&a(f),u.forEach(function(m){return(0,m.resolve)(f)}),u=[]}},d()),g){var y=t.apply(C,v);return a&&a(y),p(y)}u.push({resolve:p,reject:w})})};return h.cancel=function(v){s!==void 0&&clearTimeout(s),u.forEach(function(C){return(0,C.reject)(v)}),u=[]},h}const uT=.7,dT=20,Qi={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class nf extends Qt.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=G,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Hu(r=>S(this,void 0,void 0,function*(){this.emit(Qi.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),dT),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=gn((i=n.loggerName)!==null&&i!==void 0?i:jt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Qe}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return S(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return S(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=hT(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Tn.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=Ku(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let l=0;if(o.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===l){d.config=d.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&o.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=Tn.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Qi.NegotiationComplete),e.sdp&&Tn.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Qi.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return S(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Tn.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{sf(a),a.type==="audio"?rf(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(Nt(c.codec)&&!mi()&&this.ensureVideoDDExtensionForSVC(a,o),!Nt(c.codec)))return!0;const u=Math.round(c.maxbr*uT);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Tn.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Tn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{sf(r),r.type==="audio"&&rf(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Tn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Pe("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Pe("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return S(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return S(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new gl(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===Vh))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Vh})}}}function rf(t,e,n){const i=Ku(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function hT(t){var e;const n=[],i=[],r=Tn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const c=Ku(o.mid);o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&i.push(c),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function sf(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Ku(t){return typeof t=="number"?t.toFixed(0):t}const El="vp8",fT={audioPreset:vl.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Vu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:El,backupCodec:!0,preConnectBuffer:!1},lv={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},uv={deviceId:{ideal:"default"},resolution:ls.h720.resolution},pT={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new HS,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Gu={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ye;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ye||(ye={}));class mT{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Gu.peerConnectionTimeout,this.log=G,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=ye.CONNECTED:c.some(l=>l==="failed")?this.state=ye.FAILED:c.some(l=>l==="connecting")?this.state=ye.CONNECTING:c.every(l=>l==="closed")?this.state=ye.CLOSED:c.some(l=>l==="closed")?this.state=ye.CLOSING:c.every(l=>l==="new")&&(this.state=ye.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(ye[a]," to ").concat(ye[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=gn((r=i.loggerName)!==null&&r!==void 0?r:jt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new nf(e,i),n!=="publisher-only"&&(this.subscriber=new nf(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Dt.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Dt.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ye.NEW,this.connectionLock=new Qe,this.remoteOfferLock=new Qe}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return S(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return S(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return S(this,void 0,void 0,function*(){var i;n===Dt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return S(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return S(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return S(this,void 0,void 0,function*(){return new Promise((n,i)=>S(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Qi.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Qi.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Dt.PUBLISHER?this.publisher.getConnectedAddress():e===Dt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>S(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Ue.clearTimeout(d),l(new X("room connection has been cancelled",H.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Ue.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(new X("could not establish pc connection",H.InternalError))},o);for(;this.state!==ye.CONNECTED;)if(yield Fe(50),r!=null&&r.signal.aborted){l(new X("room connection has been cancelled",H.Cancelled));return}Ue.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}const dv=5e3,gT=3e4;class se{static fetchRegionSettings(e,n,i){return S(this,void 0,void 0,function*(){const r=yield se.fetchLock.lock();try{const s=yield fetch("".concat(vT(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=FC(s.headers),a=o?o*1e3:dv;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw new X("Could not fetch region settings: ".concat(s.statusText),s.status===401?H.NotAllowed:H.InternalError,s.status)}catch(s){throw s instanceof X?s:i!=null&&i.aborted?new X("Region fetching was aborted",H.Cancelled):new X("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s),H.ServerUnreachable,500)}finally{r()}})}static scheduleRefetch(e,n,i){return S(this,void 0,void 0,function*(){const r=se.settingsTimeouts.get(e.hostname);clearTimeout(r),se.settingsTimeouts.set(e.hostname,setTimeout(()=>S(this,void 0,void 0,function*(){try{const s=yield se.fetchRegionSettings(e,n);se.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof X&&s.reason===H.NotAllowed){G.debug("token is not valid, cancelling auto region refresh");return}G.debug("auto refetching of region settings failed",{error:s}),se.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){se.cache.set(e.hostname,i),se.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=se.settingsTimeouts.get(e);n&&(clearTimeout(n),se.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=se.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=se.connectionTrackers.get(e);i&&i.connectionCount===0&&(G.debug("stopping region refetch after disconnect delay",{hostname:e}),se.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},gT))}static cancelCleanup(e){const n=se.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=se.connectionTrackers.get(e);n||(n={connectionCount:0},se.connectionTrackers.set(e,n)),n.connectionCount++,se.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=se.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&se.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return zo(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return S(this,void 0,void 0,function*(){return se.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return S(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=se.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),se.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),G.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){se.updateCachedRegionSettings(this.serverUrl,this.token,e)}}se.cache=new Map;se.settingsTimeouts=new Map;se.connectionTrackers=new Map;se.fetchLock=new Qe;function vT(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Ce extends Error{constructor(e,n,i){super(n),this.code=e,this.message=of(n,Ce.MAX_MESSAGE_BYTES),this.data=i?of(i,Ce.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ce(e.code,e.message,e.data)}toProto(){return new ig({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Ce(Ce.ErrorCode[e],Ce.ErrorMessage[e],n)}}Ce.MAX_MESSAGE_BYTES=256;Ce.MAX_DATA_BYTES=15360;Ce.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Ce.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const hv=15360;function Ju(t){return new TextEncoder().encode(t).length}function of(t,e){if(Ju(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const $u=2e3;function ya(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Qu=typeof MediaRecorder<"u";class yT{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const kT=Qu?MediaRecorder:yT;class ST extends kT{constructor(e,n){if(!Qu)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>S(this,void 0,void 0,function*(){let u;if(l.data.arrayBuffer){const d=yield l.data.arrayBuffer();u=new Uint8Array(d)}else if(l.data.byteArray)u=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function CT(){return Qu}const TT=1e3,bT=1e4;class fv extends R{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Hu(()=>S(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>S(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(D.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Qe,this.pauseUpstreamLock=new Qe,this.trackChangeLock=new Qe,this.trackChangeLock.lock().then(o=>S(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==R.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return S(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Gi(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Li(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Li(r??e,s)}))})}waitForDimensions(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:TT;return function*(){var i;if(e.kind===R.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ct())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Fe(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Fe(50)}throw new an("unable to get track dimensions after timeout")}()})}setDeviceId(e){return S(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Vn(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Vn(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===R.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===R.Kind.Audio?"audioinput":"videoinput";return n?De.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return S(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new an("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return S(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=KS(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===R.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(l=>{Gi(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===R.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(D.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?D.Muted:D.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),tv()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(D.UpstreamPaused,this);const i=ct();if((i==null?void 0:i.name)==="Safari"&&$t(i.version,"12.0")<0)throw new Bu("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(D.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Li(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(Gi(i._mediaStreamTrack,l),Li(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(D.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(D.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!CT()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new ST(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},bT)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class qo extends fv{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,R.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=ya(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(D.AudioTrackFeatureUpdate,this,Oe.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(D.AudioTrackFeatureUpdate,this,Oe.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===R.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Vn(this._constraints.deviceId);return this.source===R.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return S(this,void 0,void 0,function*(){let n;if(e){const i=zu({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return S(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){rt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},$u)))}setProcessor(e){return S(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!Jt()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(D.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return S(this,void 0,void 0,function*(){const e=yield sv(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(D.AudioSilenceDetected)),e})}}function wT(t,e,n){switch(t.kind){case"audio":return new qo(t,e,!1,void 0,n);case"video":return new Wo(t,e,!1,n);default:throw new an("unsupported track type: ".concat(t.kind))}}const ET=Object.values(ls),_T=Object.values(yl),PT=Object.values(Vu),RT=[ls.h180,ls.h360],IT=[yl.h180,yl.h360],xT=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ae(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),_l=["q","h","f"];function Pl(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=OT(t,e,n,l),G.debug("using video encoding",o));const u=o.maxFramerate,d=new ae(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Nt(l)){const C=new pv(c),p=[];if(C.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const w=ct();if(us()||Jt()||(w==null?void 0:w.name)==="Chrome"&&$t(w==null?void 0:w.version,"113")<0){const g=C.suffix=="h"?2:3,y=_C(w);for(let f=0;f<C.spatial;f+=1)p.push({rid:_l[2-f],maxBitrate:o.maxBitrate/Math.pow(g,f),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:y?Math.pow(2,f):void 0});p[0].scalabilityMode=c}else p.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(p[0].priority=d.encoding.priority,p[0].networkPriority=d.encoding.priority),G.debug("using svc encoding",{encodings:p}),p}if(!a)return[o];let h=[];t?h=(r=cf(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:af(t,d):h=(s=cf(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:af(t,d);let v;if(h.length>0){const C=h[0];h.length>1&&([,v]=h);const p=Math.max(e,n);if(p>=960&&v)return ac(e,n,[C,v,d],u);if(p>=480)return ac(e,n,[C,d],u)}return ac(e,n,[d])}function MT(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&G.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===R.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Pl(t.source===R.Source.ScreenShare,c,l,n)}function OT(t,e,n,i){const r=DT(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function DT(t,e,n){if(t)return PT;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?ET:_T}function af(t,e){if(t)return xT(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?RT:IT}function ac(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=_l.length)return;const a=Math.min(t,e),l={rid:_l[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=pi()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),Jt()&&iv()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,G.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),G.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function cf(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class pv{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function NT(t){return t.source===R.Source.ScreenShare||t.constraints.height&&Vn(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const AT=5e3;class Wo extends fv{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,R.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(D.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=ya(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Qe}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!rt())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},$u))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return S(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=on(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return S(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=on(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===R.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===R.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=ht.LOW;i<=ht.HIGH;i+=1)n.push(new Lu({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Nt(this.codec),n)}restartTrack(e){return S(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=zu({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=on(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return S(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,v=on(r.simulcastCodecs.values()),C;C=yield v.next(),o=C.done,!o;h=!0)l=C.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(p){a={error:p}}finally{try{!h&&!o&&(c=v.return)&&(yield c.call(v))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return S(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},AT))}setPublishingCodecs(e){return S(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Nt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=on(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Nt(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield lf(d.sender,d.encodings,u.qualities,this.senderLock,Nt(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return S(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield lf(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return S(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&Nt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),tv()&&this.isInBackground&&this.source===R.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function lf(t,e,n,i,r,s,o){return S(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(v=>v.enabled)&&n.forEach(v=>v.enabled=!0),l.forEach((h,v)=>{var C;let p=(C=h.rid)!==null&&C!==void 0?C:"";p===""&&(p="q");const w=mv(p),g=n.find(y=>y.quality===w);g&&h.active!==g.enabled&&(u=!0,h.active=g.enabled,s.debug("setting layer ".concat(g.quality," to ").concat(h.active?"enabled":"disabled"),o),pi()&&(g.enabled?(h.scaleResolutionDownBy=e[v].scaleResolutionDownBy,h.maxBitrate=e[v].maxBitrate,h.maxFrameRate=e[v].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function mv(t){switch(t){case"f":return ht.HIGH;case"h":return ht.MEDIUM;case"q":return ht.LOW;default:return ht.HIGH}}function uf(t,e,n,i){if(!n)return[new jn({quality:ht.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new pv(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new jn({quality:Math.min(ht.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=mv((o=r.rid)!==null&&o!==void 0?o:"");return new jn({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const df="_lossy",hf="_reliable",LT=2*1e3,cc="leave-reconnect",UT=3e4;var vt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(vt||(vt={}));class FT extends Qt.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Gu.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=vt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=G,this.reliableDataSequence=1,this.reliableMessageBuffer=new Yh,this.reliableReceivedState=new oT(UT),this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>S(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===hf)s.reliableDCSub=o;else if(o.label===df)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>S(this,void 0,void 0,function*(){var r,s,o,a,c;const l=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=Je.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const h=this.reliableReceivedState.get(d.participantSid);if(h&&d.sequence<=h)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(A.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),v=eg.fromBinary(h.payload),C=new Je({value:v.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((a=C.value)===null||a===void 0?void 0:a.case)==="user"&&ff(C,C.value.value),this.emit(A.DataPacketReceived,C,d.value.value.encryptionType)}else((c=d.value)===null||c===void 0?void 0:c.case)==="user"&&ff(d,d.value.value),this.emit(A.DataPacketReceived,d,Ie.NONE)}finally{l()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?$.LOSSY:$.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(A.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===cc&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ue.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===vt.Connected&&i();const s=()=>{this.off(A.Disconnected,o),i()},o=()=>{this.off(A.Restarted,s),r()};this.once(A.Restarted,s),this.once(A.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===$.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(A.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>S(this,void 0,void 0,function*(){!this.url||!(yield fetch(ds(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===ce.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===ce.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(ti.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>S(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(ds(this.url),{method:"HEAD"}),Fe(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=gn((n=e.loggerName)!==null&&n!==void 0?n:jt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new qu(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Qe,this.dataProcessLock=new Qe,this.dcBufferStatus=new Map([[$.LOSSY,!0],[$.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(A.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(A.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(A.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(A.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(A.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(A.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(A.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(A.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return S(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{G.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(A.SignalConnected,s),s}catch(s){if(s instanceof X&&s.reason===H.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return S(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(A.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return S(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Yh,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return S(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new an("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new X("publication of local track timed out, no response from server",H.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return S(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return S(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ye.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new mT(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(A.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>S(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ye.CONNECTED){const u=this.pcState===vt.New;this.pcState=vt.Connected,u&&this.emit(A.Connected,e)}else s===ye.FAILED&&(this.pcState===vt.Connected||this.pcState===vt.Reconnecting)&&(this.pcState=vt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?ti.RR_SUBSCRIBER_FAILED:ti.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===ce.RECONNECTING,l=[ye.FAILED,ye.CLOSING,ye.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(A.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(A.MediaTrackAdded,s.track,s.streams[0],s.receiver)},jT((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>S(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>S(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(A.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(A.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(A.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(A.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(A.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",ti.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:dv,regionSettings:e.regions})),e.action){case Hi.DISCONNECT:this.emit(A.Disconnected,e==null?void 0:e.reason),this.close();break;case Hi.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(cc);break;case Hi.RESUME:this.handleDisconnect(cc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===os.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(df,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(hf,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return S(this,void 0,void 0,function*(){if(kl())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Sl())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return S(this,void 0,void 0,function*(){if(kl())return this.createSimulcastTransceiverSender(e,n,i,r);if(Sl())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),$n(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return S(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){G.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===os.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ye.NEW)===ye.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Pe?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Ti||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",ti.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(A.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return S(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(A.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Ti;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof X&&o.reason===H.NotAllowed?new Pe("could not reconnect, token might be expired"):new Ti}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(A.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==ce.CONNECTED)throw new Ti("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(A.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return S(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");if(!this.pcManager)throw new Pe("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(A.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof X&&r.reason===H.NotAllowed?new Pe("could not reconnect, token might be expired"):r instanceof X&&r.reason===H.LeaveRequest?r:new Ti(s)}if(this.emit(A.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ce.CONNECTED)throw new Ti("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(A.Resumed)})}waitForPCInitialConnection(e,n){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return S(this,void 0,void 0,function*(){this.pcState=vt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Fe(LT),!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=vt.Connected}catch(e){throw this.pcState=vt.Disconnected,new X("could not establish PC connection, ".concat(e.message),H.InternalError)}})}publishRpcResponse(e,n,i,r){return S(this,void 0,void 0,function*(){const s=new Je({destinationIdentities:[e],kind:$.RELIABLE,value:{case:"rpcResponse",value:new Ou({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,$.RELIABLE)})}publishRpcAck(e,n){return S(this,void 0,void 0,function*(){const i=new Je({destinationIdentities:[e],kind:$.RELIABLE,value:{case:"rpcAck",value:new Mu({requestId:n})}});yield this.sendDataPacket(i,$.RELIABLE)})}sendDataPacket(e,n){return S(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=aC(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new Zm({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===$.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary();yield this.waitForBufferStatusLow(n);const r=this.dataChannelForKind(n);if(r){if(n===$.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return S(this,void 0,void 0,function*(){yield this.ensurePublisherConnected($.RELIABLE);const n=this.dataChannelForKind($.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus($.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>S(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(A.Closing,r);!this.dcBufferStatus.get(e);)yield Fe(10);this.off(A.Closing,r),n()}}))}ensureDataTransportConnected(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Pe("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new X("".concat(a," connection not set"),H.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(d=>{G.error(d,i.logContext)});const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Fe(50)}throw new X("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),H.InternalError)}()})}ensurePublisherConnected(e){return S(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ye.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return S(this,void 0,void 0,function*(){return new Promise((e,n)=>S(this,void 0,void 0,function*(){if(!this.pcManager){n(new gl("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(A.Closing,r),this.pcManager.publisher.once(Qi.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();MC(c)&&o.set(a.payload,c)}),this.emit(A.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof gl&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ti.RR_UNKNOWN),n(s)}finally{this.off(A.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===$.LOSSY)return this.lossyDCSub;if(e===$.RELIABLE)return this.reliableDCSub}else{if(e===$.LOSSY)return this.lossyDC;if(e===$.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),l=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),d=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,v=new Array;e.forEach(C=>{C.isDesired!==d&&h.push(C.trackSid),C.isEnabled||v.push(C.trackSid)}),this.client.sendSyncState(new Uu({answer:this.options.singlePeerConnection?c?Ui({sdp:c.sdp,type:c.type}):void 0:u?Ui({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?a?Ui({sdp:a.sdp,type:a.type}):void 0:l?Ui({sdp:l.sdp,type:l.type}):void 0,subscription:new ma({trackSids:h,subscribe:!d,participantTracks:[]}),publishTracks:VC(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:v,datachannelReceiveStates:this.reliableReceivedState.map((C,p)=>new kg({publisherSid:p,lastSeq:C}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Sg({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind($.LOSSY),Dt.PUBLISHER),n(this.dataChannelForKind($.RELIABLE),Dt.PUBLISHER),n(this.dataChannelForKind($.LOSSY,!0),Dt.SUBSCRIBER),n(this.dataChannelForKind($.RELIABLE,!0),Dt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ue.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){rt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){rt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}class Ti extends Error{}function jT(t){return t!==void 0&&t>13}function ff(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class gv{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new yt("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Ge.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new yt("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Ge.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class BT extends gv{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Tt,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>S(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return S(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=on(c),d;d=yield u.next(),i=d.done,!i;l=!0){o=d.value,l=!1;const h=o;a.add(h)}}catch(h){r={error:h}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class VT extends gv{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=co(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Tt,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>S(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:u}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(h){throw new yt("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),Ge.DecodeFailed)}return{done:!1,value:d}}}catch(l){throw o(),l}}),return(){return S(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=on(c),d;d=yield u.next(),i=d.done,!i;l=!0)o=d.value,l=!1,a+=o}catch(h){r={error:h}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class zT{constructor(){this.log=G,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new yt('A text stream handler for topic "'.concat(e,'" has already been set.'),Ge.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new yt('A byte stream handler for topic "'.concat(e,'" has already been set.'),Ge.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new yt("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Ge.AbnormalEnd);for(const[l,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(l);for(const[l,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e,n){return S(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return S(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Tt;a.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:co(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new yt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Ge.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new BT(c,l,co(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Tt;a.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new yt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Ge.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new VT(c,l,co(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new yt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Ge.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new yt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Ge.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new yt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Ge.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new yt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Ge.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class vv{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return S(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class qT extends vv{}class WT extends vv{}const pf=15e3;class HT{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return S(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var v;c[h]=d;const C=c.reduce((p,w)=>p+w,0);(v=n==null?void 0:n.onProgress)===null||v===void 0||v.call(n,C)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>S(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:v=>{l(v,h+1)}})})))),u.info})}streamText(e){return S(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Ie.GCM:Ie.NONE},a=new Fo({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:ni(o.timestamp),totalLength:ni(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new dg({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?sl.UPDATE:sl.CREATE})}}),c=e==null?void 0:e.destinationIdentities,l=new Je({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,$.RELIABLE);let u=0;const d=this.engine,h=new WritableStream({write(p){return S(this,void 0,void 0,function*(){for(const w of UC(p,pf)){const g=new jo({content:w,streamId:s,chunkIndex:ni(u)}),y=new Je({destinationIdentities:c,value:{case:"streamChunk",value:g}});yield d.sendDataPacket(y,$.RELIABLE),u+=1}})},close(){return S(this,void 0,void 0,function*(){const p=new Bo({streamId:s}),w=new Je({destinationIdentities:c,value:{case:"streamTrailer",value:p}});yield d.sendDataPacket(w,$.RELIABLE)})},abort(p){console.log("Sink error:",p)}});let v=()=>S(this,void 0,void 0,function*(){yield C.close()});d.once(A.Closing,v);const C=new qT(h,o,()=>this.engine.off(A.Closing,v));return C})}sendFile(e,n){return S(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return S(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return S(this,void 0,void 0,function*(){var n,i,r,s,o,a;const c=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e==null?void 0:e.destinationIdentities,u={id:c,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Ie.GCM:Ie.NONE},d=new Fo({totalLength:ni((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:ni(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new hg({name:u.name})}}),h=new Je({destinationIdentities:l,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(h,$.RELIABLE);let v=0;const C=new Qe,p=this.engine,w=this.log,g=new WritableStream({write(f){return S(this,void 0,void 0,function*(){const m=yield C.lock();let k=0;try{for(;k<f.byteLength;){const T=f.slice(k,k+pf),E=new Je({destinationIdentities:l,value:{case:"streamChunk",value:new jo({content:T,streamId:c,chunkIndex:ni(v)})}});yield p.sendDataPacket(E,$.RELIABLE),v+=1,k+=T.byteLength}}finally{m()}})},close(){return S(this,void 0,void 0,function*(){const f=new Bo({streamId:c}),m=new Je({destinationIdentities:l,value:{case:"streamTrailer",value:f}});yield p.sendDataPacket(m,$.RELIABLE)})},abort(f){w.error("Sink error:",f)}});return new WT(g,u)})}}class yv extends R{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?D.Muted:D.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(D.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),$u)),zC()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(D.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class KT extends yv{constructor(e,n,i,r,s,o){super(e,n,R.Kind.Audio,i,o),this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=ya(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Jt()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Jt())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return S(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(Cl(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Cl(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(D.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(D.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const lc=100;class GT extends yv{constructor(e,n,i,r,s){super(e,n,R.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=ya(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Hu(()=>{this.updateDimensions()},lc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===R.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Gi(this._mediaStreamTrack,n):Li(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new JT(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<lc){Ue.setTimeout(()=>{this.updateVisibility()},lc);return}this.lastVisible=a,this.emit(D.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(D.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?qh():n||(qh()>2?2:1)}}class JT{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=Tr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Tr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Tr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Rl(e),this.isPiP=rt()&&Tr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Rl(this.element),this.isPiP=Tr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Hh().observe(this.element),Wh().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Hh())===null||e===void 0||e.unobserve(this.element),(n=Wh())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Tr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Rl(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Rl(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class tn extends Qt.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Ie.NONE,this.log=G,this.handleMuted=()=>{this.emit(D.Muted)},this.handleUnmuted=()=>{this.emit(D.Unmuted)},this.log=gn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:jt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=R.Source.Unknown}setTrack(e){this.track&&(this.track.off(D.Muted,this.handleMuted),this.track.off(D.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(D.Muted,this.handleMuted),e.on(D.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),J(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ie.NONE}get audioTrack(){if(Gt(this.track))return this.track}get videoTrack(){if($n(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=R.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===R.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(tn||(tn={}));class Il extends tn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(D.Ended)},this.handleCpuConstrained=()=>{this.track&&$n(this.track)&&this.emit(D.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(D.Ended,this.handleTrackEnded),this.track.off(D.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(D.Ended,this.handleTrackEnded),e.on(D.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Gt(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Oe.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Oe.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Oe.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Oe.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Oe.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Oe.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function ka(t,e){return S(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=av(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=rv(s,lv,uv),l=zu(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(De.userMediaPromiseMap.set("audioinput",u),u.catch(()=>De.userMediaPromiseMap.delete("audioinput"))),s.video&&(De.userMediaPromiseMap.set("videoinput",u),u.catch(()=>De.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>S(this,void 0,void 0,function*(){const v=h.kind==="audio";let C=v?c.audio:c.video;(typeof C=="boolean"||!C)&&(C={});let p;const w=v?l.audio:l.video;typeof w!="boolean"&&(p=w);const g=h.getSettings().deviceId;p!=null&&p.deviceId&&Vn(p.deviceId)!==g?p.deviceId=g:p||(p={deviceId:g});const y=wT(h,p,e);return y.kind===R.Kind.Video?y.source=R.Source.Camera:y.kind===R.Kind.Audio&&(y.source=R.Source.Microphone),y.mediaStream=d,Gt(y)&&i?yield y.setProcessor(i):$n(y)&&r&&(yield y.setProcessor(r)),y})))}catch(d){if(!n)throw d;return ka(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function $T(t){return S(this,void 0,void 0,function*(){return(yield ka({audio:!1,video:!0}))[0]})}function kv(t){return S(this,void 0,void 0,function*(){return(yield ka({audio:t??!0,video:!1}))[0]})}var Pn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Pn||(Pn={}));function QT(t){switch(t){case Pr.EXCELLENT:return Pn.Excellent;case Pr.GOOD:return Pn.Good;case Pr.POOR:return Pn.Poor;case Pr.LOST:return Pn.Lost;default:return Pn.Unknown}}class Sv extends Qt.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===as.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Wi.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:as.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Pn.Unknown,this.log=G,this.log=gn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:jt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Tt,this.once(L.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(R.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(R.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(R.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Wi.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Wi.ACTIVE&&this.emit(L.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(L.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(L.ParticipantNameChanged,e)}_setAttributes(e){const n=qC(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(L.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(L.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(L.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=QT(e),n!==this._connectionQuality&&this.emit(L.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Gt(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(D.Muted,()=>{this.emit(L.TrackMuted,e)}),e.on(D.Unmuted,()=>{this.emit(L.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case R.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case R.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function YT(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new vg({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class XT extends Sv{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ie.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Tt)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,u,d,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(v=>this.log.warn(v.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(l=this.signalConnectedFuture).reject)===null||u===void 0||u.call(l,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(h=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Tt),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:u}=a,d=this.pendingSignalRequests.get(c);d&&(l!==Fu.OK&&d.reject(new Fh(u,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,u=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(u=Ce.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>YT(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),J(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),J(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),J(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),J(c))),this.emit(L.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>S(this,void 0,void 0,function*(){var c,l,u,d,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const v=this.videoTrackPublications.get(a.trackSid);if(!v){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!v.videoTrack)return;const C=yield v.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var p=!0,w=on(C),g;g=yield w.next(),c=g.done,!c;p=!0){d=g.value,p=!1;const y=d;kC(y)&&(this.log.debug("publish ".concat(y," for ").concat(v.videoTrack.sid),Object.assign(Object.assign({},this.logContext),J(v))),yield this.publishAdditionalCodecForTrack(v.videoTrack,y,v.options))}}catch(y){l={error:y}}finally{try{!p&&!c&&(u=w.return)&&(yield u.call(w))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>S(this,void 0,void 0,function*(){if(a.source===R.Source.ScreenShare||a.source===R.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),J(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(Xt(a)||Cn(a))try{if(rt())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===R.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),J(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),J(a))),Xt(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),J(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ie.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(A.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(A.Connected,this.handleReconnected).on(A.SignalConnected,this.handleSignalConnected).on(A.SignalRestarted,this.handleReconnected).on(A.SignalResumed,this.handleReconnected).on(A.Restarting,this.handleReconnecting).on(A.Resuming,this.handleReconnecting).on(A.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(A.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(A.Closing,this.handleClosing).on(A.SignalRequestResponse,this.handleSignalRequestResponse).on(A.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return S(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>S(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),v=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:C=>{c(C),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-v<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(C=>{let[p,w]=C;return this.attributes[p]===w||w===""&&!this.attributes[p]}))){this.pendingSignalRequests.delete(h),a();return}yield Fe(50)}c(new Fh("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(R.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(R.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(R.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){this.encryptionType=e?Ie.GCM:Ie.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return S(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case R.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case R.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case R.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new an(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(L.MediaDevicesError,l,wl(e)),this.pendingPublishing.delete(e),l}for(const l of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===R.Source.Microphone&&Gt(l)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),J(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===R.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(R.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return S(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(R.Source.Camera)||this.pendingPublishing.has(R.Source.Microphone))){this.pendingPublishing.add(R.Source.Camera),this.pendingPublishing.add(R.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(R.Source.Camera),this.pendingPublishing.delete(R.Source.Microphone)}}})}createTracks(e){return S(this,void 0,void 0,function*(){var n,i;e??(e={});const r=rv(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield ka(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Gt(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=R.Source.Microphone,this.emit(L.AudioStreamAcquired)),$n(a)&&(this.cameraError=void 0,a.source=R.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return S(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Bu("getDisplayMedia not supported");e.resolution===void 0&&!EC()&&(e.resolution=Vu.h1080fps30.resolution);const n=BC(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new an("no video track found");const s=new Wo(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=R.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(L.AudioStreamAcquired);const a=new qo(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=R.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return S(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;Xt(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Ji(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let g;switch(i.source){case R.Source.Microphone:g="audioinput";break;case R.Source.Camera:g="videoinput"}g&&s.activeDeviceMap.has(g)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(g)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new qo(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Wo(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new an("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(g=>{g.track&&g.track===i&&(h=g)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),J(h))),h;const v=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),C="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,p=(c=v.forceStereo)!==null&&c!==void 0?c:C;p&&(v.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),J(i))),v.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=v.dtx)!==null&&l!==void 0||(v.dtx=!1),(u=v.red)!==null&&u!==void 0||(v.red=!1)),!PC()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),v.simulcast=!1),v.source&&(i.source=v.source);const w=new Promise((g,y)=>S(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==ce.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:J(i)}));let f=!1;const m=setTimeout(()=>{f=!0,i.stop(),y(new Uh("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(m),f)return;const k=yield this.publish(i,v,p);g(k)}else try{const f=yield this.publish(i,v,p);g(f)}catch(f){y(f)}}catch(f){y(f)}}));s.pendingPublishPromises.set(i,w);try{return yield w}catch(g){throw g}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Tt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),J(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>WC(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),J(e))),!1)}publish(e,n,i){return S(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,v;if(!this.hasPermissionsToPublish(e))throw new Uh("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(x=>Ji(e)&&x.source===e.source)&&e.source!==R.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),J(e))),n.stopMicTrackOnMute&&Gt(e)&&(e.stopOnMute=!0),e.source===R.Source.ScreenShare&&pi()&&(n.simulcast=!1),n.videoCodec==="av1"&&!TC()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!bC()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=El),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(x=>n.videoCodec===Br(x.mime))||(n.videoCodec=Br(this.enabledPublishVideoCodecs[0].mime)));const p=n.videoCodec;e.on(D.Muted,this.onTrackMuted),e.on(D.Unmuted,this.onTrackUnmuted),e.on(D.Ended,this.handleTrackEnded),e.on(D.UpstreamPaused,this.onTrackUpstreamPaused),e.on(D.UpstreamResumed,this.onTrackUpstreamResumed),e.on(D.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const w=[],g=!(!((r=n.dtx)!==null&&r!==void 0)||r),y=e.getSourceTrackSettings();y.autoGainControl&&w.push(Oe.TF_AUTO_GAIN_CONTROL),y.echoCancellation&&w.push(Oe.TF_ECHO_CANCELLATION),y.noiseSuppression&&w.push(Oe.TF_NOISE_SUPPRESSION),y.channelCount&&y.channelCount>1&&w.push(Oe.TF_STEREO),g&&w.push(Oe.TF_NO_DTX),Xt(e)&&e.hasPreConnectBuffer&&w.push(Oe.TF_PRECONNECT_BUFFER);const f=new cs({cid:e.mediaStreamTrack.id,name:n.name,type:R.kindToProto(e.kind),muted:e.isMuted,source:R.sourceToProto(e.source),disableDtx:g,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:w});let m;if(e.kind===R.Kind.Video){let x={width:0,height:0};try{x=yield e.waitForDimensions()}catch{const N=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:ls.h720.resolution;x={width:N.width,height:N.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{dims:x}))}f.width=x.width,f.height=x.height,Cn(e)&&(Nt(p)&&(e.source===R.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),J(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),f.simulcastCodecs=[new al({codec:p,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:El}),n.backupCodec&&p!==n.backupCodec.codec&&f.encryption===Ie.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),f.simulcastCodecs.push(new al({codec:n.backupCodec.codec,cid:""})))),m=Pl(e.source===R.Source.ScreenShare,f.width,f.height,n),f.layers=uf(f.width,f.height,m,Nt(n.videoCodec))}else e.kind===R.Kind.Audio&&(m=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(v=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&v!==void 0?v:"high"}]);if(!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const k=()=>S(this,void 0,void 0,function*(){var x,P,N;if(!this.engine.pcManager)throw new Pe("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,m),this.emit(L.LocalSenderCreated,e.sender,e),Cn(e)&&((x=n.degradationPreference)!==null&&x!==void 0||(n.degradationPreference=NT(e)),e.setDegradationPreference(n.degradationPreference)),m)if(pi()&&e.kind===R.Kind.Audio){let W;for(const ie of this.engine.pcManager.publisher.getTransceivers())if(ie.sender===e.sender){W=ie;break}W&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:W,codec:"opus",maxbr:!((P=m[0])===null||P===void 0)&&P.maxBitrate?m[0].maxBitrate/1e3:0})}else e.codec&&Nt(e.codec)&&(!((N=m[0])===null||N===void 0)&&N.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:f.cid,codec:e.codec,maxbr:m[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const E=new Promise((x,P)=>S(this,void 0,void 0,function*(){var N;try{T=yield this.engine.addTrack(f),x(T)}catch(W){e.sender&&(!((N=this.engine.pcManager)===null||N===void 0)&&N.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(ie=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{error:ie}))})),P(W)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([E,k()]))[0];else{T=yield E;let x;if(T.codecs.forEach(P=>{x===void 0&&(x=P.mimeType)}),x&&e.kind===R.Kind.Video){const P=Br(x);P!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{codec:P})),n.videoCodec=P,m=Pl(e.source===R.Source.ScreenShare,f.width,f.height,n))}yield k()}const _=new Il(e.kind,T,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(_.on(D.CpuConstrained,x=>this.onTrackCpuConstrained(x,_)),_.options=n,e.sid=T.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:m,trackInfo:T})),Cn(e)?e.startMonitor(this.engine.client):Xt(e)&&e.startMonitor(),this.addTrackPublication(_),this.emit(L.LocalTrackPublished,_),Xt(e)&&T.audioFeatures.includes(Oe.TF_PRECONNECT_BUFFER)){const x=e.getPreConnectBuffer(),P=e.getPreConnectBufferMimeType();this.on(L.LocalTrackSubscribed,N=>{if(N.trackSid===T.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),J(e))),e.stopPreConnectBuffer()}}),x&&new Promise((W,ie)=>S(this,void 0,void 0,function*(){var q,te,_e,he,U,z;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),J(e)));const Ae=setTimeout(()=>{ie(new Error("agent not active within 10 seconds"))},1e4),Ve=yield this.waitUntilActiveAgentPresent();clearTimeout(Ae),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),J(e)));const Yt=yield this.streamBytes({name:"preconnect-buffer",mimeType:P,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Ve.identity],attributes:{trackId:_.trackSid,sampleRate:String((U=y.sampleRate)!==null&&U!==void 0?U:"48000"),channels:String((z=y.channelCount)!==null&&z!==void 0?z:"1")}});try{for(var F=!0,B=on(x),K;K=yield B.next(),q=K.done,!q;F=!0){he=K.value,F=!1;const et=he;yield Yt.write(et)}}catch(et){te={error:et}}finally{try{!F&&!q&&(_e=B.return)&&(yield _e.call(B))}finally{if(te)throw te.error}}yield Yt.close(),W()}catch(Ae){ie(Ae)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),J(e)))}).catch(W=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{error:W}))})}return _})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return S(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Ie.NONE)return;let s;if(this.trackPublications.forEach(v=>{v.track&&v.track===e&&(s=v)}),!s)throw new an("track is not published");if(!Cn(e))throw new an("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=MT(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),J(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new cs({cid:c.mediaStreamTrack.id,type:R.kindToProto(e.kind),muted:e.isMuted,source:R.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=uf(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const u=()=>S(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return S(this,void 0,void 0,function*(){var i,r;if(Ji(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),J(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?J(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(D.Muted,this.onTrackMuted),e.off(D.Unmuted,this.onTrackUnmuted),e.off(D.Ended,this.handleTrackEnded),e.off(D.UpstreamPaused,this.onTrackUpstreamPaused),e.off(D.UpstreamResumed,this.onTrackUpstreamResumed),e.off(D.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ye.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Cn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case R.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case R.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(L.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return S(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>S(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>S(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==R.Source.ScreenShare&&l.source!==R.Source.ScreenShareAudio&&(Xt(l)||Cn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?$.RELIABLE:$.LOSSY,o=r.destinationIdentities,a=r.topic;let c=new Iu({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const l=new Je({kind:s,value:{case:"user",value:c}});yield i.engine.sendDataPacket(l,s)}()})}publishDtmf(e,n){return S(this,void 0,void 0,function*(){const i=new Je({kind:$.RELIABLE,value:{case:"sipDtmf",value:new ng({code:e,digit:n})}});yield this.engine.sendDataPacket(i,$.RELIABLE)})}sendChatMessage(e,n){return S(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Je({value:{case:"chatMessage",value:new Uo(Object.assign(Object.assign({},i),{timestamp:pe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,$.RELIABLE),this.emit(L.ChatMessage,i),i})}editChatMessage(e,n){return S(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Je({value:{case:"chatMessage",value:new Uo(Object.assign(Object.assign({},i),{timestamp:pe.parse(i.timestamp),editTimestamp:pe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,$.RELIABLE),this.emit(L.ChatMessage,i),i})}sendText(e,n){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return S(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=15e3}=n;return function*(){return new Promise((u,d)=>S(i,void 0,void 0,function*(){var h,v,C,p;if(Ju(o)>hv){d(Ce.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((v=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||v===void 0)&&v.version&&$t((p=(C=this.engine.latestJoinResponse)===null||C===void 0?void 0:C.serverInfo)===null||p===void 0?void 0:p.version,"1.8.0")<0){d(Ce.builtIn("UNSUPPORTED_SERVER"));return}const w=Math.max(a,8e3),g=crypto.randomUUID();yield this.publishRpcRequest(r,g,s,o,w);const y=setTimeout(()=>{this.pendingAcks.delete(g),d(Ce.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(f)},7e3);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(y)},participantIdentity:r});const f=setTimeout(()=>{this.pendingResponses.delete(g),d(Ce.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(g,{resolve:(m,k)=>{clearTimeout(f),this.pendingAcks.has(g)&&(console.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(y)),k?d(k):u(m??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return S(this,void 0,void 0,function*(){const o=new Je({destinationIdentities:[e],kind:$.RELIABLE,value:{case:"rpcRequest",value:new xu({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,$.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Ce.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),J(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Tt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Xt(r)||Cn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return S(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Fe(20)}})}}class ZT extends tn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(D.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new ma({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new rg({participantSid:"",trackSids:[this.trackSid]})]});this.emit(D.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?tn.SubscriptionStatus.Unsubscribed:super.isSubscribed?tn.SubscriptionStatus.Subscribed:tn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?tn.PermissionStatus.Allowed:tn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(nc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&nc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:ht.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(D.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(D.VisibilityChanged,this.handleVisibilityChange),r.off(D.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(D.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(D.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(D.VisibilityChanged,this.handleVisibilityChange),e.on(D.Ended,this.handleEnded),this.emit(D.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(D.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?D.Muted:D.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(D.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(D.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return nc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new fg({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===R.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Jh(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=HC(this.trackInfo,this.requestedMaxQuality);i&&Jh(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:ht.HIGH})),e.quality=ht.HIGH)}this.emit(D.UpdateSettings,e)}}class Ho extends Sv{static fromParticipantInfo(e,n,i){return new Ho(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:as.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(D.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(D.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(D.SubscriptionPermissionChanged,n=>{this.emit(L.TrackSubscriptionPermissionChanged,e,n)}),e.on(D.SubscriptionStatusChanged,n=>{this.emit(L.TrackSubscriptionStatusChanged,e,n)}),e.on(D.Subscribed,n=>{this.emit(L.TrackSubscribed,n,e)}),e.on(D.Unsubscribed,n=>{this.emit(L.TrackUnsubscribed,n,e)}),e.on(D.SubscriptionFailed,n=>{this.emit(L.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:R.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(L.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),J(a))),this.emit(L.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new GT(e,n,r,s):l=new KT(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&Tl(l)&&Gt(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=R.kindFromProto(r.type);if(!c)return;a=new ZT(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==R.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:J(l),newTrack:J(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),J(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(L.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case R.Kind.Audio:this.audioTrackPublications.delete(e);break;case R.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(L.TrackUnpublished,i)}setAudioOutput(e){return S(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;Gt(i.track)&&Tl(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ne;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ne||(ne={}));const eb=4*1e3;class sr extends Qt.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s;if(super(),n=this,this.state=ne.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=G,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>S(this,void 0,void 0,function*(){var l;if(!wC())throw Jt()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===ne.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(ne.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),zo(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new se(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(v=>{var C;(C=this.regionUrlProvider)===null||C===void 0||C.setServerReportedRegions(v)}).catch(v=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:v}))}));const d=(v,C,p)=>S(this,void 0,void 0,function*(){var w,g;this.abortController&&this.abortController.abort();const y=new AbortController;this.abortController=y,u==null||u();try{if(yield $i.getInstance().getBackOffPromise(o),y.signal.aborted)throw new X("Connection attempt aborted",H.Cancelled);yield this.attemptConnection(p??o,a,c,y),this.abortController=void 0,v()}catch(f){if(this.regionUrlProvider&&f instanceof X&&f.reason!==H.Cancelled&&f.reason!==H.NotAllowed){let m=null;try{this.log.debug("Fetching next region"),m=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(k){if(k instanceof X&&(k.status===401||k.reason===H.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),C(k);return}}[H.InternalError,H.ServerUnreachable,H.Timeout].includes(f.reason)&&(this.log.debug("Adding failed connection attempt to back off"),$i.getInstance().addFailedConnectionAttempt(o)),m&&!(!((g=this.abortController)===null||g===void 0)&&g.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(f.message,". Retrying with another region: ").concat(m),this.logContext),this.recreateEngine(),yield d(v,C,m)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Gh(f)),C(f))}else{let m=At.UNKNOWN_REASON;f instanceof X&&(m=Gh(f)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,m),C(f)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Tt((v,C)=>{d(v,C,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>S(this,void 0,void 0,function*(){var h,v,C;const p=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout,singlePeerConnection:u.singlePeerConnection},d.signal);let w=p.serverInfo;if(w||(w={version:p.serverVersion,region:p.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(g=>{let[y,f]=g;return"".concat(y,": ").concat(f)}).join(", ")),{room:(h=p.room)===null||h===void 0?void 0:h.name,roomSid:(v=p.room)===null||v===void 0?void 0:v.sid,identity:(C=p.participant)===null||C===void 0?void 0:C.identity}),!w.version)throw new cC("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),p}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>S(this,void 0,void 0,function*(){var u,d;this.state===ne.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Gu),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(M.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const v=new X("could not establish signal connection",l.signal.aborted?H.Cancelled:H.ServerUnreachable);throw h instanceof Error&&(v.message="".concat(v.message,": ").concat(h.message)),h instanceof X&&(v.reason=h.reason,v.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),v}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new X("Connection attempt aborted",H.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}rt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),rt()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ne.Connected),this.emit(M.Connected),$i.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return S(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,v;const C=yield l.disconnectLock.lock();try{if(l.state===ne.Disconnected){l.log.debug("already disconnected",l.logContext);return}if(l.log.info("disconnect from room",Object.assign({},l.logContext)),l.state===ne.Connecting||l.state===ne.Reconnecting||l.isResuming){const p="Abort connection attempt due to user initiated disconnect";l.log.warn(p,l.logContext),(d=l.abortController)===null||d===void 0||d.abort(p),(v=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||v===void 0||v.call(h,new X("Client initiated disconnect",H.Cancelled)),l.connectFuture=void 0}l.engine&&(l.engine.client.isDisconnected||(yield l.engine.client.sendLeave()),yield l.engine.close()),l.handleDisconnect(u,At.CLIENT_INITIATED),l.engine=void 0}finally{C()}}()})},this.onPageLeave=()=>S(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>S(this,void 0,void 0,function*(){const o=[],a=ct();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=tc();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(M.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>S(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(ne.Reconnecting)&&this.emit(M.Reconnecting)},this.handleSignalRestarted=o=>S(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(ne.Connected),this.emit(M.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===Wi.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(M.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(M.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=R.streamStateFromProto(a.state);l.track.setStreamState(u),u!==l.track.streamState&&(c.emit(L.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(M.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const l=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(o,a,c,l)=>{this.emit(M.DataReceived,a.payload,o,c,a.topic,l),o==null||o.emit(L.DataReceived,a.payload,c,l)},this.handleSipDtmf=(o,a)=>{this.emit(M.SipDTMFReceived,a,o),o==null||o.emit(L.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=DC(a,this.transcriptionReceivedTimes);l==null||l.emit(D.TranscriptionReceived,u),c==null||c.emit(L.TranscriptionReceived,u,l),this.emit(M.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=NC(a);this.emit(M.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(M.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(M.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(M.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(M.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(M.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>S(this,void 0,void 0,function*(){var o;((o=ct())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(M.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(M.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(M.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(M.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(M.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(M.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(M.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(M.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>S(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(D.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(D.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(M.LocalTrackPublished,o,this.localParticipant),Xt(o.track)&&(yield o.track.checkForSilence())&&this.emit(M.LocalAudioSilenceDetected,o);const v=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),C=wl(o.source);C&&v&&v!==this.localParticipant.activeDeviceMap.get(C)&&(this.localParticipant.activeDeviceMap.set(C,v),this.emit(M.ActiveDeviceChanged,C,v))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(D.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(D.Restarted,this.onLocalTrackRestarted),this.emit(M.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>S(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=wl(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(M.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(M.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(M.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(M.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(M.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},pT),e),this.log=gn((i=this.options.loggerName)!==null&&i!==void 0?i:jt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},lv),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},uv),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},fT),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new zT,this.outgoingDataStreamManager=new HT(this.engine,this.log),this.disconnectLock=new Qe,this.localParticipant=new XT("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Vn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Vn(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Vn(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),rt()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),sr.cleanupRegistry&&sr.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new KC(i,n),this.e2eeManager.on(xn.ParticipantEncryptionStatusChanged,(r,s)=>{LC(s)&&(this.isE2EEEnabled=r),this.emit(M.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(xn.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(M.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return S(this,void 0,void 0,function*(){return this.state===ne.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(A.RoomUpdate,i),e(r.sid))};this.engine.on(A.RoomUpdate,i),this.once(M.Disconnected,()=>{this.engine.off(A.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new FT(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(A.ParticipantUpdate,this.handleParticipantUpdates).on(A.RoomUpdate,this.handleRoomUpdate).on(A.SpeakersChanged,this.handleSpeakersChanged).on(A.StreamStateChanged,this.handleStreamStateUpdate).on(A.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(A.SubscriptionError,this.handleSubscriptionError).on(A.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(A.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(A.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(A.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(A.DataPacketReceived,this.handleDataPacket).on(A.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ne.SignalReconnecting)&&this.emit(M.SignalReconnecting)}).on(A.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ne.Connected)&&this.emit(M.Reconnected)}).on(A.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ne.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(A.Restarting,this.handleRestarting).on(A.SignalRestarted,this.handleSignalRestarted).on(A.Offline,()=>{this.setAndEmitConnectionState(ne.Reconnecting)&&this.emit(M.Reconnecting)}).on(A.DCBufferStatusChanged,(e,n)=>{this.emit(M.DCBufferStatusChanged,e,n)}).on(A.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(L.LocalTrackSubscribed,n),this.emitWhenConnected(M.LocalTrackSubscribed,n,this.localParticipant)}).on(A.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(M.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return De.getInstance().getDevices(e,n)}prepareConnection(e,n){return S(this,void 0,void 0,function*(){if(this.state===ne.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(zo(new URL(e))&&n){this.regionUrlProvider=new se(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ne.Disconnected&&(this.regionUrl=i,yield fetch(ds(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ds(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return S(this,void 0,void 0,function*(){let i=()=>S(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Vt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Vt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Vt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Vt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Vt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Vt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Vt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>S(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new ga({reason:At.CLIENT_INITIATED,action:Hi.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Vt({scenario:{case:"subscriberBandwidth",value:ni(n)}});break;case"leave-full-reconnect":r=new Vt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,v;let C=!0,p=!1;const w=o?{exact:r}:r;if(i==="audioinput"){p=s.localParticipant.audioTrackPublications.size===0;const g=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=w;const y=Array.from(s.localParticipant.audioTrackPublications.values()).filter(m=>m.source===R.Source.Microphone);try{C=(yield Promise.all(y.map(m=>{var k;return(k=m.audioTrack)===null||k===void 0?void 0:k.setDeviceId(w)}))).every(m=>m===!0)}catch(m){throw s.options.audioCaptureDefaults.deviceId=g,m}const f=y.some(m=>{var k,T;return(T=(k=m.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});C&&f&&(p=!0)}else if(i==="videoinput"){p=s.localParticipant.videoTrackPublications.size===0;const g=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=w;const y=Array.from(s.localParticipant.videoTrackPublications.values()).filter(m=>m.source===R.Source.Camera);try{C=(yield Promise.all(y.map(m=>{var k;return(k=m.videoTrack)===null||k===void 0?void 0:k.setDeviceId(w)}))).every(m=>m===!0)}catch(m){throw s.options.videoCaptureDefaults.deviceId=g,m}const f=y.some(m=>{var k,T;return(T=(k=m.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});C&&f&&(p=!0)}else if(i==="audiooutput"){if(p=!0,!Cl()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(l=yield De.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(v=s.options).audioOutput)!==null&&u!==void 0||(v.audioOutput={});const g=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(y=>y.setAudioOutput({deviceId:r})))}catch(y){throw s.options.audioOutput.deviceId=g,y}}return p&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(M.ActiveDeviceChanged,i,r)),C}()})}setupLocalParticipantEvents(){this.localParticipant.on(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(L.AttributesChanged,this.onLocalAttributesChanged).on(L.TrackMuted,this.onLocalTrackMuted).on(L.TrackUnmuted,this.onLocalTrackUnmuted).on(L.LocalTrackPublished,this.onLocalTrackPublished).on(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(L.MediaDevicesError,this.onMediaDevicesError).on(L.AudioStreamAcquired,this.startAudio).on(L.ChatMessage,this.onLocalChatMessageSent).on(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ne.Connecting||this.state===ne.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(v=>v.id)}),this.onTrackAdded(e,n,i),h()},h=()=>{this.off(M.Reconnected,d),this.off(M.Connected,d),this.off(M.Disconnected,h)};this.once(M.Reconnected,d),this.once(M.Connected,d),this.once(M.Disconnected,h);return}if(this.state===ne.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=CC(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=d}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={});const u=c.addSubscribedMediaTrack(e,a,n,i,l);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(M.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==ne.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(L.AttributesChanged,this.onLocalAttributesChanged).off(L.TrackMuted,this.onLocalTrackMuted).off(L.TrackUnmuted,this.onLocalTrackUnmuted).off(L.LocalTrackPublished,this.onLocalTrackPublished).off(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(L.MediaDevicesError,this.onMediaDevicesError).off(L.AudioStreamAcquired,this.startAudio).off(L.ChatMessage,this.onLocalChatMessageSent).off(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),rt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ne.Disconnected),this.emit(M.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(M.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return S(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Ce.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Ce.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Ju(u)>hv?(c=Ce.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof Ce?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=Ce.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return S(this,void 0,void 0,function*(){var e,n,i;const r=De.getInstance().previousDevices,s=yield De.getInstance().getDevices(void 0,!1),o=ct();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(M.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=jC(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(v=>v.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(v=>v.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!us()||c==="videoinput"||d.length>0&&!d.find(v=>v.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!us())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return S(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=ov())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Fe(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(M.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Ho.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Ho(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(M.ParticipantConnected,i),i.on(L.TrackPublished,r=>{this.emitWhenConnected(M.TrackPublished,r,i)}).on(L.TrackSubscribed,(r,s)=>{r.kind===R.Kind.Audio?(r.on(D.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(D.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===R.Kind.Video&&(r.on(D.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(D.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(M.TrackSubscribed,r,s,i)}).on(L.TrackUnpublished,r=>{this.emit(M.TrackUnpublished,r,i)}).on(L.TrackUnsubscribed,(r,s)=>{this.emit(M.TrackUnsubscribed,r,s,i)}).on(L.TrackMuted,r=>{this.emitWhenConnected(M.TrackMuted,r,i)}).on(L.TrackUnmuted,r=>{this.emitWhenConnected(M.TrackUnmuted,r,i)}).on(L.ParticipantMetadataChanged,r=>{this.emitWhenConnected(M.ParticipantMetadataChanged,r,i)}).on(L.ParticipantNameChanged,r=>{this.emitWhenConnected(M.ParticipantNameChanged,r,i)}).on(L.AttributesChanged,r=>{this.emitWhenConnected(M.ParticipantAttributesChanged,r,i)}).on(L.ConnectionQualityChanged,r=>{this.emitWhenConnected(M.ConnectionQualityChanged,r,i)}).on(L.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(M.ParticipantPermissionsChanged,r,i)}).on(L.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(M.TrackSubscriptionStatusChanged,r,s,i)}).on(L.TrackSubscriptionFailed,(r,s)=>{this.emit(M.TrackSubscriptionFailed,r,i,s)}).on(L.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(M.TrackSubscriptionPermissionChanged,r,s,i)}).on(L.Active,()=>{this.emitWhenConnected(M.ParticipantActive,i),i.kind===as.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&AC(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ue.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,At.STATE_MISMATCH))):e=0},eb)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ue.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(M.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ne.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ne.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return S(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new ha({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:pe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new fi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(M.SignalConnected),this.emit(M.Connected),this.setAndEmitConnectionState(ne.Connected),r.video){const o=new Il(R.Kind.Video,new Ai({source:we.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ot.AUDIO,name:"video-dummy"}),new Wo(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Kh(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(L.LocalTrackPublished,o)}if(r.audio){const o=new Il(R.Kind.Audio,new Ai({source:we.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ot.AUDIO}),new qo(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:tc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(L.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new fi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Wi.ACTIVE,tracks:[],joinedAt:pe.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=Kh(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Ai({source:we.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ot.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=tc(),u=new Ai({source:we.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ot.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==M.ActiveSpeakersChanged&&e!==M.TranscriptionReceived){const s=Cv(i).filter(o=>o!==void 0);(e===M.TrackSubscribed||e===M.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}sr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Cv(t){return t.map(e=>{if(e)return Array.isArray(e)?Cv(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var xt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(xt||(xt={}));class Qn extends Qt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=xt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new sr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return S(this,void 0,void 0,function*(){if(this.status!==xt.IDLE)throw Error("check is running already");this.setStatus(xt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==xt.SKIPPED&&this.setStatus(this.isSuccess()?xt.SUCCESS:xt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return S(this,void 0,void 0,function*(){return this.room.state===ne.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return S(this,void 0,void 0,function*(){this.room&&this.room.state!==ne.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(xt.SKIPPED)}switchProtocol(e){return S(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(M.Reconnecting,()=>{n=!0}),this.room.once(M.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Fe(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class tb extends Qn{get description(){return"Cloud regions"}perform(){return S(this,void 0,void 0,function*(){const e=new se(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return S(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let C=0;C<c;C++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),v={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(C=>{C.type==="candidate-pair"&&C.nominated&&(v.rtt=C.currentRoundTripTime*1e3)}),yield this.disconnect(),v})}}const uc=1e4;class nb extends Qn{get description(){return"Connection via UDP vs TCP"}perform(){return S(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(uc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(uc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return S(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>S(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(v=>{v.type==="outbound-rtp"?(u.packetsSent=v.packetsSent,u.qualityLimitationDurations=v.qualityLimitationDurations,u.bitrateTotal+=v.targetBitrate,u.count++):v.type==="remote-inbound-rtp"&&(u.packetsLost=v.packetsLost,u.rttTotal+=v.roundTripTime,u.jitterTotal+=v.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,uc)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class ib extends Qn{get description(){return"Can publish audio"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield kv();if(yield sv(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class rb extends Qn{get description(){return"Can publish video"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield $T();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return S(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const v=l.getContext("2d");v.drawImage(i,0,0);const p=v.getImageData(0,0,l.width,l.height).data;let w=!0;for(let g=0;g<p.length;g+=4)if(p[g]!==0||p[g+1]!==0||p[g+2]!==0){w=!1;break}w?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class sb extends Qn{get description(){return"Resuming connection after interruption"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(M.SignalReconnecting,a).on(M.Reconnecting,a).on(M.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==ne.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class ob extends Qn{get description(){return"Can connect via TURN"}perform(){return S(this,void 0,void 0,function*(){var e,n;const i=new qu,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class ab extends Qn{get description(){return"Establishing WebRTC connection"}perform(){return S(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(M.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(cb(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),G.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function cb(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class lb extends Qn{get description(){return"Connecting to signal connection via WebSocket"}perform(){return S(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new qu;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===og.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class Bb extends Qt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:xt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==xt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return S(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(lb)})}checkWebRTC(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(ab)})}checkTURN(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(ob)})}checkReconnect(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(sb)})}checkPublishAudio(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(ib)})}checkPublishVideo(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(rb)})}checkConnectionProtocol(){return S(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(nb);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(tb)})}}function Q(t,e,n){return(e=db(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ub(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function db(t){var e=ub(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Ze extends Error{constructor(e,n){var i;super(e,n),Q(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Q(Ze,"code","ERR_JOSE_GENERIC");class hb extends Ze{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Q(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Q(this,"claim",void 0),Q(this,"reason",void 0),Q(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Q(hb,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class fb extends Ze{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Q(this,"code","ERR_JWT_EXPIRED"),Q(this,"claim",void 0),Q(this,"reason",void 0),Q(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Q(fb,"code","ERR_JWT_EXPIRED");class pb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Q(pb,"code","ERR_JOSE_ALG_NOT_ALLOWED");class mb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Q(mb,"code","ERR_JOSE_NOT_SUPPORTED");class gb extends Ze{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Q(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Q(gb,"code","ERR_JWE_DECRYPTION_FAILED");class vb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JWE_INVALID")}}Q(vb,"code","ERR_JWE_INVALID");class yb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JWS_INVALID")}}Q(yb,"code","ERR_JWS_INVALID");class kb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JWT_INVALID")}}Q(kb,"code","ERR_JWT_INVALID");class Sb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JWK_INVALID")}}Q(Sb,"code","ERR_JWK_INVALID");class Cb extends Ze{constructor(){super(...arguments),Q(this,"code","ERR_JWKS_INVALID")}}Q(Cb,"code","ERR_JWKS_INVALID");class Tb extends Ze{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Q(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Q(Tb,"code","ERR_JWKS_NO_MATCHING_KEY");class bb extends Ze{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Q(this,Symbol.asyncIterator,void 0),Q(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Q(bb,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class wb extends Ze{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Q(this,"code","ERR_JWKS_TIMEOUT")}}Q(wb,"code","ERR_JWKS_TIMEOUT");class Eb extends Ze{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Q(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Q(Eb,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function un(){return un=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},un.apply(null,arguments)}const mf=new Uint8Array(0);class hs{static getFullOptions(e){return un({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(s){i.onError(`Unexpected error in client tool call handling: ${s instanceof Error?s.message:String(s)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return mf}getOutputByteFrequencyData(){return mf}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let Tv=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function Ko(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const bv="0.11.0";function xl(t){return!!t.type}const wv="conversation_initiation_client_data";function Ev(t){var e;const n={type:wv};var i,r,s,o,a;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(s=t.overrides.agent)==null?void 0:s.language},tts:{voice_id:(o=t.overrides.tts)==null?void 0:o.voiceId},conversation:{text_only:(a=t.overrides.conversation)==null?void 0:a.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let Ml=class _v extends Tv{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",s=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:s}),0)}),this.socket.addEventListener("close",s=>{this.disconnect(s.code===1e3?{reason:"agent",context:s}:{reason:"error",message:s.reason||"The connection was closed by the server.",context:s})}),this.socket.addEventListener("message",s=>{try{const o=JSON.parse(s.data);if(!xl(o))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:s.data});this.handleMessage(o)}catch(o){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:o instanceof Error?o.message:String(o),data:s.data})}})}static async create(e){let n=null;try{var i,r,s;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const l=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||bv,u=((s=e.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk";if(e.signedUrl){const y=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${y}source=${u}&version=${l}`}else c=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${l}`;const d=["convai"];e.authorization&&d.push(`bearer.${e.authorization}`),n=new WebSocket(c,d);const h=await new Promise((y,f)=>{n.addEventListener("open",()=>{var m;const k=Ev(e);(m=n)==null||m.send(JSON.stringify(k))},{once:!0}),n.addEventListener("error",m=>{setTimeout(()=>f(m),0)}),n.addEventListener("close",f),n.addEventListener("message",m=>{const k=JSON.parse(m.data);xl(k)&&(k.type==="conversation_initiation_metadata"?y(k.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:v,agent_output_audio_format:C,user_input_audio_format:p}=h,w=Ko(p??"pcm_16000"),g=Ko(C);return new _v(n,v,w,g)}catch(a){var o;throw(o=n)==null||o.close(),a}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function Pv(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function _b(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Us=new Map;function Rv(t,e){return async(n,i)=>{const r=Us.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Us.set(t,i)}catch(a){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${a}`)}const s=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(s);try{return await n.addModule(o),void Us.set(t,o)}catch{URL.revokeObjectURL(o)}try{const a=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(a),Us.set(t,a)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const Iv=Rv("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class nn extends Tv{constructor(e,n,i,r,s={}){super(s),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,s;const l=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||bv,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",d=`${o=(s=e.origin)!=null?s:"https://api.elevenlabs.io",o.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${l}`,h=await fetch(d);if(!h.ok)throw new Error(`ElevenLabs API returned ${h.status} ${h.statusText}`);if(n=(await h.json()).token,!n)throw new Error("No conversation token received from API")}catch(l){let u=l instanceof Error?l.message:String(l);throw l instanceof Error&&l.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var o;const a=new sr;try{const l=`room_${Date.now()}`,u=Ko("pcm_48000"),d=Ko("pcm_48000"),h=new nn(a,l,u,d,e),v=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await a.connect(v,n),await new Promise(p=>{if(h.isConnected)p();else{const w=()=>{a.off(M.Connected,w),p()};a.on(M.Connected,w)}}),a.name&&(h.conversationId=((c=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||a.name),await a.localParticipant.setMicrophoneEnabled(!0);const C=Ev(e);return h.debug({type:wv,message:C}),await h.sendMessage(C),h}catch(l){throw await a.disconnect(),l}}setupRoomEventListeners(){var e=this;this.room.on(M.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(M.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(M.ConnectionStateChanged,n=>{n===ne.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(M.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;xl(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(M.TrackSubscribed,async function(n,i,r){if(n.kind===R.Kind.Audio&&r.identity.includes("agent")){const s=n,o=s.attach();if(o.autoplay=!0,o.controls=!1,e.outputDeviceId&&o.setSinkId)try{await o.setSinkId(e.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}o.style.display="none",document.body.appendChild(o),e.audioElements.push(o),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(s)}}),this.room.on(M.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(R.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await Iv(n.audioWorklet);const s=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(s),s.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),s.port.onmessage=o=>{const[a,c]=o.data;if(c>.01){const l=Pv(a.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:l,event_id:u}})}},r.connect(s)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(R.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await kv(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:R.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function xv(t){const e=function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"}(t);switch(e){case"websocket":return Ml.create(t);case"webrtc":return nn.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function Mv(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Ov(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(Mv()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Yu extends hs{static async startSession(e){const n=hs.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await Ov(n.connectionDelay),i=await xv(e),new Yu(n,i)}catch(s){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),s}}}const gf={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class Go{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:s,libsampleratePath:o}){let a=null,c=null;try{const d=un({sampleRate:{ideal:e}},gf);if(Mv()&&i){const g=(await window.navigator.mediaDevices.enumerateDevices()).find(y=>y.kind==="audioinput"&&["airpod","headphone","earphone"].find(f=>y.label.toLowerCase().includes(f)));g&&(d.deviceId={ideal:g.deviceId})}r&&(d.deviceId={exact:r});const h=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(h?{sampleRate:e}:{});const v=a.createAnalyser();if(!h){const g=o||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(g)}await Iv(a.audioWorklet,s==null?void 0:s.rawAudioProcessor);const C=un({voiceIsolation:!0},d);c=await navigator.mediaDevices.getUserMedia({audio:C});const p=a.createMediaStreamSource(c),w=new AudioWorkletNode(a,"rawAudioProcessor");return w.port.postMessage({type:"setFormat",format:n,sampleRate:e}),p.connect(v),v.connect(w),await a.resume(),new Go(a,v,w,c,p)}catch(d){var l,u;throw(l=c)==null||l.getTracks().forEach(h=>{h.stop()}),(u=a)==null||u.close(),d}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=s}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=un({},gf);e&&(n.deviceId={exact:e});const i=un({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(s=>{s.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const Pb=Rv("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class Jo{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let s=null,o=null;try{s=new AudioContext({sampleRate:e});const l=s.createAnalyser(),u=s.createGain();o=new Audio,o.src="",o.load(),o.autoplay=!0,o.style.display="none",document.body.appendChild(o);const d=s.createMediaStreamDestination();o.srcObject=d.stream,u.connect(l),l.connect(d),await Pb(s.audioWorklet,r==null?void 0:r.audioConcatProcessor);const h=new AudioWorkletNode(s,"audioConcatProcessor");return h.port.postMessage({type:"setFormat",format:n}),h.connect(u),await s.resume(),i&&o.setSinkId&&await o.setSinkId(i),new Jo(s,l,u,h,o)}catch(l){var a,c;throw(a=o)!=null&&a.parentNode&&o.parentNode.removeChild(o),(c=o)==null||c.pause(),s&&s.state!=="closed"&&await s.close(),l}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=s}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Xu extends hs{static async startSession(e){var n;const i=hs.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,s=null,o=null,a=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var l;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await Ov(i.connectionDelay),s=await xv(e),[r,o]=await Promise.all([Go.create(un({},s.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),Jo.create(un({},s.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(l=a)==null||l.getTracks().forEach(p=>{p.stop()}),a=null,new Xu(i,s,r,o,c)}catch(p){var u,d,h,v;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(u=a)==null||u.getTracks().forEach(w=>{w.stop()}),(d=s)==null||d.close(),await((h=r)==null?void 0:h.close()),await((v=o)==null?void 0:v.close());try{var C;await((C=c)==null?void 0:C.release()),c=null}catch{}throw p}}constructor(e,n,i,r,s){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=o=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:Pv(o.data[0].buffer)})},this.onOutputWorkletMessage=({data:o})=>{o.type==="process"&&this.updateMode(o.finished?"listening":"speaking")},this.addAudioBase64Chunk=o=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:_b(o)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=o=>{if(o.length===0)return 0;let a=0;for(let c=0;c<o.length;c++)a+=o[c]/255;return a/=o.length,a<0?0:a>1?1:a},this.setVolume=({volume:o})=>{const a=Number.isFinite(o)?Math.min(1,Math.max(0,o)):1;this.volume=a,this.connection instanceof nn?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=r,this.wakeLock=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof nn||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof nn?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof nn?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof Ml)try{return await this.input.setInputDevice(r),this.input}catch(o){console.warn("Failed to change device on existing input, recreating:",o)}this.connection instanceof nn&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const s=await Go.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(s){throw console.error("Error changing input device",s),s}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof Ml)try{return await this.output.setOutputDevice(i),this.output}catch(s){console.warn("Failed to change device on existing output, recreating:",s)}this.connection instanceof nn&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await Jo.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var vf;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded"})(vf||(vf={}));var yf,kf;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(yf||(yf={})),function(t){t.MANUAL="manual",t.VAD="vad"}(kf||(kf={}));class Rb extends hs{static startSession(e){return e.textOnly?Yu.startSession(e):Xu.startSession(e)}}function zr(){return zr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},zr.apply(null,arguments)}const Ib=["micMuted","volume","serverLocation"];function xb(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function Mb(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function Ob(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function Db(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=function(p,w){if(p==null)return{};var g={};for(var y in p)if({}.hasOwnProperty.call(p,y)){if(w.indexOf(y)!==-1)continue;g[y]=p[y]}return g}(t,Ib),s=Z.useRef(null),o=Z.useRef(null),[a,c]=Z.useState("disconnected"),[l,u]=Z.useState(!1),[d,h]=Z.useState("listening"),v=Z.useRef(e),C=Z.useRef(n);return v.current=e,C.current=n,Z.useEffect(()=>{var p;e!==void 0&&(s==null||(p=s.current)==null||p.setMicMuted(e))},[e]),Z.useEffect(()=>{var p;n!==void 0&&(s==null||(p=s.current)==null||p.setVolume({volume:n}))},[n]),Z.useEffect(()=>()=>{var p;(p=s.current)==null||p.endSession()},[]),{startSession:async p=>{var w;if((w=s.current)!=null&&w.isOpen())return s.current.getId();if(o.current)return(await o.current).getId();try{var g,y,f,m,k,T,E,_,x,P;const N=xb((p==null?void 0:p.serverLocation)||i),W=Mb(N),ie=Ob(N);return o.current=Rb.startSession(zr({},r??{},p??{},{origin:W,livekitUrl:ie,overrides:zr({},(g=r==null?void 0:r.overrides)!=null?g:{},(y=p==null?void 0:p.overrides)!=null?y:{},{client:zr({},(f=r==null||(m=r.overrides)==null?void 0:m.client)!=null?f:{},(k=p==null||(T=p.overrides)==null?void 0:T.client)!=null?k:{},{source:(p==null||(E=p.overrides)==null||(E=E.client)==null?void 0:E.source)||(r==null||(_=r.overrides)==null||(_=_.client)==null?void 0:_.source)||"react_sdk",version:(p==null||(x=p.overrides)==null||(x=x.client)==null?void 0:x.version)||(r==null||(P=r.overrides)==null||(P=P.client)==null?void 0:P.version)||"0.11.0"})}),onConnect:(p==null?void 0:p.onConnect)||(r==null?void 0:r.onConnect),onDisconnect:(p==null?void 0:p.onDisconnect)||(r==null?void 0:r.onDisconnect),onError:(p==null?void 0:p.onError)||(r==null?void 0:r.onError),onMessage:(p==null?void 0:p.onMessage)||(r==null?void 0:r.onMessage),onAudio:(p==null?void 0:p.onAudio)||(r==null?void 0:r.onAudio),onDebug:(p==null?void 0:p.onDebug)||(r==null?void 0:r.onDebug),onUnhandledClientToolCall:(p==null?void 0:p.onUnhandledClientToolCall)||(r==null?void 0:r.onUnhandledClientToolCall),onVadScore:(p==null?void 0:p.onVadScore)||(r==null?void 0:r.onVadScore),onInterruption:(p==null?void 0:p.onInterruption)||(r==null?void 0:r.onInterruption),onAgentToolResponse:(p==null?void 0:p.onAgentToolResponse)||(r==null?void 0:r.onAgentToolResponse),onConversationMetadata:(p==null?void 0:p.onConversationMetadata)||(r==null?void 0:r.onConversationMetadata),onMCPToolCall:(p==null?void 0:p.onMCPToolCall)||(r==null?void 0:r.onMCPToolCall),onMCPConnectionStatus:(p==null?void 0:p.onMCPConnectionStatus)||(r==null?void 0:r.onMCPConnectionStatus),onAsrInitiationMetadata:(p==null?void 0:p.onAsrInitiationMetadata)||(r==null?void 0:r.onAsrInitiationMetadata),onAgentChatResponsePart:(p==null?void 0:p.onAgentChatResponsePart)||(r==null?void 0:r.onAgentChatResponsePart),onModeChange:({mode:q})=>{var te;h(q),(te=(p==null?void 0:p.onModeChange)||(r==null?void 0:r.onModeChange))==null||te({mode:q})},onStatusChange:({status:q})=>{var te;c(q),(te=(p==null?void 0:p.onStatusChange)||(r==null?void 0:r.onStatusChange))==null||te({status:q})},onCanSendFeedbackChange:({canSendFeedback:q})=>{var te;u(q),(te=(p==null?void 0:p.onCanSendFeedbackChange)||(r==null?void 0:r.onCanSendFeedbackChange))==null||te({canSendFeedback:q})}})),s.current=await o.current,v.current!==void 0&&s.current.setMicMuted(v.current),C.current!==void 0&&s.current.setVolume({volume:C.current}),s.current.getId()}finally{o.current=null}},endSession:async()=>{const p=s.current;s.current=null,await(p==null?void 0:p.endSession())},setVolume:({volume:p})=>{var w;(w=s.current)==null||w.setVolume({volume:p})},getInputByteFrequencyData:()=>{var p;return(p=s.current)==null?void 0:p.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var p;return(p=s.current)==null?void 0:p.getOutputByteFrequencyData()},getInputVolume:()=>{var p,w;return(p=(w=s.current)==null?void 0:w.getInputVolume())!=null?p:0},getOutputVolume:()=>{var p,w;return(p=(w=s.current)==null?void 0:w.getOutputVolume())!=null?p:0},sendFeedback:p=>{var w;(w=s.current)==null||w.sendFeedback(p)},getId:()=>{var p;return(p=s.current)==null?void 0:p.getId()},sendContextualUpdate:p=>{var w;(w=s.current)==null||w.sendContextualUpdate(p)},sendUserMessage:p=>{var w;(w=s.current)==null||w.sendUserMessage(p)},sendUserActivity:()=>{var p;(p=s.current)==null||p.sendUserActivity()},sendMCPToolApprovalResult:(p,w)=>{var g;(g=s.current)==null||g.sendMCPToolApprovalResult(p,w)},changeInputDevice:async p=>{if(s.current&&"changeInputDevice"in s.current)return await s.current.changeInputDevice(p);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async p=>{if(s.current&&"changeOutputDevice"in s.current)return await s.current.changeOutputDevice(p);throw new Error("Device switching is only available for voice conversations")},status:a,canSendFeedback:l,micMuted:e,isSpeaking:d==="speaking"}}const Dv=({onClick:t})=>V.jsxs("div",{className:"start-button-container",children:[V.jsxs("div",{className:"start-button-top",children:[V.jsx("div",{className:"avatar-circle",children:V.jsx("img",{src:"/AI-Sphere.gif",alt:"AI Assistant",className:"ai-sphere-gif"})}),V.jsx("span",{className:"need-help",children:"Need help?"})]}),V.jsxs("button",{className:"start-call-btn",onClick:t,children:[V.jsx("svg",{className:"phone-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M22 16.92v3.02a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3.02a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7a2 2 0 011.72 2.03z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})}),"Start a call"]})]}),Nb=({onAccept:t,onDecline:e})=>V.jsx("div",{className:"terms-modal-overlay",children:V.jsxs("div",{className:"terms-modal",children:[V.jsx("h3",{children:"Terms and conditions"}),V.jsx("div",{className:"terms-content",children:V.jsx("p",{children:'By clicking "Agree," and each time I interact with this AI agent, I consent to the recording, storage, and sharing of my communications with third-party service providers, and as described in the Privacy Policy. If you do not wish to have your conversations recorded, please refrain from using this service.'})}),V.jsxs("div",{className:"terms-actions",children:[V.jsx("button",{className:"btn-cancel",onClick:e,children:"Cancel"}),V.jsx("button",{className:"btn-accept",onClick:t,children:"Accept"})]})]})}),Ab=({conversation:t,agentId:e,messages:n,setMessages:i,conversationMode:r,setConversationMode:s,clientTools:o})=>{const{status:a,startSession:c,endSession:l,isSpeaking:u}=t,[d,h]=Z.useState(""),[v,C]=Z.useState(!1),[p,w]=Z.useState(!1),[g,y]=Z.useState(!1),[f,m]=Z.useState(!1),k=Z.useRef(null),T=Z.useRef(null);Z.useEffect(()=>{n.length>0&&!f&&a!=="connected"&&r&&(console.log(" Auto-reconnecting to conversation with",n.length,"messages"),console.log("Current status:",a,"Mode:",r),m(!0),(async()=>{try{if(console.log("Starting reconnection session..."),r==="voice-text")console.log("Voice mode - user must manually reconnect"),y(!0);else{console.log("Text mode - auto-reconnecting...");const te=await c({agentId:e,connectionType:"websocket",...o&&{clientTools:o}});console.log("Session started with ID:",te),await new Promise(_e=>setTimeout(_e,500)),console.log("Status after wait:",a),console.log(" Auto-reconnection initiated")}}catch(te){console.error(" Failed to auto-reconnect:",te),y(!0)}})())},[n.length,f,a,r,e,c,o]),Z.useEffect(()=>{console.log("Connection status changed:",a),a==="connected"&&n.length>0&&console.log(" Connection established with",n.length,"restored messages")},[a,n.length]);const E=()=>{var q;(q=k.current)==null||q.scrollIntoView({behavior:"smooth"})};Z.useEffect(()=>{E()},[n]);const _=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}),s("voice-text"),await c({agentId:e,connectionType:"webrtc",...o&&{clientTools:o}}),y(!1)}catch(q){console.error("Failed to start voice session:",q),q.name==="NotAllowedError"||q.name==="PermissionDeniedError"?alert("Microphone access is required for voice calls. Please allow microphone access and try again."):alert("Failed to start voice call: "+(q.message||"Unknown error"))}},x=async()=>{await l(),i([]),s(null),y(!0)},P=async()=>{y(!1),await _()},N=async q=>{if(q.preventDefault(),!d.trim()||p)return;const te=d.trim();h("");const _e={id:Date.now(),text:te,sender:"user",timestamp:new Date};if(i(he=>[...he,_e]),w(!0),a!=="connected")try{s("text-only"),console.log(" Starting text-only session...");const he=await c({agentId:e,connectionType:"websocket",...o&&{clientTools:o}});console.log(" Session started with ID:",he);let U=0;for(;!t.sendUserMessage&&U<25;)console.log(` Waiting for sendUserMessage... Attempt ${U+1}/25`),await new Promise(z=>setTimeout(z,200)),U++;if(!t.sendUserMessage){console.error(" Timeout: sendUserMessage not available after 5 seconds"),w(!1),alert("Connection timeout. Please try again.");return}console.log(" sendUserMessage is now available")}catch(he){console.error(" Failed to start text session:",he),w(!1),alert("Failed to start text chat: "+(he.message||he.toString()||"Unknown error"));return}try{t&&typeof t.sendUserMessage=="function"?(console.log(" Sending message:",te),t.sendUserMessage(te),console.log(" Message sent successfully"),w(!1)):(console.error(" sendUserMessage is not available:",{conversation:t,hasSendUserMessage:t==null?void 0:t.sendUserMessage,type:typeof(t==null?void 0:t.sendUserMessage),conversationKeys:t?Object.keys(t):"no conversation",status:a}),w(!1),alert("Unable to send message. Connection not ready. Please try again."))}catch(he){console.error(" Failed to send message:",he),w(!1),alert("Failed to send message: "+(he.message||he.toString()))}},W=()=>{C(!0)},ie=()=>{C(!1)};return v?V.jsx("div",{className:"chat-interface minimized",children:V.jsx(Dv,{onClick:ie})}):V.jsxs("div",{className:"chat-interface",children:[V.jsxs("div",{className:"chat-header",children:[V.jsxs("div",{className:"logo-container",children:[V.jsx("img",{src:"https://www.ecovis.com/austria/en/wp-content/themes/ecovis-officetemplate/images/logo-ecovis-header.jpg",alt:"ECOVIS",className:"ecovis-logo"}),V.jsx("span",{className:"ecovis-ai-text",children:"AI"})]}),V.jsx("button",{className:"minimize-button",onClick:W,title:"Minimize chat",children:V.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M4 6L8 10L12 6",stroke:"#666",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),V.jsx("div",{className:"chat-body",ref:T,children:n.length===0&&a!=="connected"?V.jsx("div",{className:"chat-body-empty",children:g?V.jsx("div",{className:"new-call-container",children:V.jsxs("button",{className:"new-call-button",onClick:P,children:[V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M22 16.92v3.02a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3.02a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7a2 2 0 011.72 2.03z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})}),"New call"]})}):V.jsx("div",{className:"connect-button-container",children:V.jsx("button",{className:"connect-phone-button",onClick:_,title:"Connect to agent",children:V.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M22 16.92v3.02a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3.02a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7a2 2 0 011.72 2.03z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})})}):n.length===0&&a==="connected"?V.jsx("div",{className:"status-display",children:r==="text-only"?"Chat mode - Type your message":u?"Agent is speaking...":"Listening..."}):V.jsxs("div",{className:"messages-container",children:[n.map(q=>V.jsxs("div",{className:`message ${q.sender}`,children:[V.jsx("div",{className:"message-content",children:q.text.split(`
`).map((te,_e)=>V.jsxs(xf.Fragment,{children:[te,_e<q.text.split(`
`).length-1&&V.jsx("br",{})]},_e))}),V.jsx("div",{className:"message-time",children:q.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},q.id)),a==="connected"&&r==="voice-text"&&u&&n.length>0&&V.jsx("div",{className:"message agent typing",children:V.jsx("div",{className:"message-content",children:V.jsx("span",{className:"typing-indicator",children:"Agent is speaking..."})})}),V.jsx("div",{ref:k})]})}),V.jsxs("div",{className:"chat-controls",children:[V.jsx("form",{onSubmit:N,className:"chat-form",style:{flex:1},children:V.jsx("input",{type:"text",placeholder:"Send a message",className:"chat-input",value:d,onChange:q=>h(q.target.value),disabled:p,onKeyPress:q=>{q.key==="Enter"&&!q.shiftKey&&(q.preventDefault(),N(q))}})}),a==="connected"&&r==="voice-text"&&V.jsx("button",{className:"phone-button end-call-button",onClick:x,title:"End call",style:{backgroundColor:"#ff4444"},children:V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{color:"white"},children:V.jsx("path",{d:"M6 6L18 18M18 6L6 18",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",fill:"none"})})})]})]})},Lb="agent_8201kagj7ez0f3zv5t16gmj6g5rv",Ub=()=>{const e=(()=>{try{const f=sessionStorage.getItem("ecovis_conversation_state");if(f){const m=JSON.parse(f);console.log(" Restoring conversation state:",m);const k=(m.messages||[]).map(T=>({...T,timestamp:T.timestamp?new Date(T.timestamp):new Date}));return{messages:k,conversationMode:m.conversationMode||null,conversationId:m.conversationId||null,view:k.length>0?"chat":"start"}}}catch(f){console.error("Failed to restore conversation state:",f),sessionStorage.removeItem("ecovis_conversation_state")}return{messages:[],conversationMode:null,conversationId:null,view:"start"}})(),[n,i]=Z.useState(e.view),[r,s]=Z.useState(e.messages),[o,a]=Z.useState(e.conversationMode),[c,l]=Z.useState(e.conversationId),u=Z.useRef([]),d=(f=null)=>{try{const m={messages:r.map(k=>({...k,timestamp:k.timestamp instanceof Date?k.timestamp.toISOString():k.timestamp})),conversationMode:o,conversationId:f||c,timestamp:Date.now()};sessionStorage.setItem("ecovis_conversation_state",JSON.stringify(m)),console.log(" Saved conversation state:",m)}catch(m){console.error("Failed to save conversation state:",m)}};Z.useEffect(()=>{(r.length>0||o)&&d()},[r,o]);const h=Z.useRef(null),v=Z.useRef(f=>{if(f&&typeof f=="string"){let m=f.startsWith("/")?f:`/${f}`;return!m.includes(".html")&&!m.endsWith("/")&&(m=m+".html"),console.log(" [REDIRECT] Requested URL:",f),console.log(" [REDIRECT] Normalized URL:",m),m.startsWith("http://")||m.startsWith("https://")?(console.warn(" [REDIRECT] Invalid redirect URL (must be relative):",f),"Invalid URL. Please use relative paths only."):(console.log(" [REDIRECT] Fetching content to keep chat connected..."),console.log(" [REDIRECT] Current conversation status:",p==null?void 0:p.status),fetch(m).then(k=>{if(console.log(" [REDIRECT] Fetch response:",k.status,k.statusText),!k.ok)throw new Error(`HTTP error! status: ${k.status}`);return k.text()}).then(k=>{console.log(" [REDIRECT] HTML received, length:",k.length);const E=new DOMParser().parseFromString(k,"text/html"),_=E.querySelector("main#content")||E.querySelector("main"),x=document.querySelector("main#content")||document.querySelector("main");if(console.log(" [REDIRECT] Current main element:",x?"found":"NOT FOUND"),console.log(" [REDIRECT] New main element:",_?"found":"NOT FOUND"),x&&_){console.log(" [REDIRECT] Replacing content without page reload..."),x.innerHTML=_.innerHTML,E.title&&(document.title=E.title,console.log(" [REDIRECT] Title updated to:",E.title));const P=document.querySelector("nav a.active");P&&P.classList.remove("active");const N=document.querySelector(`nav a[href="${m}"]`);N&&N.classList.add("active"),window.scrollTo({top:0,behavior:"smooth"}),window.history&&window.history.pushState&&(window.history.pushState({path:m},"",m),console.log(" [REDIRECT] Browser URL updated to:",m)),console.log(" [REDIRECT] Content loaded successfully - CHAT STAYS CONNECTED!"),console.log(" [REDIRECT] Conversation status after navigation:",p==null?void 0:p.status)}else console.error(" [REDIRECT] Could not find main content containers!"),console.error(" [REDIRECT] THIS SHOULD NOT HAPPEN - Check your HTML structure"),console.error("Available elements:",{"main#content":!!document.querySelector("main#content"),main:!!document.querySelector("main"),body:!!document.querySelector("body")})}).catch(k=>{console.error(" [REDIRECT] Fetch failed:",k),console.error(" [REDIRECT] Error details:",{message:k.message,stack:k.stack,url:m})}),"Navigating to "+f+"... Stay on the line!")}return"Invalid URL parameter."}),C=Z.useMemo(()=>(console.log(" Creating clientTools handler"),{redirectToExternalURL:f=>{console.log(" clientTools.redirectToExternalURL CALLED!"),console.log("Params:",f),console.log("Params type:",typeof f),console.log("Params keys:",f&&typeof f=="object"?Object.keys(f):"N/A"),console.log("Full params:",JSON.stringify(f,null,2));let m=null;return typeof f=="string"?m=f:f&&typeof f=="object"?m=f.url||f.URL||f.path||f.pathname:Array.isArray(f)&&f.length>0&&(m=f[0]),console.log("Extracted URL from clientTools:",m),m?v.current(m):(console.error(" Could not extract URL from params:",f),"Error: Could not extract URL from parameters.")}}),[]),p=Db({textOnly:!0,...c&&{conversationId:c},clientTools:C,onToolCall:f=>{var m,k;if(console.log(" onToolCall callback triggered:",f),console.log("Tool call structure:",JSON.stringify(f,null,2)),f&&f.name==="redirectToExternalURL"){const T=((m=f.parameters)==null?void 0:m.url)||((k=f.args)==null?void 0:k.url)||f.url;console.log("Extracted URL from onToolCall:",T),T&&handleRedirect(T)}},onError:f=>{var m,k,T,E,_,x,P,N,W,ie,q,te,_e,he,U,z,F,B,K,Ae,Ve,Yt,et,Yn;console.error(" Conversation error:",f);try{const Xn={};for(const lt in f)try{Xn[lt]=f[lt]}catch{Xn[lt]="Unable to serialize"}console.error("Error properties:",Xn),console.error("Error JSON:",JSON.stringify(Xn,null,2))}catch{console.error("Could not fully serialize error")}if(f&&((m=f.message)!=null&&m.includes("tool")||(k=f.message)!=null&&k.includes("redirectToExternalURL")||f.clientToolName==="redirectToExternalURL")){console.error(" TOOL-RELATED ERROR - INTERCEPTING!"),console.log(" Scanning recent messages:",u.current.length,"messages");for(let lt=u.current.length-1;lt>=Math.max(0,u.current.length-10);lt--){const re=u.current[lt];if(re&&typeof re=="object"){console.log(` Message ${lt}:`,re);const ki=((T=re.parameters)==null?void 0:T.url)||re.url||((E=re.args)==null?void 0:E.url)||((_=re.arguments)==null?void 0:_.url)||((x=re.parameter)==null?void 0:x.url)||re.data&&re.data.url||re.data&&re.data.parameters&&re.data.parameters.url||re.metadata&&re.metadata.url||re.payload&&re.payload.url||re.payload&&re.payload.parameters&&re.payload.parameters.url,Nv=re.tool==="redirectToExternalURL"||re.name==="redirectToExternalURL"||re.tool_name==="redirectToExternalURL"||re.toolName==="redirectToExternalURL"||re.clientToolName==="redirectToExternalURL"||re.data&&re.data.tool==="redirectToExternalURL"||re.type==="tool_call"&&re.name==="redirectToExternalURL";if(ki&&Nv){console.log(" FOUND URL IN RECENT MESSAGE! Redirecting to:",ki),v.current(ki);return}if(ki&&JSON.stringify(re).includes("redirectToExternalURL")){console.log(" FOUND URL IN MESSAGE MENTIONING REDIRECT! Redirecting to:",ki),v.current(ki);return}}}console.log(" Scanning error object for URL");const Xn=[f.url,(P=f.parameter)==null?void 0:P.url,(N=f.parameters)==null?void 0:N.url,(W=f.args)==null?void 0:W.url,(ie=f.arguments)==null?void 0:ie.url,(q=f.data)==null?void 0:q.url,(_e=(te=f.data)==null?void 0:te.parameter)==null?void 0:_e.url,(U=(he=f.data)==null?void 0:he.parameters)==null?void 0:U.url,(z=f.payload)==null?void 0:z.url,(B=(F=f.payload)==null?void 0:F.parameters)==null?void 0:B.url,(Ae=(K=f.toolCall)==null?void 0:K.parameters)==null?void 0:Ae.url,(Yt=(Ve=f.tool_call)==null?void 0:Ve.parameters)==null?void 0:Yt.url,(et=f.toolCall)==null?void 0:et.url,(Yn=f.tool_call)==null?void 0:Yn.url];for(const lt of Xn)if(lt&&typeof lt=="string"){console.log(" FOUND URL IN ERROR OBJECT! Redirecting to:",lt),v.current(lt);return}console.error(" Could not extract URL from error or recent messages"),console.error("Recent messages:",u.current)}},onMessage:f=>{var T,E,_,x,P,N,W,ie,q,te,_e,he,U,z;if(f&&(u.current.push(f),u.current.length>10&&u.current.shift()),f&&typeof f=="object"){const F=f.toolCall||f.tool_call||((T=f.data)==null?void 0:T.toolCall)||((E=f.data)==null?void 0:E.tool_call);if(F&&(F.name==="redirectToExternalURL"||F.tool==="redirectToExternalURL")){const B=((_=F.parameters)==null?void 0:_.url)||F.url||((x=F.args)==null?void 0:x.url);if(B){console.log(" Found tool call in message BEFORE error, redirecting to:",B),v.current(B);return}}if(f.name==="redirectToExternalURL"||f.tool==="redirectToExternalURL"||f.tool_name==="redirectToExternalURL"){const B=((P=f.parameters)==null?void 0:P.url)||f.url||((N=f.args)==null?void 0:N.url)||((W=f.arguments)==null?void 0:W.url);if(B){console.log(" Found tool call directly in message, redirecting to:",B),v.current(B);return}}}if(f&&typeof f=="object"&&(f.toolCall||f.tool_call||f.tool||f.tool_name)||console.log("onMessage callback:",f),f&&typeof f=="object"){if(f.type==="tool_call"||f.type==="tool"||f.tool_name==="redirectToExternalURL"||f.tool==="redirectToExternalURL"||f.toolName==="redirectToExternalURL"||f.name==="redirectToExternalURL"||f.metadata&&f.metadata.tool==="redirectToExternalURL"||f.data&&f.data.tool==="redirectToExternalURL"){console.log(" TOOL CALL DETECTED:",f);const B=((ie=f.parameters)==null?void 0:ie.url)||f.url||((q=f.args)==null?void 0:q.url)||((te=f.arguments)==null?void 0:te.url)||f.data&&f.data.url||f.metadata&&f.metadata.url;if(console.log("Extracted URL:",B),B&&typeof B=="string")try{const K=B.startsWith("/")?B:`/${B}`;if(!K.startsWith("http://")&&!K.startsWith("https://")){console.log(" Redirecting via onMessage fallback to:",K),setTimeout(()=>{window.location.href=K},100);return}else console.warn(" Invalid redirect URL (must be relative):",B)}catch(K){console.error(" Error during redirect (onMessage fallback):",K)}else console.warn(" No valid URL found in tool call:",f);return}if(f.text||f.message||f.content){const B=(f.text||f.message||f.content).toString();if(B.includes("redirectToExternalURL")||B.includes("tool_call")){console.log(" Possible tool call in text:",B);try{if(B.trim().startsWith("{")){const K=JSON.parse(B);if(K.tool==="redirectToExternalURL"||K.name==="redirectToExternalURL"){const Ae=K.url||((_e=K.parameters)==null?void 0:_e.url)||((he=K.args)==null?void 0:he.url);if(Ae){console.log(" Found URL in parsed JSON:",Ae);const Ve=Ae.startsWith("/")?Ae:`/${Ae}`;if(!Ve.startsWith("http://")&&!Ve.startsWith("https://")){setTimeout(()=>{window.location.href=Ve},100);return}}}}}catch{}}}}if(typeof f=="string"&&(f.includes("redirectToExternalURL")||f.includes("tool_call"))){console.log(" Possible tool call in string message:",f);try{const F=JSON.parse(f);if(F.tool==="redirectToExternalURL"||F.name==="redirectToExternalURL"){const B=F.url||((U=F.parameters)==null?void 0:U.url)||((z=F.args)==null?void 0:z.url);if(B){console.log(" Found URL in string JSON:",B);const K=B.startsWith("/")?B:`/${B}`;if(!K.startsWith("http://")&&!K.startsWith("https://")){setTimeout(()=>{window.location.href=K},100);return}}}}catch{}}let m="",k="agent";if(typeof f=="string")try{const F=JSON.parse(f);m=F.message||F.text||F.content||f,k=F.source==="user"||F.role==="user"?"user":"agent"}catch{m=f,k="agent"}else f&&(m=f.message||f.text||f.content||f.transcript||"",f.source==="user"||f.role==="user"||f.sender==="user"||f.isUser?k="user":f.source==="ai"||f.source==="assistant"||f.role==="assistant"||f.role==="agent"||f.sender==="agent"||f.sender==="assistant"?k="agent":k=f.transcript?"user":"agent");if(m&&typeof m=="string"&&(m=m.trim(),m.startsWith("{")&&m.includes('"message"')))try{const F=JSON.parse(m);m=F.message||F.text||m}catch{const F=m.match(/"message"\s*:\s*"([^"]+)"/);F&&(m=F[1].replace(/\\n/g,`
`))}m&&m.trim()&&m!=="undefined"&&!m.includes("debug")&&!m.startsWith("{")&&s(F=>{const B=F[F.length-1];return B&&B.text===m&&B.sender===k?F:[...F,{id:Date.now()+Math.random(),text:m,sender:k,timestamp:new Date}]})}});Z.useEffect(()=>{if(p){h.current=p,console.log("Conversation object:",p),console.log("Available properties:",Object.keys(p));const f=p.conversationId||p.sessionId||null;f&&f!==c&&(l(f),d(f)),Object.keys(p).forEach(k=>{(k.toLowerCase().includes("tool")||k.toLowerCase().includes("callback"))&&console.log(`Found tool-related property: ${k}`,p[k])})}},[p]),Z.useEffect(()=>{e.messages.length>0&&n==="start"&&(console.log(" Auto-restoring conversation with",e.messages.length,"messages"),i("chat"))},[]);const w=()=>{i("terms")},g=()=>{i("chat")},y=()=>{i("start")};return V.jsxs("div",{className:"elevenlabs-widget-container",children:[n==="start"&&V.jsx(Dv,{onClick:w}),n==="terms"&&V.jsx(Nb,{onAccept:g,onDecline:y}),n==="chat"&&V.jsx(Ab,{conversation:p,agentId:Lb,messages:r,setMessages:s,conversationMode:o,setConversationMode:a,clientTools:C})]})};if(document.getElementById("elevenlabs-widget-root")){document.querySelectorAll("elevenlabs-convai").forEach(i=>i.remove()),document.querySelectorAll('script[src*="convai-widget-embed"]').forEach(i=>i.remove()),console.log(" Custom ECOVIS widget initializing...");const n=document.getElementById("elevenlabs-widget-root");if(n)try{dc.createRoot(n).render(V.jsx(xf.StrictMode,{children:V.jsx(Ub,{})})),console.log(" Custom ECOVIS widget loaded successfully")}catch(i){console.error(" Failed to load custom widget:",i)}else console.error(" Widget root element not found")}else console.warn(" Widget root element (#elevenlabs-widget-root) not found on this page");
